/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./wwwroot/css/btn.css":
/*!*****************************!*\
  !*** ./wwwroot/css/btn.css ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/card.css":
/*!******************************!*\
  !*** ./wwwroot/css/card.css ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/grid.css":
/*!******************************!*\
  !*** ./wwwroot/css/grid.css ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/main.css":
/*!******************************!*\
  !*** ./wwwroot/css/main.css ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/modal.css":
/*!*******************************!*\
  !*** ./wwwroot/css/modal.css ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/notification.css":
/*!**************************************!*\
  !*** ./wwwroot/css/notification.css ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/profile-group.css":
/*!***************************************!*\
  !*** ./wwwroot/css/profile-group.css ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/variables.css":
/*!***********************************!*\
  !*** ./wwwroot/css/variables.css ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/js/ApartmentProfile.js":
/*!****************************************!*\
  !*** ./wwwroot/js/ApartmentProfile.js ***!
  \****************************************/
/***/ (() => {



/***/ }),

/***/ "./wwwroot/js/AuthManager.js":
/*!***********************************!*\
  !*** ./wwwroot/js/AuthManager.js ***!
  \***********************************/
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var AuthManager = /*#__PURE__*/function () {
  function AuthManager() {
    _classCallCheck(this, AuthManager);
    this.tokenKey = 'hpm_auth_token';
    this.userDataKey = 'hpm_user_data';
    this.authApiUrl = '/api/auth';
    this.isAuthenticated = false;
    this.userData = null;

    // Автоматически инициализируем при загрузке
    this.initialize();
  }

  /**
   * Инициализация менеджера аутентификации
   */
  return _createClass(AuthManager, [{
    key: "initialize",
    value: (function () {
      var _initialize = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {
        var urlParams, authCode;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.n) {
            case 0:
              // Проверяем наличие кода аутентификации в URL
              urlParams = new URLSearchParams(window.location.search);
              authCode = urlParams.get('auth');
              if (!authCode) {
                _context.n = 2;
                break;
              }
              console.log('Найден код аутентификации в URL');
              _context.n = 1;
              return this.exchangeAuthCode(authCode);
            case 1:
              // Удаляем код из URL после обработки
              this.clearAuthCodeFromUrl();
              _context.n = 3;
              break;
            case 2:
              _context.n = 3;
              return this.checkStoredToken();
            case 3:
              return _context.a(2);
          }
        }, _callee, this);
      }));
      function initialize() {
        return _initialize.apply(this, arguments);
      }
      return initialize;
    }()
    /**
     * Обменивает код аутентификации на токен
     */
    )
  }, {
    key: "exchangeAuthCode",
    value: (function () {
      var _exchangeAuthCode = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(authCode) {
        var response, result, _t;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              _context2.p = 0;
              _context2.n = 1;
              return fetch("".concat(this.authApiUrl, "/exchange-code"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  authCode: authCode
                })
              });
            case 1:
              response = _context2.v;
              _context2.n = 2;
              return response.json();
            case 2:
              result = _context2.v;
              if (response.ok && result.isAuthenticated) {
                this.setAuthData(result.token, {
                  userId: result.userId,
                  email: result.email,
                  phoneNumber: result.phoneNumber
                });
                console.log('✅ Авторизация успешна');
                this.showNotification('Добро пожаловать!', 'success');
              } else {
                console.warn('❌ Ошибка при обмене кода аутентификации:', result.message);
                this.clearAuthData();
                this.showNotification(result.message || 'Ошибка авторизации', 'error');
              }
              _context2.n = 4;
              break;
            case 3:
              _context2.p = 3;
              _t = _context2.v;
              console.error('❌ Ошибка при обмене кода аутентификации:', _t);
              this.clearAuthData();
              this.showNotification('Произошла ошибка при авторизации', 'error');
            case 4:
              return _context2.a(2);
          }
        }, _callee2, this, [[0, 3]]);
      }));
      function exchangeAuthCode(_x) {
        return _exchangeAuthCode.apply(this, arguments);
      }
      return exchangeAuthCode;
    }()
    /**
     * Проверяет сохраненный токен
     */
    )
  }, {
    key: "checkStoredToken",
    value: (function () {
      var _checkStoredToken = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {
        var token, response, result, _t2;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              token = localStorage.getItem(this.tokenKey);
              if (token) {
                _context3.n = 1;
                break;
              }
              this.clearAuthData();
              return _context3.a(2);
            case 1:
              _context3.p = 1;
              _context3.n = 2;
              return fetch("".concat(this.authApiUrl, "/validate-token"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  token: token
                })
              });
            case 2:
              response = _context3.v;
              _context3.n = 3;
              return response.json();
            case 3:
              result = _context3.v;
              if (response.ok && result.isAuthenticated) {
                this.setAuthData(token, {
                  userId: result.userId,
                  email: result.email,
                  phoneNumber: result.phoneNumber
                });
                console.log('✅ Токен валиден, пользователь авторизован');
              } else {
                console.log('❌ Токен невалиден, очищаем данные');
                this.clearAuthData();
              }
              _context3.n = 5;
              break;
            case 4:
              _context3.p = 4;
              _t2 = _context3.v;
              console.error('❌ Ошибка при проверке токена:', _t2);
              this.clearAuthData();
            case 5:
              return _context3.a(2);
          }
        }, _callee3, this, [[1, 4]]);
      }));
      function checkStoredToken() {
        return _checkStoredToken.apply(this, arguments);
      }
      return checkStoredToken;
    }()
    /**
     * Устанавливает данные аутентификации
     */
    )
  }, {
    key: "setAuthData",
    value: function setAuthData(token, userData) {
      this.isAuthenticated = true;
      this.userData = userData;
      localStorage.setItem(this.tokenKey, token);
      localStorage.setItem(this.userDataKey, JSON.stringify(userData));

      // Устанавливаем токен в cookie для серверных запросов
      document.cookie = "auth_token=".concat(token, "; path=/; max-age=3600; samesite=strict");
      this.updateUI();
    }

    /**
     * Очищает данные аутентификации
     */
  }, {
    key: "clearAuthData",
    value: function clearAuthData() {
      this.isAuthenticated = false;
      this.userData = null;
      localStorage.removeItem(this.tokenKey);
      localStorage.removeItem(this.userDataKey);

      // Удаляем cookie
      document.cookie = 'auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
      this.updateUI();
    }

    /**
     * Выполняет выход из системы
     */
  }, {
    key: "logout",
    value: (function () {
      var _logout = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4() {
        var identityServerUrl;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.n) {
            case 0:
              this.clearAuthData();
              this.showNotification('Вы вышли из системы', 'info');

              // Перенаправляем на страницу входа IdentityServer
              identityServerUrl = window.location.protocol + '//' + window.location.hostname + ':55674';
              window.location.href = "".concat(identityServerUrl, "/Auth/Login");
            case 1:
              return _context4.a(2);
          }
        }, _callee4, this);
      }));
      function logout() {
        return _logout.apply(this, arguments);
      }
      return logout;
    }()
    /**
     * Получает токен для API запросов
     */
    )
  }, {
    key: "getAuthToken",
    value: function getAuthToken() {
      return localStorage.getItem(this.tokenKey);
    }

    /**
     * Создает заголовки для авторизованных запросов
     */
  }, {
    key: "getAuthHeaders",
    value: function getAuthHeaders() {
      var token = this.getAuthToken();
      return token ? {
        'Authorization': "Bearer ".concat(token)
      } : {};
    }

    /**
     * Обновляет UI в зависимости от состояния авторизации
     */
  }, {
    key: "updateUI",
    value: function updateUI() {
      var _this = this;
      // Показываем/скрываем элементы для авторизованных пользователей
      var authElements = document.querySelectorAll('[data-auth-required]');
      var guestElements = document.querySelectorAll('[data-guest-only]');
      authElements.forEach(function (element) {
        element.style.display = _this.isAuthenticated ? 'block' : 'none';
      });
      guestElements.forEach(function (element) {
        element.style.display = _this.isAuthenticated ? 'none' : 'block';
      });

      // Обновляем информацию о пользователе
      if (this.isAuthenticated && this.userData) {
        var userEmailElements = document.querySelectorAll('[data-user-email]');
        userEmailElements.forEach(function (element) {
          element.textContent = _this.userData.email;
        });
      }

      // Обновляем состояние кнопок
      var loginButtons = document.querySelectorAll('[data-login-btn]');
      var logoutButtons = document.querySelectorAll('[data-logout-btn]');
      loginButtons.forEach(function (btn) {
        btn.style.display = _this.isAuthenticated ? 'none' : 'inline-block';
      });
      logoutButtons.forEach(function (btn) {
        btn.style.display = _this.isAuthenticated ? 'inline-block' : 'none';
        btn.onclick = function () {
          return _this.logout();
        };
      });

      // Генерируем кастомное событие для других скриптов
      var authEvent = new CustomEvent('authStateChanged', {
        detail: {
          isAuthenticated: this.isAuthenticated,
          userData: this.userData
        }
      });
      document.dispatchEvent(authEvent);
      console.log("\u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u044F \u0441\u043E\u0431\u044B\u0442\u0438\u044F");
    }

    /**
     * Удаляет код аутентификации из URL
     */
  }, {
    key: "clearAuthCodeFromUrl",
    value: function clearAuthCodeFromUrl() {
      var url = new URL(window.location);
      url.searchParams["delete"]('auth');
      window.history.replaceState(null, '', url);
    }

    /**
     * Показывает уведомление пользователю
     */
  }, {
    key: "showNotification",
    value: function showNotification(message) {
      var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'info';
      // Создаем простое уведомление
      var notification = document.createElement('div');
      notification.className = "notification notification-".concat(type);
      notification.textContent = message;
      notification.style.cssText = "\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 4px;\n            color: white;\n            z-index: 10000;\n            font-weight: 500;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n            ".concat(type === 'success' ? 'background-color: #10B981;' : '', "\n            ").concat(type === 'error' ? 'background-color: #EF4444;' : '', "\n            ").concat(type === 'info' ? 'background-color: #3B82F6;' : '', "\n        ");
      document.body.appendChild(notification);

      // Автоматически удаляем через 5 секунд
      setTimeout(function () {
        notification.remove();
      }, 5000);

      // Добавляем возможность закрытия по клику
      notification.onclick = function () {
        return notification.remove();
      };
    }
  }]);
}(); // Глобальный экземпляр менеджера аутентификации
window.authManager = new AuthManager();

// Полезные глобальные функции
window.isAuthenticated = function () {
  return window.authManager.isAuthenticated;
};
window.getCurrentUser = function () {
  return window.authManager.userData;
};
window.logout = function () {
  return window.authManager.logout();
};

/***/ }),

/***/ "./wwwroot/js/Modal.js":
/*!*****************************!*\
  !*** ./wwwroot/js/Modal.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Modal: () => (/* binding */ Modal)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var Modal = /*#__PURE__*/function () {
  function Modal() {
    _classCallCheck(this, Modal);
    this.OpenModal();
    this.CloseModal();
    this.CloseModalOnOutsideClick();
  }
  return _createClass(Modal, [{
    key: "OpenModal",
    value: function OpenModal() {
      document.querySelectorAll('[data-modal="open"]').forEach(function (modalCall) {
        modalCall.addEventListener('click', function () {
          document.querySelector('.modal-overview').classList.add('active');
        });
      });
    }
  }, {
    key: "CloseModal",
    value: function CloseModal() {
      var crossModal = document.querySelectorAll('.modal-close');
      crossModal.forEach(function (cross) {
        cross.addEventListener('click', function () {
          cross.closest('.modal-overview').classList.remove('active');
        });
      });
    }
  }, {
    key: "CloseModalOnOutsideClick",
    value: function CloseModalOnOutsideClick() {
      var modalOverview = document.querySelector('.modal-overview');
      modalOverview.addEventListener('click', function (event) {
        if (!event.target.classList.contains('modal-content-wrapper') && event.target.closest('.modal-content-wrapper') == null) {
          modalOverview.classList.remove('active');
        }
      });
    }
  }], [{
    key: "ShowNotification",
    value: function ShowNotification(text, color) {
      var notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = text;
      notification.style.backgroundColor = color;

      // Добавляем уведомление в документ
      document.body.appendChild(notification);

      // Через 2 секунды удаляем уведомление
      setTimeout(function () {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 2000);
    }
  }]);
}();
document.addEventListener('DOMContentLoaded', function () {
  new Modal();
});

/***/ }),

/***/ "./wwwroot/js/UserProfile.js":
/*!***********************************!*\
  !*** ./wwwroot/js/UserProfile.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _UserValidator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./UserValidator.js */ "./wwwroot/js/UserValidator.js");
/* harmony import */ var _Modal_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Modal.js */ "./wwwroot/js/Modal.js");
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }


var UserProfile = /*#__PURE__*/function () {
  function UserProfile() {
    _classCallCheck(this, UserProfile);
    this.userApiAddress = 'http://localhost:55680';
    this.validator = new _UserValidator_js__WEBPACK_IMPORTED_MODULE_0__.UserValidator();
  }
  return _createClass(UserProfile, [{
    key: "GetUserById",
    value: function () {
      var _GetUserById = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(userId) {
        var response, data, _t, _t2, _t3;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              _context.p = 0;
              _context.n = 1;
              return fetch("".concat(this.userApiAddress, "/api/Users/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context.v;
              if (response.ok) {
                _context.n = 3;
                break;
              }
              _t = Error;
              _context.n = 2;
              return response.text();
            case 2:
              _t2 = _context.v;
              throw new _t(_t2);
            case 3:
              _context.n = 4;
              return response.json();
            case 4:
              data = _context.v;
              console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(userId, ":"), data);
              return _context.a(2, data);
            case 5:
              _context.p = 5;
              _t3 = _context.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), _t3);
            case 6:
              return _context.a(2);
          }
        }, _callee, this, [[0, 5]]);
      }));
      function GetUserById(_x) {
        return _GetUserById.apply(this, arguments);
      }
      return GetUserById;
    }()
  }, {
    key: "GetCarsByUserId",
    value: function () {
      var _GetCarsByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(userId) {
        var response, data, _t4, _t5, _t6;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              _context2.p = 0;
              _context2.n = 1;
              return fetch("".concat(this.userApiAddress, "/api/Cars/by-user/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context2.v;
              if (response.ok) {
                _context2.n = 3;
                break;
              }
              _t4 = Error;
              _context2.n = 2;
              return response.text();
            case 2:
              _t5 = _context2.v;
              throw new _t4(_t5);
            case 3:
              _context2.n = 4;
              return response.json();
            case 4:
              data = _context2.v;
              console.log("\u0410\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), data);
              return _context2.a(2, data);
            case 5:
              _context2.p = 5;
              _t6 = _context2.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0430\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u0435\u0439 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), _t6);
            case 6:
              return _context2.a(2);
          }
        }, _callee2, this, [[0, 5]]);
      }));
      function GetCarsByUserId(_x2) {
        return _GetCarsByUserId.apply(this, arguments);
      }
      return GetCarsByUserId;
    }()
  }, {
    key: "InsertUserDataToCardOnMainPage",
    value: function () {
      var _InsertUserDataToCardOnMainPage = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(userId) {
        var userIdLinks, _t7;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              userIdLinks = document.querySelectorAll('a[data-user-id]');
              userIdLinks.forEach(function (element) {
                var link = element.href;
                element.href += userId;
              });
              _context3.p = 1;
              _context3.n = 2;
              return this.GetUserById(userId).then(function (user) {
                var fullName = document.querySelector('[data-user-fullname]');
                var phone = document.querySelector('[data-user-phone]');
                var carsCount = document.querySelector('[data-user-carslist]');
                fullName.textContent = "".concat(user.firstName, " ").concat(user.lastName, " ").concat(user.patronymic);
                phone.textContent = user.phoneNumber;
                if (user.cars.length == 0) {
                  carsCount.remove();
                } else if (user.cars.length == 1) {
                  var car = user.cars[0];
                  carsCount.textContent = "".concat(car.color, " ").concat(car.mark, " ").concat(car.model, ", ").concat(car.number);
                } else {
                  carsCount.textContent = "".concat(user.cars.length, " \u043C\u0430\u0448\u0438\u043D\u044B");
                }
              })["catch"](function (error) {
                console.error('Ошибка получения данных пользователя:', error);
              });
            case 2:
              _context3.n = 4;
              break;
            case 3:
              _context3.p = 3;
              _t7 = _context3.v;
              console.log(_t7);
            case 4:
              return _context3.a(2);
          }
        }, _callee3, this, [[1, 3]]);
      }));
      function InsertUserDataToCardOnMainPage(_x3) {
        return _InsertUserDataToCardOnMainPage.apply(this, arguments);
      }
      return InsertUserDataToCardOnMainPage;
    }()
  }, {
    key: "InsertCarsToUserProfile",
    value: function () {
      var _InsertCarsToUserProfile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(userId) {
        var _this = this;
        var cars, carsContainer;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.n) {
            case 0:
              _context4.n = 1;
              return this.GetCarsByUserId(userId);
            case 1:
              cars = _context4.v;
              carsContainer = document.querySelector('.profile-group[data-group="cars"] .cars-list');
              carsContainer.innerHTML = '';
              cars.forEach(function (car) {
                _this.SetUserCar(car, carsContainer);
              });
            case 2:
              return _context4.a(2);
          }
        }, _callee4, this);
      }));
      function InsertCarsToUserProfile(_x4) {
        return _InsertCarsToUserProfile.apply(this, arguments);
      }
      return InsertCarsToUserProfile;
    }()
  }, {
    key: "InsertUserDataToProfile",
    value: function () {
      var _InsertUserDataToProfile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(userId) {
        var _t8;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.p = _context5.n) {
            case 0:
              _context5.p = 0;
              _context5.n = 1;
              return this.GetUserById(userId).then(function (user) {
                var setValue = function setValue(id, value) {
                  var element = document.getElementById(id);
                  if (element) {
                    // Специальная обработка для даты рождения
                    if (id === 'birthday' && value) {
                      // Преобразуем ISO строку в формат YYYY-MM-DD
                      var date = new Date(value);
                      var year = date.getFullYear();
                      var month = String(date.getMonth() + 1).padStart(2, '0');
                      var day = String(date.getDate()).padStart(2, '0');
                      element.value = "".concat(year, "-").concat(month, "-").concat(day);
                    } else {
                      element.value = value !== null && value !== '' ? value : '';
                    }
                  }
                };
                setValue('firstName', user.firstName);
                setValue('lastName', user.lastName);
                setValue('patronymic', user.patronymic);
                setValue('birthday', user.birthday);
                setValue('phoneNumber', user.phoneNumber);
                setValue('email', user.email);
              })["catch"](function (error) {
                console.error('Ошибка получения данных пользователя:', error);
              });
            case 1:
              _context5.n = 2;
              return this.InsertCarsToUserProfile(userId);
            case 2:
              _context5.n = 4;
              break;
            case 3:
              _context5.p = 3;
              _t8 = _context5.v;
              console.log(_t8);
            case 4:
              return _context5.a(2);
          }
        }, _callee5, this, [[0, 3]]);
      }));
      function InsertUserDataToProfile(_x5) {
        return _InsertUserDataToProfile.apply(this, arguments);
      }
      return InsertUserDataToProfile;
    }()
  }, {
    key: "SetCarTemplate",
    value: function SetCarTemplate(car) {
      var buttonDelCar = "\n        <div class=\"remove-car\" data-action=\"remove-car-from-user\" data-car-id=\"".concat(car.id, "\" title=\"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u0430\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u044C\">\n            &#10060;\n        </div>");
      var disabledOrNot = 'disabled';
      if (!Object.keys(car).length) {
        car.id = '';
        car.mark = '';
        car.model = '';
        car.color = '';
        car.number = '';
        car.userId = window.authManager.userData.userId;
        buttonDelCar = '';
        disabledOrNot = '';
      }
      var carTemplate = "\n            <div class=\"car\" data-car-id=\"".concat(car.id, "\">\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"mark\" id=\"mark-").concat(car.id, "\" value=\"").concat(car.mark, "\" />\n                    <label for=\"mark-").concat(car.id, "\">\u041C\u0430\u0440\u043A\u0430</label>\n                    <div class=\"error invisible\" data-error=\"mark\">\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043C\u0430\u0440\u043A\u0430 \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"model\" id=\"model-").concat(car.id, "\" value=\"").concat(car.model, "\" />\n                    <label for=\"model-").concat(car.id, "\">\u041C\u043E\u0434\u0435\u043B\u044C</label>\n                    <div class=\"error invisible\" data-error=\"model\">\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043C\u043E\u0434\u0435\u043B\u044C \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"color\" id=\"color-").concat(car.id, "\" value=\"").concat(car.color, "\" />\n                    <label for=\"color-").concat(car.id, "\">\u0426\u0432\u0435\u0442</label>\n                    <div class=\"error invisible\" data-error=\"color\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0446\u0432\u0435\u0442 \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"number\" id=\"number-").concat(car.id, "\" value=\"").concat(car.number, "\" />\n                    <label for=\"number-").concat(car.id, "\">\u041D\u043E\u043C\u0435\u0440</label>\n                    <div class=\"error invisible\" data-error=\"number\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                ").concat(buttonDelCar, "\n            </div>\n        ");
      return carTemplate;
    }
  }, {
    key: "SetUserCar",
    value: function SetUserCar(car, carsList) {
      var carTemplate = this.SetCarTemplate(car);
      if (carsList) {
        carsList.insertAdjacentHTML('beforeend', carTemplate);
      }
    }
  }, {
    key: "CollectUserDataFromProfile",
    value: function CollectUserDataFromProfile() {
      var userData = {};

      //Собираем данные по пользователю
      var userProfileInputs = document.querySelectorAll('.profile-group[data-group="user"] input');
      userProfileInputs.forEach(function (input) {
        var inputKey = input.id;
        var inputValue = input.value;

        // Обработка даты рождения
        if (inputKey === 'birthday' && inputValue) {
          // Преобразуем дату в формат ISO с UTC
          var date = new Date(inputValue);
          // Устанавливаем время в 00:00:00 и конвертируем в UTC
          date.setHours(0, 0, 0, 0);
          inputValue = date.toISOString();
        }
        userData[inputKey] = inputValue;
      });
      return userData;
    }
  }, {
    key: "CollectCarsDataFromProfile",
    value: function CollectCarsDataFromProfile() {
      var carsData = [];

      // собираем данные по машинам из профиля
      var cars = document.querySelectorAll('.profile-group[data-group="cars"] .car');
      cars.forEach(function (car) {
        var _car$querySelector, _car$querySelector2, _car$querySelector3, _car$querySelector4;
        var carData = {
          id: car.dataset.carId || '',
          mark: ((_car$querySelector = car.querySelector('input[name="mark"]')) === null || _car$querySelector === void 0 ? void 0 : _car$querySelector.value) || '',
          model: ((_car$querySelector2 = car.querySelector('input[name="model"]')) === null || _car$querySelector2 === void 0 ? void 0 : _car$querySelector2.value) || '',
          color: ((_car$querySelector3 = car.querySelector('input[name="color"]')) === null || _car$querySelector3 === void 0 ? void 0 : _car$querySelector3.value) || '',
          number: ((_car$querySelector4 = car.querySelector('input[name="number"]')) === null || _car$querySelector4 === void 0 ? void 0 : _car$querySelector4.value) || '',
          userId: window.authManager.userData.userId
        };
        carsData.push(carData);
      });
      return carsData;
    }
  }, {
    key: "CollectCarsDataFromModal",
    value: function CollectCarsDataFromModal() {
      var carData = {};

      // собираем данные по машинам
      var cars = document.querySelectorAll('.car-modal .car');
      cars.forEach(function (car) {
        var _car$querySelector5, _car$querySelector6, _car$querySelector7, _car$querySelector8;
        carData = {
          mark: ((_car$querySelector5 = car.querySelector('input[name="mark"]')) === null || _car$querySelector5 === void 0 ? void 0 : _car$querySelector5.value) || '',
          model: ((_car$querySelector6 = car.querySelector('input[name="model"]')) === null || _car$querySelector6 === void 0 ? void 0 : _car$querySelector6.value) || '',
          color: ((_car$querySelector7 = car.querySelector('input[name="color"]')) === null || _car$querySelector7 === void 0 ? void 0 : _car$querySelector7.value) || '',
          number: ((_car$querySelector8 = car.querySelector('input[name="number"]')) === null || _car$querySelector8 === void 0 ? void 0 : _car$querySelector8.value) || '',
          userId: window.authManager.userData.userId
        };
      });
      console.log("\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C\u044B\u0435 \u043C\u0430\u0448\u0438\u043D\u044B:");
      console.log(carData);
      return carData;
    }
  }, {
    key: "ShowValidationErrors",
    value: function ShowValidationErrors(errors) {
      // Очищаем все предыдущие ошибки
      document.querySelectorAll('.error').forEach(function (error) {
        error.classList.add('invisible');
      });

      // Показываем ошибки пользователя
      if (errors.user) {
        Object.keys(errors.user).forEach(function (field) {
          var errorElement = document.querySelector("[data-error=\"".concat(field, "\"]"));
          if (errorElement) {
            errorElement.textContent = errors.user[field];
            errorElement.classList.remove('invisible');
          }
        });
      }

      // Показываем ошибки автомобилей
      if (errors.cars && errors.cars.length > 0) {
        errors.cars.forEach(function (carErrors, index) {
          Object.keys(carErrors).forEach(function (field) {
            var errorElement = document.querySelector(".profile-group[data-group=\"cars\"] .car:nth-child(".concat(index + 1, ") [data-error=\"").concat(field, "\"]"));
            if (errorElement) {
              errorElement.textContent = carErrors[field];
              errorElement.classList.remove('invisible');
            }
          });
        });
      }
    }
  }, {
    key: "UpdateUserToDB",
    value: function () {
      var _UpdateUserToDB = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(id, userData) {
        var validation, carsData, carsValidation, allErrors, response, _t9, _t0, _t1;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.p = _context6.n) {
            case 0:
              _context6.p = 0;
              // Валидация данных пользователя
              validation = this.validator.validateUserData(userData); // Собираем данные автомобилей для валидации
              carsData = this.CollectCarsDataFromProfile(); // Валидация автомобилей
              carsValidation = this.ValidateCarsData(carsData); // Объединяем ошибки
              allErrors = {
                user: validation.errors.user,
                cars: carsValidation.errors
              };
              if (!(!validation.isValid || !carsValidation.isValid)) {
                _context6.n = 1;
                break;
              }
              this.ShowValidationErrors(allErrors);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Исправьте ошибки в форме', 'red');
              return _context6.a(2);
            case 1:
              // Если валидация прошла успешно, очищаем ошибки
              document.querySelectorAll('.error').forEach(function (error) {
                error.classList.add('invisible');
              });
              _context6.n = 2;
              return fetch("".concat(this.userApiAddress, "/api/Users/").concat(id), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(_objectSpread(_objectSpread({}, userData), {}, {
                  id: id
                }))
              });
            case 2:
              response = _context6.v;
              if (response.ok) {
                _context6.n = 4;
                break;
              }
              _t9 = Error;
              _context6.n = 3;
              return response.text();
            case 3:
              _t0 = _context6.v;
              throw new _t9(_t0);
            case 4:
              console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(id, " \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D"));
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Данные пользователя сохранены', 'green');
              _context6.n = 6;
              break;
            case 5:
              _context6.p = 5;
              _t1 = _context6.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(id, ":"), _t1);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка сохранения данных', 'red');
            case 6:
              return _context6.a(2);
          }
        }, _callee6, this, [[0, 5]]);
      }));
      function UpdateUserToDB(_x6, _x7) {
        return _UpdateUserToDB.apply(this, arguments);
      }
      return UpdateUserToDB;
    }()
  }, {
    key: "ValidateCarsData",
    value: function ValidateCarsData(carsData) {
      var _this2 = this;
      var errors = [];
      var isValid = true;
      carsData.forEach(function (car) {
        var carValidation = _this2.validator.validateCar(car);
        if (!carValidation.isValid) {
          errors.push(carValidation.errors);
          isValid = false;
        } else {
          errors.push({});
        }
      });

      // Проверка уникальности номеров
      var duplicateIndices = this.validator.validateUniqueCarNumbers(carsData);
      if (duplicateIndices.length > 0) {
        duplicateIndices.forEach(function (index) {
          if (!errors[index]) errors[index] = {};
          errors[index].number = 'Номер автомобиля уже существует';
          isValid = false;
        });
      }
      return {
        isValid: isValid,
        errors: errors
      };
    }
  }, {
    key: "ValidateCarInModal",
    value: function ValidateCarInModal() {
      var carData = this.CollectCarsDataFromModal();
      var validation = this.validator.validateCar(carData);

      // Очищаем ошибки в модальном окне
      document.querySelectorAll('.car-modal .error').forEach(function (error) {
        error.classList.add('invisible');
      });
      if (!validation.isValid) {
        Object.keys(validation.errors).forEach(function (field) {
          var errorElement = document.querySelector(".car-modal [data-error=\"".concat(field, "\"]"));
          if (errorElement) {
            errorElement.textContent = validation.errors[field];
            errorElement.classList.remove('invisible');
          }
        });
        return false;
      }
      return true;
    }
  }, {
    key: "AddCarToUser",
    value: function () {
      var _AddCarToUser = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(userId) {
        var response, data, _t10, _t11, _t12;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.p = _context7.n) {
            case 0:
              if (this.ValidateCarInModal()) {
                _context7.n = 1;
                break;
              }
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Исправьте ошибки в форме автомобиля', 'red');
              return _context7.a(2);
            case 1:
              _context7.p = 1;
              _context7.n = 2;
              return fetch("".concat(this.userApiAddress, "/api/Cars"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(this.CollectCarsDataFromModal())
              });
            case 2:
              response = _context7.v;
              if (response.ok) {
                _context7.n = 4;
                break;
              }
              _t10 = Error;
              _context7.n = 3;
              return response.text();
            case 3:
              _t11 = _context7.v;
              throw new _t10(_t11);
            case 4:
              _context7.n = 5;
              return response.json();
            case 5:
              data = _context7.v;
              console.log('Автомобиль создан:', data);

              //инсертим автомобиль в список
              _context7.n = 6;
              return this.InsertCarsToUserProfile(userId);
            case 6:
              //зачищаем модалку и закрываем её
              document.querySelectorAll('.car-modal input').forEach(function (input) {
                input.value = '';
              });
              document.querySelector('.car-modal').closest('.modal-overview').classList.remove('active');
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Автомобиль успешно добавлен', 'green');
              return _context7.a(2, data);
            case 7:
              _context7.p = 7;
              _t12 = _context7.v;
              console.error('Ошибка создания автомобиля:', _t12);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка добавления автомобиля', 'red');
            case 8:
              return _context7.a(2);
          }
        }, _callee7, this, [[1, 7]]);
      }));
      function AddCarToUser(_x8) {
        return _AddCarToUser.apply(this, arguments);
      }
      return AddCarToUser;
    }()
  }, {
    key: "RemoveCarFromUser",
    value: function () {
      var _RemoveCarFromUser = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(carId) {
        var response, _t13, _t14, _t15;
        return _regenerator().w(function (_context8) {
          while (1) switch (_context8.p = _context8.n) {
            case 0:
              _context8.p = 0;
              _context8.n = 1;
              return fetch("".concat(this.userApiAddress, "/api/Cars/").concat(carId), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context8.v;
              if (response.ok) {
                _context8.n = 3;
                break;
              }
              _t13 = Error;
              _context8.n = 2;
              return response.text();
            case 2:
              _t14 = _context8.v;
              throw new _t13(_t14);
            case 3:
              console.log("\u0410\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u044C ".concat(carId, " \u0443\u0434\u0430\u043B\u0451\u043D"));
              //удоляем строку с отображением авто из профиля
              document.querySelector(".profile-group .car[data-car-id=\"".concat(carId, "\"]")).remove();
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Автомобиль успешно удалён', 'green');
              _context8.n = 5;
              break;
            case 4:
              _context8.p = 4;
              _t15 = _context8.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0430\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u044F ".concat(carId, ":"), _t15);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка удаления автомобиля', 'red');
            case 5:
              return _context8.a(2);
          }
        }, _callee8, this, [[0, 4]]);
      }));
      function RemoveCarFromUser(_x9) {
        return _RemoveCarFromUser.apply(this, arguments);
      }
      return RemoveCarFromUser;
    }()
  }]);
}();
document.addEventListener('authStateChanged', function () {
  var _event$detail = event.detail,
    isAuthenticated = _event$detail.isAuthenticated,
    userData = _event$detail.userData;
  if (isAuthenticated && userData) {
    var userProfile = new UserProfile();
    var userId = window.authManager.userData.userId;
    if (window.location.pathname == '/') {
      userProfile.InsertUserDataToCardOnMainPage(userId);
    }
    if (document.getElementById('user-profile')) {
      userProfile.InsertUserDataToProfile(userId);
      document.querySelector("[data-action=\"save-user-data\"]").addEventListener('click', function () {
        userProfile.UpdateUserToDB(window.authManager.userData.userId, userProfile.CollectUserDataFromProfile());
      });
      document.querySelector("[data-action=\"add-car-to-user\"]").addEventListener('click', function () {
        userProfile.AddCarToUser(window.authManager.userData.userId);
      });
      document.addEventListener('click', function (e) {
        if (e.target.dataset.action == 'remove-car-from-user') {
          var carId = e.target.dataset.carId;
          userProfile.RemoveCarFromUser(carId);
        }
      });
    }
  }
});

/***/ }),

/***/ "./wwwroot/js/UserValidator.js":
/*!*************************************!*\
  !*** ./wwwroot/js/UserValidator.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UserValidator: () => (/* binding */ UserValidator)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var UserValidator = /*#__PURE__*/function () {
  function UserValidator() {
    _classCallCheck(this, UserValidator);
    // Разрешенные буквы в российских номерах (совпадают с латинскими)
    this.allowedLetters = 'АВЕКМНОРСТУХ';

    // Коды регионов России
    this.validRegionCodes = [
    // Основные регионы
    '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '95', '96', '97', '98', '99',
    // Трёхзначные коды для крупных регионов
    '102', '113', '116', '117', '118', '119', '121', '122', '123', '124', '125', '126', '134', '136', '138', '142', '150', '152', '154', '159', '161', '163', '164', '173', '174', '177', '178', '186', '190', '196', '197', '198', '199', '702', '716', '750', '761', '763', '774', '777', '790', '799', '999'];

    // Запрещенные комбинации
    this.forbiddenCombinations = [/.*ХУ[ЙИ].*/, /.*БЛ[ЯА].*/, /.*П[ИИ]З.*/, /.*МУД.*/, /.*ГОВ.*/];
  }

  //Валидация имени/фамилии/отчества
  return _createClass(UserValidator, [{
    key: "validateName",
    value: function validateName(name, fieldName) {
      var required = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      if (!name || name.trim() === '') {
        if (required) {
          return {
            isValid: false,
            error: "".concat(fieldName, " \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F")
          };
        }
        return {
          isValid: true
        };
      }
      if (name.length > 50) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0434\u043B\u0438\u043D\u043D\u0435\u0435 50 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432")
        };
      }
      if (!/^[а-яё\s\-']+$/i.test(name)) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u0434\u043E\u043B\u0436\u043D\u043E \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u0442\u043E\u043B\u044C\u043A\u043E \u0440\u0443\u0441\u0441\u043A\u0438\u0435 \u0431\u0443\u043A\u0432\u044B, \u043F\u0440\u043E\u0431\u0435\u043B\u044B, \u0434\u0435\u0444\u0438\u0441\u044B \u0438 \u0430\u043F\u043E\u0441\u0442\u0440\u043E\u0444\u044B")
        };
      }

      // Проверка на слишком много пробелов подряд
      if (/\s{2,}/.test(name)) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0431\u0435\u043B\u043E\u0432 \u043F\u043E\u0434\u0440\u044F\u0434")
        };
      }

      // Проверка на пробелы в начале/конце
      if (name !== name.trim()) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u043D\u0430\u0447\u0438\u043D\u0430\u0442\u044C\u0441\u044F \u0438\u043B\u0438 \u0437\u0430\u043A\u0430\u043D\u0447\u0438\u0432\u0430\u0442\u044C\u0441\u044F \u043F\u0440\u043E\u0431\u0435\u043B\u043E\u043C")
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация даты рождения
     */
  }, {
    key: "validateBirthday",
    value: function validateBirthday(birthday) {
      if (!birthday) {
        return {
          isValid: true
        }; // Дата рождения необязательна
      }
      var birthDate = new Date(birthday);
      var today = new Date();
      var minDate = new Date(today.getFullYear() - 125, today.getMonth(), today.getDate());
      if (isNaN(birthDate.getTime())) {
        return {
          isValid: false,
          error: 'Неверный формат даты'
        };
      }
      if (birthDate > today) {
        return {
          isValid: false,
          error: 'Дата рождения не может быть в будущем'
        };
      }
      if (birthDate < minDate) {
        return {
          isValid: false,
          error: 'Дата рождения не может быть более 125 лет назад'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация номера телефона
     */
  }, {
    key: "validatePhoneNumber",
    value: function validatePhoneNumber(phone) {
      if (!phone || phone.trim() === '') {
        return {
          isValid: false,
          error: 'Номер телефона обязателен для заполнения'
        };
      }

      // Убираем все символы кроме цифр и +
      var cleanPhone = phone.replace(/[\s\-\(\)]/g, '');

      // Различные форматы российских номеров
      var phonePatterns = [/^(\+7|8)\d{10}$/,
      // +7XXXXXXXXXX или 8XXXXXXXXXX
      /^\+7\d{10}$/,
      // +7XXXXXXXXXX
      /^8\d{10}$/,
      // 8XXXXXXXXXX
      /^7\d{10}$/ // 7XXXXXXXXXX
      ];
      var isValidFormat = false;
      for (var _i = 0, _phonePatterns = phonePatterns; _i < _phonePatterns.length; _i++) {
        var pattern = _phonePatterns[_i];
        if (pattern.test(cleanPhone)) {
          isValidFormat = true;
          break;
        }
      }
      if (!isValidFormat) {
        return {
          isValid: false,
          error: 'Неверный формат номера телефона. Используйте российский формат'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация email
     */
  }, {
    key: "validateEmail",
    value: function validateEmail(email) {
      if (!email || email.trim() === '') {
        return {
          isValid: false,
          error: 'Email обязателен для заполнения'
        };
      }
      if (email.length > 100) {
        return {
          isValid: false,
          error: 'Email не может быть длиннее 100 символов'
        };
      }
      var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      if (!emailRegex.test(email)) {
        return {
          isValid: false,
          error: 'Неверный формат email'
        };
      }

      // Проверка на запрещенные символы в локальной части
      var localPart = email.split('@')[0];
      if (localPart.startsWith('.') || localPart.endsWith('.') || localPart.includes('..')) {
        return {
          isValid: false,
          error: 'Неверный формат email'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация номера автомобиля
     */
  }, {
    key: "validateCarNumber",
    value: function validateCarNumber(number) {
      if (!number || number.trim() === '') {
        return {
          isValid: false,
          error: 'Номер автомобиля обязателен'
        };
      }
      var cleanNumber = number.replace(/[\s\-]/g, '').toUpperCase();

      // Проверка длины
      if (cleanNumber.length < 8 || cleanNumber.length > 9) {
        return {
          isValid: false,
          error: 'Неверная длина номера (должно быть 8-9 символов)'
        };
      }

      // Различные форматы российских номеров
      var patterns = [{
        pattern: /^[АВЕКМНОРСТУХ]\d{3}[АВЕКМНОРСТУХ]{2}\d{2,3}$/,
        type: 'стандартный'
      }, {
        pattern: /^[АВЕКМНОРСТУХ]{2}\d{3}[АВЕКМНОРСТУХ]\d{2,3}$/,
        type: 'такси'
      }, {
        pattern: /^[АВЕКМНОРСТУХ]{2}\d{4}\d{2,3}$/,
        type: 'прицеп'
      }, {
        pattern: /^\d{4}[АВЕКМНОРСТУХ]{2}\d{2,3}$/,
        type: 'мотоцикл'
      }, {
        pattern: /^Т\d{3}[АВЕКМНОРСТУХ]{2}\d{2,3}$/,
        type: 'транзит'
      }];
      var isValidFormat = false;
      for (var _i2 = 0, _patterns = patterns; _i2 < _patterns.length; _i2++) {
        var pattern = _patterns[_i2].pattern;
        if (pattern.test(cleanNumber)) {
          isValidFormat = true;
          break;
        }
      }
      if (!isValidFormat) {
        return {
          isValid: false,
          error: 'Неверный формат российского номера'
        };
      }

      // Проверка кода региона
      var regionCode = cleanNumber.slice(-3);
      var twoDigitCode = regionCode.slice(-2);
      var threeDigitCode = regionCode;
      if (!this.validRegionCodes.includes(twoDigitCode) && !this.validRegionCodes.includes(threeDigitCode)) {
        return {
          isValid: false,
          error: 'Неверный код региона'
        };
      }

      // Проверка на запрещенные комбинации
      var _iterator = _createForOfIteratorHelper(this.forbiddenCombinations),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var forbidden = _step.value;
          if (forbidden.test(cleanNumber)) {
            return {
              isValid: false,
              error: 'Недопустимая комбинация символов в номере'
            };
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация марки/модели автомобиля
     */
  }, {
    key: "validateCarBrand",
    value: function validateCarBrand(value, fieldName) {
      if (!value || value.trim() === '') {
        return {
          isValid: true
        }; // Необязательное поле
      }
      if (value.length > 100) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0434\u043B\u0438\u043D\u043D\u0435\u0435 100 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432")
        };
      }
      if (!/^[а-яёa-z0-9\s\-._]+$/i.test(value)) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u0434\u043E\u043B\u0436\u043D\u0430 \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u0442\u043E\u043B\u044C\u043A\u043E \u0431\u0443\u043A\u0432\u044B, \u0446\u0438\u0444\u0440\u044B, \u043F\u0440\u043E\u0431\u0435\u043B\u044B, \u0434\u0435\u0444\u0438\u0441\u044B, \u0442\u043E\u0447\u043A\u0438 \u0438 \u043F\u043E\u0434\u0447\u0435\u0440\u043A\u0438\u0432\u0430\u043D\u0438\u044F")
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация цвета автомобиля
     */
  }, {
    key: "validateCarColor",
    value: function validateCarColor(color) {
      if (!color || color.trim() === '') {
        return {
          isValid: true
        }; // Необязательное поле
      }
      if (color.length > 50) {
        return {
          isValid: false,
          error: 'Цвет не может быть длиннее 50 символов'
        };
      }
      if (!/^[а-яёa-z\s\-]+$/i.test(color)) {
        return {
          isValid: false,
          error: 'Цвет должен содержать только буквы, пробелы и дефисы'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация одного автомобиля
     */
  }, {
    key: "validateCar",
    value: function validateCar(car) {
      var errors = {};
      var isValid = true;

      // Валидация марки
      var markValidation = this.validateCarBrand(car.mark, 'Марка');
      if (!markValidation.isValid) {
        errors.mark = markValidation.error;
        isValid = false;
      }

      // Валидация модели
      var modelValidation = this.validateCarBrand(car.model, 'Модель');
      if (!modelValidation.isValid) {
        errors.model = modelValidation.error;
        isValid = false;
      }

      // Валидация цвета
      var colorValidation = this.validateCarColor(car.color);
      if (!colorValidation.isValid) {
        errors.color = colorValidation.error;
        isValid = false;
      }

      // Валидация номера
      var numberValidation = this.validateCarNumber(car.number);
      if (!numberValidation.isValid) {
        errors.number = numberValidation.error;
        isValid = false;
      }
      return {
        isValid: isValid,
        errors: errors
      };
    }

    /**
     * Проверка уникальности номеров автомобилей
     */
  }, {
    key: "validateUniqueCarNumbers",
    value: function validateUniqueCarNumbers(cars) {
      var numbers = cars.map(function (car) {
        var _car$number;
        return (_car$number = car.number) === null || _car$number === void 0 ? void 0 : _car$number.replace(/[\s\-]/g, '').toUpperCase();
      }).filter(Boolean);
      var duplicates = [];
      var seen = new Set();
      numbers.forEach(function (number, index) {
        if (seen.has(number)) {
          duplicates.push(index);
        } else {
          seen.add(number);
          // Также добавляем индекс первого вхождения дубликата
          var firstIndex = numbers.indexOf(number);
          if (firstIndex !== index && !duplicates.includes(firstIndex)) {
            duplicates.push(firstIndex);
          }
        }
      });
      return duplicates;
    }

    /**
     * Полная валидация данных пользователя
     */
  }, {
    key: "validateUserData",
    value: function validateUserData(userData) {
      var errors = {
        user: {},
        cars: []
      };
      var isValid = true;

      // Валидация данных пользователя
      var firstNameValidation = this.validateName(userData.firstName, 'Имя', true);
      if (!firstNameValidation.isValid) {
        errors.user.firstName = firstNameValidation.error;
        isValid = false;
      }
      var lastNameValidation = this.validateName(userData.lastName, 'Фамилия', true);
      if (!lastNameValidation.isValid) {
        errors.user.lastName = lastNameValidation.error;
        isValid = false;
      }
      var patronymicValidation = this.validateName(userData.patronymic, 'Отчество', false);
      if (!patronymicValidation.isValid) {
        errors.user.patronymic = patronymicValidation.error;
        isValid = false;
      }
      var birthdayValidation = this.validateBirthday(userData.birthday);
      if (!birthdayValidation.isValid) {
        errors.user.birthday = birthdayValidation.error;
        isValid = false;
      }
      var phoneValidation = this.validatePhoneNumber(userData.phoneNumber);
      if (!phoneValidation.isValid) {
        errors.user.phoneNumber = phoneValidation.error;
        isValid = false;
      }
      var emailValidation = this.validateEmail(userData.email);
      if (!emailValidation.isValid) {
        errors.user.email = emailValidation.error;
        isValid = false;
      }
      return {
        isValid: isValid,
        errors: errors
      };
    }

    /**
     * Форматирование номера автомобиля
     */
  }, {
    key: "formatCarNumber",
    value: function formatCarNumber(input) {
      var value = input.value.replace(/[^а-яёА-ЯЁ0-9ТтTt]/g, '').toUpperCase();

      // Заменяем русские буквы на допустимые
      var letterMap = {
        'А': 'А',
        'В': 'В',
        'Е': 'Е',
        'К': 'К',
        'М': 'М',
        'Н': 'Н',
        'О': 'О',
        'Р': 'Р',
        'С': 'С',
        'Т': 'Т',
        'У': 'У',
        'Х': 'Х',
        'T': 'Т' // Латинская T заменяется на русскую Т
      };
      value = value.split('').map(function (_char) {
        return letterMap[_char] || _char;
      }).join('');

      // Ограничиваем длину
      if (value.length > 9) {
        value = value.slice(0, 9);
      }
      input.value = value;
    }

    /**
     * Форматирование номера телефона
     */
  }, {
    key: "formatPhoneNumber",
    value: function formatPhoneNumber(input) {
      var value = input.value.replace(/\D/g, '');
      if (value.startsWith('8') && value.length > 1) {
        value = '7' + value.slice(1);
      }
      if (value.startsWith('7') && value.length <= 11) {
        var formatted = value.replace(/^7(\d{3})(\d{3})(\d{2})(\d{2})/, '+7 ($1) $2-$3-$4');
        input.value = formatted;
      } else if (value.length <= 10) {
        var _formatted = value.replace(/^(\d{3})(\d{3})(\d{2})(\d{2})/, '+7 ($1) $2-$3-$4');
        input.value = _formatted;
      }
    }
  }]);
}();

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	__webpack_require__("./wwwroot/js/UserValidator.js");
/******/ 	__webpack_require__("./wwwroot/js/UserProfile.js");
/******/ 	__webpack_require__("./wwwroot/js/Modal.js");
/******/ 	__webpack_require__("./wwwroot/js/AuthManager.js");
/******/ 	__webpack_require__("./wwwroot/js/ApartmentProfile.js");
/******/ 	__webpack_require__("./wwwroot/css/variables.css");
/******/ 	__webpack_require__("./wwwroot/css/profile-group.css");
/******/ 	__webpack_require__("./wwwroot/css/notification.css");
/******/ 	__webpack_require__("./wwwroot/css/modal.css");
/******/ 	__webpack_require__("./wwwroot/css/main.css");
/******/ 	__webpack_require__("./wwwroot/css/grid.css");
/******/ 	__webpack_require__("./wwwroot/css/card.css");
/******/ 	var __webpack_exports__ = __webpack_require__("./wwwroot/css/btn.css");
/******/ 	
/******/ })()
;
//# sourceMappingURL=app.js.map