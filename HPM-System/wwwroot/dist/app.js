/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./wwwroot/css/btn.css":
/*!*****************************!*\
  !*** ./wwwroot/css/btn.css ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/card.css":
/*!******************************!*\
  !*** ./wwwroot/css/card.css ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/file-manager.css":
/*!**************************************!*\
  !*** ./wwwroot/css/file-manager.css ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/fonts-colors-and-backgrounds.css":
/*!******************************************************!*\
  !*** ./wwwroot/css/fonts-colors-and-backgrounds.css ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/grid.css":
/*!******************************!*\
  !*** ./wwwroot/css/grid.css ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/house-and-apartments.css":
/*!**********************************************!*\
  !*** ./wwwroot/css/house-and-apartments.css ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/icons.css":
/*!*******************************!*\
  !*** ./wwwroot/css/icons.css ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/main.css":
/*!******************************!*\
  !*** ./wwwroot/css/main.css ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/modal.css":
/*!*******************************!*\
  !*** ./wwwroot/css/modal.css ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/multiselect.css":
/*!*************************************!*\
  !*** ./wwwroot/css/multiselect.css ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/notification.css":
/*!**************************************!*\
  !*** ./wwwroot/css/notification.css ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/profile-group.css":
/*!***************************************!*\
  !*** ./wwwroot/css/profile-group.css ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/css/variables.css":
/*!***********************************!*\
  !*** ./wwwroot/css/variables.css ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./wwwroot/js/ApartmentHouses.js":
/*!***************************************!*\
  !*** ./wwwroot/js/ApartmentHouses.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ApartmentHouses: () => (/* binding */ ApartmentHouses)
/* harmony export */ });
/* harmony import */ var _Modal_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Modal.js */ "./wwwroot/js/Modal.js");
/* harmony import */ var _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./HouseValidator.js */ "./wwwroot/js/HouseValidator.js");
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }


var ApartmentHouses = /*#__PURE__*/function () {
  function ApartmentHouses() {
    _classCallCheck(this, ApartmentHouses);
    this.ApartmentAPIAddress = 'https://localhost:55683';
  }
  return _createClass(ApartmentHouses, [{
    key: "InsertHouseDataById",
    value: function () {
      var _InsertHouseDataById = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(id) {
        var _this = this;
        var house, headOfHouse, houseUsers, _t;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              _context.p = 0;
              _context.n = 1;
              return this.GetHouse(id);
            case 1:
              house = _context.v;
              console.log("\u0434\u043E\u043C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F");
              console.log(house);
              _context.n = 2;
              return this.GetHead(house.id);
            case 2:
              headOfHouse = _context.v;
              _context.n = 3;
              return this.GetHouseOwnersWithApartments(id);
            case 3:
              houseUsers = _context.v;
              document.getElementById('city').value = house.city;
              document.getElementById('street').value = house.street;
              document.getElementById('number').value = house.number;
              document.getElementById('postIndex').value = house.postIndex;
              document.getElementById('floors').value = house.floors;
              document.getElementById('entrances').value = house.entrances;
              document.getElementById('totalArea').value = house.totalArea;
              document.getElementById('apartmentsArea').value = house.apartmentsArea;
              document.getElementById('landArea').value = house.landArea;
              document.getElementById('isApartmentBuilding').checked = house.isApartmentBuilding;
              document.getElementById('hasGas').checked = house.hasGas;
              document.getElementById('hasElectricity').checked = house.hasElectricity;
              document.getElementById('hasElevator').checked = house.hasElevator;
              document.getElementById('builtYear').value = house.builtYear;
              houseUsers.forEach(function (user) {
                var option = document.createElement('option');
                option.value = user.userId;
                option.textContent = "".concat(user.fullName, ", \u043A\u0432. ").concat(user.apartmentNumbers[0], " ");
                document.getElementById('houseHead').appendChild(option);
              });

              //сохранение данных профиля дома
              document.querySelector('[data-action="save-house-data"]').addEventListener('click', function () {
                console.log("\u043A\u043B\u0438\u043A \u043F\u043E \u043A\u043D\u043E\u043F\u043A\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0434\u043E\u043C\u0430");
                _this.CollectHouseDataAndUpdateProfile();
              });
              _context.n = 5;
              break;
            case 4:
              _context.p = 4;
              _t = _context.v;
              console.error('Ошибка при загрузке данных дома:', _t);
            case 5:
              return _context.a(2);
          }
        }, _callee, this, [[0, 4]]);
      }));
      function InsertHouseDataById(_x) {
        return _InsertHouseDataById.apply(this, arguments);
      }
      return InsertHouseDataById;
    }()
  }, {
    key: "InsertApartmentsInHouseDetails",
    value: function () {
      var _InsertApartmentsInHouseDetails = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(houseId) {
        var _this2 = this;
        var apartments, apartmentsContainerList;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.n) {
            case 0:
              _context2.n = 1;
              return this.GetApartmentsByHouseId(houseId);
            case 1:
              apartments = _context2.v;
              apartmentsContainerList = document.querySelector('[data-group="AllApartmentsInHouse"] .apartments-list');
              apartments.forEach(function (apartment) {
                var apartmentTemplate = _this2.ApartmentToHouseTemplate(apartment);
                apartmentsContainerList.insertAdjacentHTML('beforeend', apartmentTemplate);
              });
            case 2:
              return _context2.a(2);
          }
        }, _callee2, this);
      }));
      function InsertApartmentsInHouseDetails(_x2) {
        return _InsertApartmentsInHouseDetails.apply(this, arguments);
      }
      return InsertApartmentsInHouseDetails;
    }() //Вставить данные о домах пользователя в карточку
  }, {
    key: "InsertHouseDataByUserId",
    value: function () {
      var _InsertHouseDataByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(userId, housesListClass, template) {
        var houses, housesListContainer, _iterator, _step, house, headOfHouse, headTemplate, managementCompanyTemplate, houseTemplate, _t2, _t3;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              _context3.p = 0;
              _context3.n = 1;
              return this.GetHousesByUserId(userId);
            case 1:
              houses = _context3.v;
              console.log("\u0434\u043E\u043C\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F:", houses);
              housesListContainer = document.querySelector(housesListClass);
              housesListContainer.innerHTML = '';
              _iterator = _createForOfIteratorHelper(houses);
              _context3.p = 2;
              _iterator.s();
            case 3:
              if ((_step = _iterator.n()).done) {
                _context3.n = 6;
                break;
              }
              house = _step.value;
              _context3.n = 4;
              return this.GetHead(house.id);
            case 4:
              headOfHouse = _context3.v;
              headTemplate = this.HeadTemplate(headOfHouse);
              managementCompanyTemplate = this.ManagementCompanyTemplate();
              houseTemplate = template(house, headTemplate, managementCompanyTemplate, headOfHouse);
              housesListContainer.insertAdjacentHTML('beforeend', houseTemplate);
            case 5:
              _context3.n = 3;
              break;
            case 6:
              _context3.n = 8;
              break;
            case 7:
              _context3.p = 7;
              _t2 = _context3.v;
              _iterator.e(_t2);
            case 8:
              _context3.p = 8;
              _iterator.f();
              return _context3.f(8);
            case 9:
              _context3.n = 11;
              break;
            case 10:
              _context3.p = 10;
              _t3 = _context3.v;
              console.error('Ошибка получения данных домов:', _t3);
            case 11:
              return _context3.a(2);
          }
        }, _callee3, this, [[2, 7, 8, 9], [0, 10]]);
      }));
      function InsertHouseDataByUserId(_x3, _x4, _x5) {
        return _InsertHouseDataByUserId.apply(this, arguments);
      }
      return InsertHouseDataByUserId;
    }()
  }, {
    key: "ApartmentToHouseTemplate",
    value: function ApartmentToHouseTemplate(apartment) {
      var apartmentHTML;
      if (apartment && _typeof(apartment) == 'object') {
        var apartmentsOwnersCount = apartment.users.filter(function (user) {
          return user.statuses.some(function (status) {
            return status.name === 'Владелец';
          });
        }).length;
        apartmentHTML = "\n            <div class=\"card card_apartment\">\n                <div class=\"area-value text-center\">\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ".concat(apartment.number, "</div>\n                <div>\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043A\u043E\u043C\u043D\u0430\u0442: ").concat(apartment.numbersOfRooms, "</div>\n                <div>\u041E\u0431\u0449\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C: ").concat(apartment.totalArea, "</div>\n                <div>\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0432\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u0435\u0432: ").concat(apartmentsOwnersCount, "</div>\n                <div class=\"text-center\">\n                    <a href=\"/apartment/").concat(apartment.id, "\">\u041A \u043F\u0440\u043E\u0444\u0438\u043B\u044E \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B</a>\n                </div>\n            </div>\n            ");
      } else {
        apartmentHTML = "\n            <div class=\"apartment-card-into-house\">\n                <div>\u0412 \u0434\u043E\u043C\u0435 \u043D\u0435\u0442 \u043A\u0432\u0430\u0440\u0442\u0438\u0440</div>\n            </div>\n            ";
      }
      return apartmentHTML;
    }
  }, {
    key: "ManagementCompanyTemplate",
    value: function ManagementCompanyTemplate(company) {
      var companyHTML = "\n            <div class=\"company-grid\">\n                <div class=\"company-item\">\n                    <div class=\"company-label\">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435</div>\n                    <div class=\"company-value empty\">\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E</div>\n                </div>\n                <div class=\"company-item\">\n                    <div class=\"company-label\">\u0410\u0432\u0430\u0440\u0438\u0439\u043D\u043E-\u0434\u0438\u0441\u043F\u0435\u0442\u0447\u0435\u0440\u0441\u043A\u0430\u044F \u0441\u043B\u0443\u0436\u0431\u0430</div>\n                    <div class=\"company-value empty\">\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E</div>\n                </div>\n                <div class=\"company-item\">\n                    <div class=\"company-label\">\u0420\u0435\u0436\u0438\u043C \u0440\u0430\u0431\u043E\u0442\u044B</div>\n                    <div class=\"company-value empty\">\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E</div>\n                </div>\n                <div class=\"company-item\">\n                    <div class=\"company-label\">\u041F\u0440\u0438\u0451\u043C\u043D\u0430\u044F</div>\n                    <div class=\"company-value empty\">\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E</div>\n                </div>\n                <div class=\"company-item\">\n                    <div class=\"company-label\">\u0410\u0434\u0440\u0435\u0441 \u0434\u043E\u043C\u043E\u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F</div>\n                    <div class=\"company-value empty\">\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E</div>\n                </div>\n                <div class=\"company-item\">\n                    <div class=\"company-label\">\u0421\u0430\u0439\u0442 \u043E\u0440\u0433\u0430\u043D\u0438\u0437\u0430\u0446\u0438\u0438</div>\n                    <div class=\"company-value empty\">\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E</div>\n                </div>\n            </div>\n        ";
      return companyHTML;
    }
  }, {
    key: "HeadTemplate",
    value: function HeadTemplate(head) {
      var headHTML;
      if (head && _typeof(head) == 'object') {
        headHTML = "\n                <div class=\"senior-info\">\n                    <div class=\"senior-name\">".concat(head.firstName, " ").concat(head.patronymic, "</div>\n                    <div class=\"senior-phone\"><a href=\"tel:").concat(head.phoneNumber, "\">").concat(head.phoneNumber, "</a></div>\n                </div>\n            ");
        return headHTML;
      } else {
        return "\n                <div class=\"senior-info\">\n                    <div class=\"no-senior\">\u0417\u0434\u0435\u0441\u044C \u043D\u0435\u0442 \u0441\u0442\u0430\u0440\u0448\u0435\u0433\u043E \u043F\u043E \u0434\u043E\u043C\u0443</div>\n                </div>\n            ";
      }
    }
  }, {
    key: "MainPageHouseTemplate",
    value: function MainPageHouseTemplate(house, headTemplate) {
      var houseHTML;
      if (house) {
        houseHTML = "\n                <div class=\"house-item\">\n                    <div class=\"house-address\" data-house-id=\"".concat(house.id, "\">").concat(house.city, ", ").concat(house.street, ", ").concat(house.number, "</div>\n                    <div class=\"senior-section\">\n                        <div class=\"senior-title\">\u0421\u0442\u0430\u0440\u0448\u0438\u0439 \u043F\u043E \u0434\u043E\u043C\u0443</div>\n                        ").concat(headTemplate, "                        \n                    </div>\n                </div>\n            ");
      }
      return houseHTML;
    }
  }, {
    key: "HousesListHouseTemplate",
    value: function HousesListHouseTemplate(house, headTemplate, managementCompanyTemplate, headOfHouse) {
      var houseHTML;
      if (house) {
        houseHTML = "\n                <div class=\"card card_house\" data-house-id=\"".concat(house.id, "\">\n                    <h3 class=\"card-header card-header_house\">").concat(house.city, ", \u0443\u043B\u0438\u0446\u0430 ").concat(house.street, ", \u0434\u043E\u043C ").concat(house.number, "</h3>\n\n                    <!-- \u041E\u0441\u043D\u043E\u0432\u043D\u044B\u0435 \u0445\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 -->\n                    <div class=\"basic-details\">\n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u0422\u0438\u043F \u0434\u043E\u043C\u0430</span>\n                            <span class=\"detail-value\">").concat(house.isApartmentBuilding ? "многоквартирный" : "индивидуальный", "</span>\n                        </div>\n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u042D\u0442\u0430\u0436\u0435\u0439</span>\n                            <span class=\"detail-value\">").concat(house.floors, "</span>\n                        </div>\n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u041F\u043E\u0434\u044A\u0435\u0437\u0434\u043E\u0432</span>\n                            <span class=\"detail-value\">").concat(house.entrances, "</span>\n                        </div>\n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u0413\u0430\u0437</span>\n                            <span class=\"detail-value ").concat(house.hasGas ? 'utility-yes' : 'utility-no', "\">").concat(house.hasGas ? 'Есть' : 'Нет', "</span>\n                        </div>\n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u042D\u043B\u0435\u043A\u0442\u0440\u0438\u0447\u0435\u0441\u0442\u0432\u043E</span>\n                            <span class=\"detail-value ").concat(house.hasElectricity ? 'utility-yes' : 'utility-no', "\">").concat(house.hasElectricity ? 'Есть' : 'Нет', "</span>\n                        </div>\n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u041B\u0438\u0444\u0442\u044B</span>\n                            <span class=\"detail-value ").concat(house.hasElevator ? 'utility-yes' : 'utility-no', "\">").concat(house.hasElevator ? 'Есть' : 'Нет', "</span>\n                        </div>                        \n                        <div class=\"detail-item\">\n                            <span class=\"detail-label\">\u0413\u043E\u0434 \u043F\u043E\u0441\u0442\u0440\u043E\u0439\u043A\u0438</span>\n                            <span class=\"detail-value\">").concat(house.builtYear, "</span>\n                        </div>\n                    </div>\n\n                    <!-- \u041F\u043B\u043E\u0449\u0430\u0434\u0438 -->\n                    <div class=\"areas-section\">\n                        <div class=\"card card_area mb-0\">\n                            <div class=\"area-value\">").concat(house.totalArea, " \u043C\xB2</div>\n                            <div class=\"area-label\">\u041E\u0431\u0449\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</div>\n                        </div>\n                        <div class=\"card card_area mb-0\">\n                            <div class=\"area-value\">").concat(house.apartmentsArea, " \u043C\xB2</div>\n                            <div class=\"area-label\">\u0416\u0438\u043B\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</div>\n                        </div>\n                        <div class=\"card card_area mb-0\">\n                            <div class=\"area-value\">").concat(house.landArea, " \u043C\xB2</div>\n                            <div class=\"area-label\">\u041F\u043B\u043E\u0449\u0430\u0434\u044C \u0442\u0435\u0440\u0440\u0438\u0442\u043E\u0440\u0438\u0438</div>\n                        </div>\n                    </div>\n\n                    ").concat(headOfHouse.id == window.authManager.userData.userId ? "<div class=\"text-center\">\n                            <a href=\"/house/".concat(house.id, "\">\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0434\u043E\u043C</a>\n                        </div>") : "", "\n\n                    <!-- \u0421\u0442\u0430\u0440\u0448\u0438\u0439 \u043F\u043E \u0434\u043E\u043C\u0443 -->\n                    <div class=\"senior-section\">\n                        <h6 class=\"section-title\">\u0421\u0442\u0430\u0440\u0448\u0438\u0439 \u043F\u043E \u0434\u043E\u043C\u0443</h6>\n                        ").concat(headTemplate, "                        \n                    </div>\n                    \n\n                    <!-- \u0423\u043F\u0440\u0430\u0432\u043B\u044F\u044E\u0449\u0430\u044F \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u044F -->\n                    <div class=\"card card_management mb-0\">\n                        <h6 class=\"section-title\">\u0423\u043F\u0440\u0430\u0432\u043B\u044F\u044E\u0449\u0430\u044F \u043A\u043E\u043C\u043F\u0430\u043D\u0438\u044F</h6>\n                        ").concat(managementCompanyTemplate, "\n                    </div>\n                </div>\n            ");
      }
      return houseHTML;
    }
  }, {
    key: "CollectHouseDataAndCreate",
    value: function () {
      var _CollectHouseDataAndCreate = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4() {
        var house, validation, isCreateHouseSuccessfull;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.n) {
            case 0:
              house = {};
              document.querySelectorAll('[data-group="house"] input').forEach(function (input) {
                var key = input.id;
                var value;
                if (input.type === 'checkbox') {
                  value = input.checked;
                } else if (input.type === 'number') {
                  // Пустое поле → 0
                  value = input.value === '' ? 0 : Number(input.value);
                } else if (input.tagName === 'SELECT') {
                  value = input.value === '' ? null : el.value;
                } else {
                  value = input.value || null;
                }
                house[key] = value;
              });

              // Валидация
              validation = _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__.HouseValidator.validate(house);
              if (validation.isValid) {
                _context4.n = 1;
                break;
              }
              _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__.HouseValidator.displayErrors(validation.errors);
              _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Исправьте ошибки в форме', 'red');
              return _context4.a(2);
            case 1:
              // Убираем ошибки перед попыткой отправки
              _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__.HouseValidator.displayErrors({});
              _context4.n = 2;
              return this.CreateHouse(house);
            case 2:
              isCreateHouseSuccessfull = _context4.v;
              if (isCreateHouseSuccessfull) {
                _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Данные о доме успешно сохранены', 'green');
                console.log("\u0441\u043E\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u043E \u0434\u043E\u043C\u0435");
                console.log(house);
              } else {
                _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Ошибка сохранения данных', 'red');
              }
            case 3:
              return _context4.a(2);
          }
        }, _callee4, this);
      }));
      function CollectHouseDataAndCreate() {
        return _CollectHouseDataAndCreate.apply(this, arguments);
      }
      return CollectHouseDataAndCreate;
    }()
  }, {
    key: "CollectHouseDataAndUpdateProfile",
    value: function () {
      var _CollectHouseDataAndUpdateProfile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {
        var house, Regex, houseId, validation, headId, isAssignHeadSuccessfull, isUpdateHouseSuccessfull;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.n) {
            case 0:
              house = {};
              Regex = new RegularExtension();
              houseId = Regex.isValidEntityUrl(window.location.href).id;
              document.querySelectorAll('[data-group="house"] input').forEach(function (input) {
                var key = input.id;
                var value;
                if (input.type === 'checkbox') {
                  value = input.checked;
                } else if (input.type === 'number') {
                  // Пустое поле → 0
                  value = input.value === '' ? 0 : Number(input.value);
                } else if (input.tagName === 'SELECT') {
                  value = input.value === '' ? null : el.value;
                } else {
                  value = input.value || null;
                }
                house[key] = value;
              });

              // Валидация
              validation = _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__.HouseValidator.validate(house);
              if (validation.isValid) {
                _context5.n = 1;
                break;
              }
              _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__.HouseValidator.displayErrors(validation.errors);
              _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Исправьте ошибки в форме', 'red');
              return _context5.a(2);
            case 1:
              // Убираем ошибки перед попыткой отправки
              _HouseValidator_js__WEBPACK_IMPORTED_MODULE_1__.HouseValidator.displayErrors({});
              headId = document.getElementById('houseHead').value; //Переназначаем старшего по дому
              _context5.n = 2;
              return this.AssignHead(houseId, headId);
            case 2:
              isAssignHeadSuccessfull = _context5.v;
              _context5.n = 3;
              return this.UpdateHouse(houseId, house);
            case 3:
              isUpdateHouseSuccessfull = _context5.v;
              if (isAssignHeadSuccessfull && isUpdateHouseSuccessfull) {
                _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Данные о доме успешно сохранены', 'green');
                console.log("\u0441\u043E\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u043E \u0434\u043E\u043C\u0435");
                console.log(house);
              } else {
                _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Ошибка сохранения данных', 'red');
              }
            case 4:
              return _context5.a(2);
          }
        }, _callee5, this);
      }));
      function CollectHouseDataAndUpdateProfile() {
        return _CollectHouseDataAndUpdateProfile.apply(this, arguments);
      }
      return CollectHouseDataAndUpdateProfile;
    }() // 1. Получить все дома
  }, {
    key: "GetHouses",
    value: function () {
      var _GetHouses = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {
        var response, data, _t4;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.p = _context6.n) {
            case 0:
              _context6.p = 0;
              _context6.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House"), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context6.v;
              _context6.n = 2;
              return response.json();
            case 2:
              data = _context6.v;
              if (response.ok) {
                _context6.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log('Дома:', data);
              return _context6.a(2, data);
            case 4:
              _context6.p = 4;
              _t4 = _context6.v;
              console.error('Ошибка получения списка домов:', _t4);
            case 5:
              return _context6.a(2);
          }
        }, _callee6, this, [[0, 4]]);
      }));
      function GetHouses() {
        return _GetHouses.apply(this, arguments);
      }
      return GetHouses;
    }() // 2. Получить дом по ID
  }, {
    key: "GetHouse",
    value: function () {
      var _GetHouse = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(id) {
        var response, data, _t5;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.p = _context7.n) {
            case 0:
              _context7.p = 0;
              _context7.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(id), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context7.v;
              _context7.n = 2;
              return response.json();
            case 2:
              data = _context7.v;
              if (response.ok) {
                _context7.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              return _context7.a(2, data);
            case 4:
              _context7.p = 4;
              _t5 = _context7.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0434\u043E\u043C\u0430 ".concat(id, ":"), _t5);
            case 5:
              return _context7.a(2);
          }
        }, _callee7, this, [[0, 4]]);
      }));
      function GetHouse(_x6) {
        return _GetHouse.apply(this, arguments);
      }
      return GetHouse;
    }() // 3. Создать новый дом
  }, {
    key: "CreateHouse",
    value: function () {
      var _CreateHouse = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(houseData) {
        var response, data, _t6;
        return _regenerator().w(function (_context8) {
          while (1) switch (_context8.p = _context8.n) {
            case 0:
              _context8.p = 0;
              _context8.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(houseData)
              });
            case 1:
              response = _context8.v;
              _context8.n = 2;
              return response.json();
            case 2:
              data = _context8.v;
              if (!response.ok) {
                _context8.n = 3;
                break;
              }
              //return data;
              console.log('Дом создан:', data);
              return _context8.a(2, true);
            case 3:
              return _context8.a(2, false);
            case 4:
              _context8.n = 6;
              break;
            case 5:
              _context8.p = 5;
              _t6 = _context8.v;
              console.error('Ошибка создания дома:', _t6);
            case 6:
              return _context8.a(2);
          }
        }, _callee8, this, [[0, 5]]);
      }));
      function CreateHouse(_x7) {
        return _CreateHouse.apply(this, arguments);
      }
      return CreateHouse;
    }() // 4. Обновить дом
  }, {
    key: "UpdateHouse",
    value: function () {
      var _UpdateHouse = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(id, houseData) {
        var response, error, _t7;
        return _regenerator().w(function (_context9) {
          while (1) switch (_context9.p = _context9.n) {
            case 0:
              _context9.p = 0;
              _context9.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(id), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(houseData)
              });
            case 1:
              response = _context9.v;
              if (response.ok) {
                _context9.n = 3;
                break;
              }
              _context9.n = 2;
              return response.text();
            case 2:
              error = _context9.v;
              console.log(error);
              //throw new Error(error);
              return _context9.a(2, false);
            case 3:
              return _context9.a(2, true);
            case 4:
              console.log("\u0414\u043E\u043C ".concat(id, " \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D"));
              _context9.n = 6;
              break;
            case 5:
              _context9.p = 5;
              _t7 = _context9.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0434\u043E\u043C\u0430 ".concat(id, ":"), _t7);
            case 6:
              return _context9.a(2);
          }
        }, _callee9, this, [[0, 5]]);
      }));
      function UpdateHouse(_x8, _x9) {
        return _UpdateHouse.apply(this, arguments);
      }
      return UpdateHouse;
    }() // 5. Удалить дом
  }, {
    key: "DeleteHouse",
    value: function () {
      var _DeleteHouse = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0(id) {
        var response, _t8, _t9, _t0;
        return _regenerator().w(function (_context0) {
          while (1) switch (_context0.p = _context0.n) {
            case 0:
              _context0.p = 0;
              _context0.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(id), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context0.v;
              if (response.ok) {
                _context0.n = 3;
                break;
              }
              _t8 = Error;
              _context0.n = 2;
              return response.text();
            case 2:
              _t9 = _context0.v;
              throw new _t8(_t9);
            case 3:
              console.log("\u0414\u043E\u043C ".concat(id, " \u0443\u0434\u0430\u043B\u0435\u043D"));
              _context0.n = 5;
              break;
            case 4:
              _context0.p = 4;
              _t0 = _context0.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0434\u043E\u043C\u0430 ".concat(id, ":"), _t0);
            case 5:
              return _context0.a(2);
          }
        }, _callee0, this, [[0, 4]]);
      }));
      function DeleteHouse(_x0) {
        return _DeleteHouse.apply(this, arguments);
      }
      return DeleteHouse;
    }() // 6. Назначить старшего по дому
  }, {
    key: "AssignHead",
    value: function () {
      var _AssignHead = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1(houseId, userId) {
        var response, data, _t1;
        return _regenerator().w(function (_context1) {
          while (1) switch (_context1.p = _context1.n) {
            case 0:
              _context1.p = 0;
              _context1.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(houseId, "/head/").concat(userId), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context1.v;
              _context1.n = 2;
              return response.text();
            case 2:
              data = _context1.v;
              if (response.ok) {
                _context1.n = 3;
                break;
              }
              console.log(data);
              return _context1.a(2, false);
            case 3:
              console.log("\u0441\u0442\u0430\u0440\u0448\u0438\u0439 \u043F\u043E \u0434\u043E\u043C\u0443 \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D:");
              console.log(data);
              return _context1.a(2, true);
            case 4:
              _context1.n = 6;
              break;
            case 5:
              _context1.p = 5;
              _t1 = _context1.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043D\u0430\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0440\u0448\u0435\u0433\u043E \u043F\u043E \u0434\u043E\u043C\u0443 ".concat(houseId, ":"), _t1);
            case 6:
              return _context1.a(2);
          }
        }, _callee1, this, [[0, 5]]);
      }));
      function AssignHead(_x1, _x10) {
        return _AssignHead.apply(this, arguments);
      }
      return AssignHead;
    }() // 7. Отозвать старшего по дому
  }, {
    key: "RevokeHead",
    value: function () {
      var _RevokeHead = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee10(houseId) {
        var response, data, _t10;
        return _regenerator().w(function (_context10) {
          while (1) switch (_context10.p = _context10.n) {
            case 0:
              _context10.p = 0;
              _context10.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(houseId, "/head"), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context10.v;
              _context10.n = 2;
              return response.text();
            case 2:
              data = _context10.v;
              if (response.ok) {
                _context10.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log(data);
              _context10.n = 5;
              break;
            case 4:
              _context10.p = 4;
              _t10 = _context10.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u0437\u044B\u0432\u0430 \u0441\u0442\u0430\u0440\u0448\u0435\u0433\u043E \u043F\u043E \u0434\u043E\u043C\u0443 ".concat(houseId, ":"), _t10);
            case 5:
              return _context10.a(2);
          }
        }, _callee10, this, [[0, 4]]);
      }));
      function RevokeHead(_x11) {
        return _RevokeHead.apply(this, arguments);
      }
      return RevokeHead;
    }() // 8. Получить информацию о старшем по дому
  }, {
    key: "GetHead",
    value: function () {
      var _GetHead = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee11(houseId) {
        var response, text, data, isJson, errorMessage, _t11;
        return _regenerator().w(function (_context11) {
          while (1) switch (_context11.p = _context11.n) {
            case 0:
              _context11.p = 0;
              _context11.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(houseId, "/head"), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context11.v;
              _context11.n = 2;
              return response.text();
            case 2:
              text = _context11.v;
              isJson = false; // Пытаемся распарсить как JSON
              try {
                data = JSON.parse(text);
                isJson = true;
              } catch (e) {
                // Это не JSON — значит, это просто строка (например, из return NotFound("сообщение"))
                data = {
                  message: text
                };
              }
              if (!response.ok) {
                errorMessage = data.message || data.Message || (isJson ? JSON.stringify(data) : text);
                console.error("\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ":"), errorMessage);
                if (response.status === 404) {
                  console.log(errorMessage);
                  data = errorMessage;
                }
              }

              // На случай, если успешный ответ тоже пришёл как plain text (маловероятно)
              if (!isJson) {
                console.log("\u0421\u0442\u0430\u0440\u0448\u0438\u0439 \u043F\u043E \u0434\u043E\u043C\u0443 \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442: ".concat(data));
              }
              console.log("\u0421\u0442\u0430\u0440\u0448\u0438\u0439 \u043F\u043E \u0434\u043E\u043C\u0443 ".concat(houseId, ":"), data);
              return _context11.a(2, data);
            case 3:
              _context11.p = 3;
              _t11 = _context11.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0440\u0448\u0435\u0433\u043E \u043F\u043E \u0434\u043E\u043C\u0443 ".concat(houseId, ":"), _t11.message);
              throw _t11;
            case 4:
              return _context11.a(2);
          }
        }, _callee11, this, [[0, 3]]);
      }));
      function GetHead(_x12) {
        return _GetHead.apply(this, arguments);
      }
      return GetHead;
    }() // 9. Получить дома по ID пользователя
  }, {
    key: "GetHousesByUserId",
    value: function () {
      var _GetHousesByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee12(userId) {
        var response, data, _t12;
        return _regenerator().w(function (_context12) {
          while (1) switch (_context12.p = _context12.n) {
            case 0:
              _context12.p = 0;
              _context12.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/user/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context12.v;
              _context12.n = 2;
              return response.json();
            case 2:
              data = _context12.v;
              if (response.ok) {
                _context12.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log("\u0414\u043E\u043C\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), data);
              return _context12.a(2, data);
            case 4:
              _context12.p = 4;
              _t12 = _context12.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0434\u043E\u043C\u043E\u0432 \u0434\u043B\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), _t12);
            case 5:
              return _context12.a(2);
          }
        }, _callee12, this, [[0, 4]]);
      }));
      function GetHousesByUserId(_x13) {
        return _GetHousesByUserId.apply(this, arguments);
      }
      return GetHousesByUserId;
    }() // 10. Получить все квартиры по ID дома
  }, {
    key: "GetApartmentsByHouseId",
    value: function () {
      var _GetApartmentsByHouseId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee13(houseId) {
        var response, data, _t13;
        return _regenerator().w(function (_context13) {
          while (1) switch (_context13.p = _context13.n) {
            case 0:
              _context13.p = 0;
              _context13.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/house/").concat(houseId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context13.v;
              _context13.n = 2;
              return response.json();
            case 2:
              data = _context13.v;
              if (response.ok) {
                _context13.n = 3;
                break;
              }
              throw new Error((data === null || data === void 0 ? void 0 : data.message) || 'Ошибка при загрузке квартир');
            case 3:
              console.log("\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u044B \u0432 \u0434\u043E\u043C\u0435 ".concat(houseId, ":"), data);
              return _context13.a(2, data);
            case 4:
              _context13.p = 4;
              _t13 = _context13.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440 \u0434\u043B\u044F \u0434\u043E\u043C\u0430 ".concat(houseId, ":"), _t13);
              throw _t13;
            case 5:
              return _context13.a(2);
          }
        }, _callee13, this, [[0, 4]]);
      }));
      function GetApartmentsByHouseId(_x14) {
        return _GetApartmentsByHouseId.apply(this, arguments);
      }
      return GetApartmentsByHouseId;
    }() // 11. Получить владельцев квартир в доме с их номерами (массивами)
  }, {
    key: "GetHouseOwnersWithApartments",
    value: function () {
      var _GetHouseOwnersWithApartments = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee14(houseId) {
        var response, data, _t14;
        return _regenerator().w(function (_context14) {
          while (1) switch (_context14.p = _context14.n) {
            case 0:
              _context14.p = 0;
              _context14.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/House/").concat(houseId, "/owners"), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context14.v;
              _context14.n = 2;
              return response.json();
            case 2:
              data = _context14.v;
              if (response.ok) {
                _context14.n = 3;
                break;
              }
              throw new Error((data === null || data === void 0 ? void 0 : data.message) || "\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0432\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u0435\u0432 \u0434\u043E\u043C\u0430 ".concat(houseId));
            case 3:
              console.log("\u0412\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u044B \u0441 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u0430\u043C\u0438 \u0432 \u0434\u043E\u043C\u0435 ".concat(houseId, ":"), data);
              return _context14.a(2, data);
            case 4:
              _context14.p = 4;
              _t14 = _context14.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0432\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u0435\u0432 \u0441 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u0430\u043C\u0438 \u0434\u043B\u044F \u0434\u043E\u043C\u0430 ".concat(houseId, ":"), _t14);
              throw _t14;
            case 5:
              return _context14.a(2);
          }
        }, _callee14, this, [[0, 4]]);
      }));
      function GetHouseOwnersWithApartments(_x15) {
        return _GetHouseOwnersWithApartments.apply(this, arguments);
      }
      return GetHouseOwnersWithApartments;
    }()
  }]);
}();
document.addEventListener('authStateChanged', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee15() {
  var Regex, _event$detail, isAuthenticated, userData, houseProfile, userId, houseId;
  return _regenerator().w(function (_context15) {
    while (1) switch (_context15.n) {
      case 0:
        Regex = new window.RegularExtension();
        _event$detail = event.detail, isAuthenticated = _event$detail.isAuthenticated, userData = _event$detail.userData;
        if (!(isAuthenticated && userData)) {
          _context15.n = 5;
          break;
        }
        houseProfile = new ApartmentHouses();
        userId = window.authManager.userData.userId;
        if (!(window.location.pathname == '/')) {
          _context15.n = 1;
          break;
        }
        _context15.n = 1;
        return houseProfile.InsertHouseDataByUserId(userId, '.houses-list', houseProfile.MainPageHouseTemplate);
      case 1:
        if (!window.location.pathname.includes("/house/by-user/".concat(userId))) {
          _context15.n = 2;
          break;
        }
        _context15.n = 2;
        return houseProfile.InsertHouseDataByUserId(userId, '.houses-list', houseProfile.HousesListHouseTemplate);
      case 2:
        if (!(Regex.isValidEntityUrl(window.location.href).valid && Regex.getUrlPathParts(window.location.href).includes('house'))) {
          _context15.n = 4;
          break;
        }
        houseId = Regex.isValidEntityUrl(window.location.href).id;
        localStorage.setItem('house', houseId);
        _context15.n = 3;
        return houseProfile.InsertHouseDataById(houseId);
      case 3:
        _context15.n = 4;
        return houseProfile.InsertApartmentsInHouseDetails(houseId);
      case 4:
        //где-то тут и на бэке надо бы сделать проверку на суперадминистратора :)
        if (window.location.pathname.includes('/house/create')) {
          document.querySelector('[data-action="save-house-data"]').addEventListener('click', function () {
            console.log("\u043A\u043B\u0438\u043A \u043F\u043E \u043A\u043D\u043E\u043F\u043A\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0434\u043E\u043C\u0430");
            houseProfile.CollectHouseDataAndCreate();
          });
        }
      case 5:
        return _context15.a(2);
    }
  }, _callee15);
})));

/***/ }),

/***/ "./wwwroot/js/ApartmentProfile.js":
/*!****************************************!*\
  !*** ./wwwroot/js/ApartmentProfile.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ApartmentProfile: () => (/* binding */ ApartmentProfile)
/* harmony export */ });
/* harmony import */ var _ApartmentStatuses_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ApartmentStatuses.js */ "./wwwroot/js/ApartmentStatuses.js");
/* harmony import */ var _ApartmentHouses_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ApartmentHouses.js */ "./wwwroot/js/ApartmentHouses.js");
/* harmony import */ var _UserProfile_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./UserProfile.js */ "./wwwroot/js/UserProfile.js");
/* harmony import */ var _UserValidator_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./UserValidator.js */ "./wwwroot/js/UserValidator.js");
/* harmony import */ var _Modal_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Modal.js */ "./wwwroot/js/Modal.js");
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regeneratorValues(e) { if (null != e) { var t = e["function" == typeof Symbol && Symbol.iterator || "@@iterator"], r = 0; if (t) return t.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) return { next: function next() { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e }; } }; } throw new TypeError(_typeof(e) + " is not iterable"); }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }





var ApartmentProfile = /*#__PURE__*/function () {
  function ApartmentProfile() {
    _classCallCheck(this, ApartmentProfile);
    this.ApartmentAPIAddress = 'https://localhost:55683';
    this.House = new _ApartmentHouses_js__WEBPACK_IMPORTED_MODULE_1__.ApartmentHouses();
    this.userValidator = new _UserValidator_js__WEBPACK_IMPORTED_MODULE_3__.UserValidator();
    this.userProfile = new _UserProfile_js__WEBPACK_IMPORTED_MODULE_2__.UserProfile();
  }

  //Вставить данные о квартирах пользователя в карточку на главной странице
  return _createClass(ApartmentProfile, [{
    key: "InsertApartmentDataToCardOnMainPage",
    value: function () {
      var _InsertApartmentDataToCardOnMainPage = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(userId) {
        var _this = this;
        var apartments, houseIds, housePromises, houses, houseMap, apartmentWithHouse, apartmentsListContainer, _iterator, _step, _step$value, apartment, house, apartmentTemplate, _t;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              _context.p = 0;
              _context.n = 1;
              return this.GetApartmentsByUserId(userId);
            case 1:
              apartments = _context.v;
              if (!(!apartments || apartments.length === 0)) {
                _context.n = 2;
                break;
              }
              document.querySelector('.apartments-card .apartments-list').innerHTML = '<p>Нет привязанных квартир</p>';
              return _context.a(2);
            case 2:
              // 2. Собираем уникальные houseId
              houseIds = _toConsumableArray(new Set(apartments.map(function (a) {
                return a.houseId;
              }))); // 3. Параллельно загружаем все дома
              housePromises = houseIds.map(function (id) {
                return _this.House.GetHouse(id);
              });
              _context.n = 3;
              return Promise.all(housePromises);
            case 3:
              houses = _context.v;
              // 4. Создаём мапу houseId → house для быстрого доступа
              houseMap = new Map();
              houses.forEach(function (house) {
                houseMap.set(house.id, house);
              });

              // 5. Сопоставляем квартиры с домами и сортируем по номеру дома
              apartmentWithHouse = apartments.map(function (apartment) {
                return {
                  apartment: apartment,
                  house: houseMap.get(apartment.houseId)
                };
              }).filter(function (item) {
                return item.house;
              }) // на случай, если дом не найден
              .sort(function (a, b) {
                // Сравниваем по номеру дома
                var numA = typeof a.house.number === 'string' ? parseInt(a.house.number, 10) || 0 : a.house.number;
                var numB = typeof b.house.number === 'string' ? parseInt(b.house.number, 10) || 0 : b.house.number;
                return numA - numB;
              }); // 6. Генерируем HTML
              apartmentsListContainer = document.querySelector('.apartments-card .apartments-list');
              apartmentsListContainer.innerHTML = '';
              _iterator = _createForOfIteratorHelper(apartmentWithHouse);
              try {
                for (_iterator.s(); !(_step = _iterator.n()).done;) {
                  _step$value = _step.value, apartment = _step$value.apartment, house = _step$value.house;
                  apartmentTemplate = this.SetApartmentTemplateForMainPage(apartment, house);
                  apartmentsListContainer.insertAdjacentHTML('beforeend', apartmentTemplate);
                }
              } catch (err) {
                _iterator.e(err);
              } finally {
                _iterator.f();
              }
              _context.n = 5;
              break;
            case 4:
              _context.p = 4;
              _t = _context.v;
              console.error('Ошибка при загрузке данных квартиры на главную страницу:', _t);
              // Опционально: показать сообщение пользователю
              document.querySelector('.apartments-card .apartments-list').innerHTML = '<p>Ошибка загрузки данных</p>';
            case 5:
              return _context.a(2);
          }
        }, _callee, this, [[0, 4]]);
      }));
      function InsertApartmentDataToCardOnMainPage(_x) {
        return _InsertApartmentDataToCardOnMainPage.apply(this, arguments);
      }
      return InsertApartmentDataToCardOnMainPage;
    }()
  }, {
    key: "SetApartmentTemplateForMainPage",
    value: function SetApartmentTemplateForMainPage(apartment, house) {
      var apartmentHTML;
      if (apartment) {
        apartmentHTML = "\n                <div class=\"apartment-item\" data-apartment-id=\"".concat(apartment.id, "\">\n                    <div class=\"apartment-address\">").concat(house.city, ", \u0443\u043B\u0438\u0446\u0430 ").concat(house.street, ", \u0434\u043E\u043C ").concat(house.number, "</div>\n                    <div class=\"apartment-details\">\n                        ").concat(house.isApartmentBuilding ? "<div class=\"apartment-detail\">\n                            <div class=\"detail-label\">\u041D\u043E\u043C\u0435\u0440 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B</div>\n                            <div class=\"detail-value\">".concat(apartment.number, "</div>\n                        </div>") : '', "\n                        \n                        <div class=\"apartment-detail\">\n                            <div class=\"detail-label\">\u0427\u0438\u0441\u043B\u043E \u043A\u043E\u043C\u043D\u0430\u0442</div>\n                            <div class=\"detail-value\">").concat(apartment.numbersOfRooms, "</div>\n                        </div>\n\n                        <div class=\"apartment-detail\">\n                            <div class=\"detail-label\">\u041E\u0431\u0449\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</div>\n                            <div class=\"detail-value\">").concat(apartment.totalArea, "</div>\n                        </div>\n\n                        <div class=\"apartment-detail\">\n                            <div class=\"detail-label\">\u0416\u0438\u043B\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</div>\n                            <div class=\"detail-value\">").concat(apartment.residentialArea, "</div>\n                        </div>\n                    </div>\n                </div>\n            ");
      }
      return apartmentHTML;
    }
  }, {
    key: "InsertApartmentProfileToAllApartments",
    value: function () {
      var _InsertApartmentProfileToAllApartments = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(apartment, house) {
        var container, apartmentTemplate;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.n) {
            case 0:
              container = document.querySelector('.apartments-by-user-list');
              apartmentTemplate = this.SetApartmentTemplateForAllApartments(apartment, house);
              container.insertAdjacentHTML('beforeend', apartmentTemplate);
            case 1:
              return _context2.a(2);
          }
        }, _callee2, this);
      }));
      function InsertApartmentProfileToAllApartments(_x2, _x3) {
        return _InsertApartmentProfileToAllApartments.apply(this, arguments);
      }
      return InsertApartmentProfileToAllApartments;
    }()
  }, {
    key: "SetApartmentTemplateForAllApartments",
    value: function SetApartmentTemplateForAllApartments(apartment, house) {
      var apartmentHTML;
      if (apartment) {
        apartmentHTML = "\n                <div class=\"profile-group dashboard-card my-4\" data-group=\"apartment\" data-apartment-id=\"".concat(apartment.id, "\" data-apartment-house=\"").concat(house.id, "\">\n                    <h3 class=\"card-header card-header_apartment w-100\"><a href=\"/apartment/").concat(apartment.id, "\">").concat(house.city, ", \u0443\u043B. ").concat(house.street, " ").concat(house.number, ", \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ").concat(apartment.number, "</a></h3>\n\n                    <div class=\"d-flex flex-wrap flex-lg-nowrap gap-4 mt-4 w-100\">\n                        <div class=\"form-group\">\n                            <input type=\"number\" disabled placeholder=\"\" min=\"1\" max=\"100\" name=\"numbersOfRooms\" id=\"numbersOfRooms\" value=\"").concat(apartment.numbersOfRooms, "\">\n                            <label for=\"numbersOfRooms\">\u0427\u0438\u0441\u043B\u043E \u043A\u043E\u043C\u043D\u0430\u0442</label>\n                            <div class=\"error invisible\" data-error=\"numbersOfRooms\">\u041D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u0447\u0438\u0441\u043B\u043E \u043A\u043E\u043C\u043D\u0430\u0442</div>\n                        </div>\n                        <div class=\"form-group\">\n                            <input type=\"number\" disabled placeholder=\"\" min=\"1\" max=\"100\" name=\"entranceNumber\" id=\"entranceNumber\" value=\"").concat(apartment.entranceNumber, "\">\n                            <label for=\"entranceNumber\">\u041D\u043E\u043C\u0435\u0440 \u043F\u043E\u0434\u044A\u0435\u0437\u0434\u0430</label>\n                            <div class=\"error invisible\" data-error=\"entranceNumber\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u043F\u043E\u0434\u044A\u0435\u0437\u0434\u0430</div>\n                        </div>\n                        <div class=\"form-group\">\n                            <input type=\"number\" disabled placeholder=\"\" min=\"1\" max=\"200\" name=\"floor\" id=\"floor\" value=\"").concat(apartment.floor, "\">\n                            <label for=\"floor\">\u042D\u0442\u0430\u0436</label>\n                            <div class=\"error invisible\" data-error=\"floor\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u044D\u0442\u0430\u0436</div>\n                        </div>\n                    </div>\n                    <div class=\"d-flex flex-wrap flex-lg-nowrap gap-4 w-100\">                        \n                        <div class=\"form-group\">\n                            <input type=\"number\" disabled step=\"0.1\" min=\"1\" max=\"10000\" placeholder=\"\" name=\"totalArea\" id=\"totalArea\" value=\"").concat(apartment.floor, "\">\n                            <label for=\"totalArea\">\u041E\u0431\u0449\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</label>\n                            <div class=\"error invisible\" data-error=\"totalArea\">\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043E\u0431\u0449\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</div>\n                        </div>\n                        <div class=\"form-group\">\n                            <input type=\"number\" disabled step=\"0.1\" min=\"1\" max=\"10000\" placeholder=\"\" name=\"residentialArea\" id=\"residentialArea\" value=\"").concat(apartment.residentialArea, "\">\n                            <label for=\"residentialArea\">\u0416\u0438\u043B\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</label>\n                            <div class=\"error invisible\" data-error=\"residentialArea\">\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u0436\u0438\u043B\u0430\u044F \u043F\u043B\u043E\u0449\u0430\u0434\u044C</div>\n                        </div>\n                        <div class=\"form-group\" style=\"max-width: 407px\">\n                            <input type=\"number\" disabled min=\"0\" max=\"30\" placeholder=\"\" name=\"apartmentUsers\" id=\"apartmentUsers\" value=\"").concat(apartment.users.length, "\">\n                            <label for=\"apartmentUsers\">\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B</label>\n                            <div class=\"error invisible\" data-error=\"apartmentUsers\">\u041D\u0435\u0432\u0435\u0440\u043D\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439</div>\n                        </div>\n                    </div>                   \n                    <a href=\"/apartment/").concat(apartment.id, "\">\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u043F\u0440\u043E\u0444\u0438\u043B\u044E \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B</a>\n                </div>\n            ");
      }
      return apartmentHTML;
    }

    // Редактирование профиля квартиры
  }, {
    key: "EditApartmentProfile",
    value: function () {
      var _EditApartmentProfile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(apartmentId) {
        var _this2 = this;
        var apartment, apartmentsShare, users, house, apartmenUsertList, houseContainer, option, _iterator2, _step2, _loop, _t2;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.p = _context4.n) {
            case 0:
              _context4.n = 1;
              return this.GetApartment(apartmentId);
            case 1:
              apartment = _context4.v;
              _context4.n = 2;
              return this.GetApartmentShares(apartmentId);
            case 2:
              apartmentsShare = _context4.v;
              users = apartment.users;
              _context4.n = 3;
              return this.House.GetHouse(apartment.houseId);
            case 3:
              house = _context4.v;
              apartmenUsertList = document.querySelector('[data-group="apartment-users"] .apartment-user-list');
              houseContainer = document.getElementById('houseId');
              apartmenUsertList.innerHTML = '';
              houseContainer.innerHTML = '';
              document.getElementById('number').value = apartment.number;
              document.getElementById('numbersOfRooms').value = apartment.numbersOfRooms;
              document.getElementById('entranceNumber').value = apartment.entranceNumber;
              document.getElementById('floor').value = apartment.floor;
              document.getElementById('totalArea').value = apartment.totalArea;
              document.getElementById('residentialArea').value = apartment.residentialArea;
              option = document.createElement('option');
              option.value = apartment.houseId;
              option.textContent = "".concat(house.city, ", \u0443\u043B. ").concat(house.street, " ").concat(house.number, " ");
              houseContainer.appendChild(option);
              _iterator2 = _createForOfIteratorHelper(users);
              _context4.p = 4;
              _loop = /*#__PURE__*/_regenerator().m(function _loop() {
                var user, shareEntry, share, usersTemplate, multiselect;
                return _regenerator().w(function (_context3) {
                  while (1) switch (_context3.n) {
                    case 0:
                      user = _step2.value;
                      shareEntry = apartmentsShare.find(function (s) {
                        return s.userId === user.userId;
                      });
                      share = shareEntry ? shareEntry.share : '';
                      usersTemplate = _this2.SetApartmentUserTemplate(user, share);
                      apartmenUsertList.insertAdjacentHTML('beforeend', usersTemplate);
                      multiselect = new window.Multiselect();
                      multiselect.init("statuses-".concat(user.userId));
                    case 1:
                      return _context3.a(2);
                  }
                }, _loop);
              });
              _iterator2.s();
            case 5:
              if ((_step2 = _iterator2.n()).done) {
                _context4.n = 7;
                break;
              }
              return _context4.d(_regeneratorValues(_loop()), 6);
            case 6:
              _context4.n = 5;
              break;
            case 7:
              _context4.n = 9;
              break;
            case 8:
              _context4.p = 8;
              _t2 = _context4.v;
              _iterator2.e(_t2);
            case 9:
              _context4.p = 9;
              _iterator2.f();
              return _context4.f(9);
            case 10:
              return _context4.a(2);
          }
        }, _callee3, this, [[4, 8, 9, 10]]);
      }));
      function EditApartmentProfile(_x4) {
        return _EditApartmentProfile.apply(this, arguments);
      }
      return EditApartmentProfile;
    }()
  }, {
    key: "SetApartmentUserTemplate",
    value: function SetApartmentUserTemplate(apartmentUser, share) {
      if (!apartmentUser) return '';
      var allStatuses = [{
        id: 1,
        name: "Владелец"
      }, {
        id: 2,
        name: "Жилец"
      }, {
        id: 3,
        name: "Прописан"
      }, {
        id: 4,
        name: "Временно проживающий"
      }];

      // Получаем множество ID выбранных статусов для быстрой проверки
      var selectedStatusIds = new Set((apartmentUser.statuses || []).map(function (s) {
        return s.id;
      }));

      // Генерируем опции: все статусы, но отмечаем выбранные
      var statusOptions = allStatuses.map(function (status) {
        var isSelected = selectedStatusIds.has(status.id) ? ' selected' : '';
        return "<option value=\"".concat(status.id, "\"").concat(isSelected, ">").concat(status.name, "</option>");
      }).join('');
      var apartmentUserHTML = "\n            <div class=\"d-flex flex-wrap flex-lg-nowrap gap-4 mt-4 w-100\" data-apartment-user-id=\"".concat(apartmentUser.userId, "\">\n                <div class=\"form-group\">\n                    <input type=\"text\" disabled placeholder=\"\" name=\"fullName\" id=\"fullName-").concat(apartmentUser.userId, "\" value=\"").concat(apartmentUser.userDetails.firstName, " ").concat(apartmentUser.userDetails.lastName, " ").concat(apartmentUser.userDetails.patronymic, "\">\n                    <label for=\"fullName-").concat(apartmentUser.userId, "\">\u0424\u0418\u041E \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F</label>\n                </div>\n                <div class=\"form-group\">\n                    <input type=\"text\" disabled placeholder=\"\" name=\"phoneNumber\" id=\"phoneNumber-").concat(apartmentUser.userId, "\" value=\"").concat(apartmentUser.userDetails.phoneNumber, "\">\n                    <label for=\"phoneNumber-").concat(apartmentUser.userId, "\">\u0422\u0435\u043B\u0435\u0444\u043E\u043D \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F</label>\n                </div>\n                <div class=\"form-group multiselect\">\n                    <select id=\"statuses-").concat(apartmentUser.userId, "\" multiple>\n                        ").concat(statusOptions, "\n                    </select>                        \n                    <label for=\"statuses-").concat(apartmentUser.userId, "\">\u0421\u0442\u0430\u0442\u0443\u0441 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F</label>\n                </div>\n                <div class=\"form-group\">\n                    <input type=\"number\" placeholder=\"\" name=\"share\" min=\"0\" step=\"0.1\" id=\"share-").concat(apartmentUser.userId, "\" value=\"").concat(share, "\">                      \n                    <label for=\"share-").concat(apartmentUser.userId, "\">\u0414\u043E\u043B\u044F \u0432\u043B\u0430\u0434\u0435\u043D\u0438\u044F</label>\n                    <div class=\"error invisible\" data-error=\"share\">\u0414\u043E\u043B\u044F \u0432\u043B\u0430\u0434\u0435\u043D\u0438\u044F \u0442\u043E\u043B\u044C\u043A\u043E \u0434\u043B\u044F \u0432\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u0435\u0432</div>\n                </div>\n                <div class=\"save-icon icon-action\" data-status=\"save\" title=\"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\">&#128190;</div>\n                <div class=\"remove-icon icon-action\" data-status=\"remove\" title=\"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F\">&#10060;</div>                \n            </div>\n        ");
      return apartmentUserHTML;
    }

    //Получение домов для создания квартиры и привязки к ним
  }, {
    key: "SetHouseIdToCreateApartment",
    value: function () {
      var _SetHouseIdToCreateApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {
        var _this3 = this;
        var houseId, houseProfile, option, userId, houseSelector, house, houses;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.n) {
            case 0:
              houseId = parseInt(localStorage.getItem('house'));
              houseProfile = new _ApartmentHouses_js__WEBPACK_IMPORTED_MODULE_1__.ApartmentHouses();
              option = document.createElement('option');
              userId = window.authManager.userData.userId;
              houseSelector = document.getElementById('houseId');
              if (isNaN(houseId)) {
                _context6.n = 2;
                break;
              }
              _context6.n = 1;
              return houseProfile.GetHouse(houseId);
            case 1:
              house = _context6.v;
              option.value = house.id;
              option.textContent = "".concat(house.city, ", \u0443\u043B. ").concat(house.street, ", ").concat(house.number);
              houseSelector.appendChild(option);
              _context6.n = 4;
              break;
            case 2:
              _context6.n = 3;
              return houseProfile.GetHousesByUserId(userId);
            case 3:
              houses = _context6.v;
              houses.forEach(/*#__PURE__*/function () {
                var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(house) {
                  var houseHead;
                  return _regenerator().w(function (_context5) {
                    while (1) switch (_context5.n) {
                      case 0:
                        _context5.n = 1;
                        return _this3.GetHead(house.id);
                      case 1:
                        houseHead = _context5.v;
                        if (houseHead.id == userId) {
                          option.value = house.id;
                          option.textContent = "".concat(house.city, ", \u0443\u043B. ").concat(house.street, ", ").concat(house.number);
                          houseSelector.appendChild(option);
                        } else {
                          document.querySelector('.profile-group[data-group="apartment"]').innerHTML = "\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E";
                        }
                      case 2:
                        return _context5.a(2);
                    }
                  }, _callee4);
                }));
                return function (_x5) {
                  return _ref.apply(this, arguments);
                };
              }());
            case 4:
              return _context6.a(2);
          }
        }, _callee5);
      }));
      function SetHouseIdToCreateApartment() {
        return _SetHouseIdToCreateApartment.apply(this, arguments);
      }
      return SetHouseIdToCreateApartment;
    }() // Коллекционирование данных квартир для сохранения и создания
  }, {
    key: "CollectApartmentDataAndSaveToCreate",
    value: function () {
      var _CollectApartmentDataAndSaveToCreate = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {
        var _document$getElementB, _document$getElementB2, _document$getElementB3, _document$getElementB4, _document$getElementB5, _document$getElementB6, _document$getElementB7;
        var apartment, number, numbersOfRooms, entranceNumber, floor, totalArea, residentialArea, houseId, showError, validateApartmentForm, result;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.n) {
            case 0:
              validateApartmentForm = function _validateApartmentFor() {
                var isValid = true;

                // Валидация номера квартиры
                if (!Number.isInteger(number) || number < 1 || number > 10000) {
                  showError('number', 'Номер квартиры должен быть от 1 до 10000');
                  isValid = false;
                } else {
                  showError('number', null, false);
                }

                // Валидация числа комнат
                if (!Number.isInteger(numbersOfRooms) || numbersOfRooms < 1 || numbersOfRooms > 100) {
                  showError('numbersOfRooms', 'Число комнат должно быть от 1 до 100');
                  isValid = false;
                } else {
                  showError('numbersOfRooms', null, false);
                }

                // Валидация номера подъезда
                if (!Number.isInteger(entranceNumber) || entranceNumber < 1 || entranceNumber > 100) {
                  showError('entranceNumber', 'Номер подъезда должен быть от 1 до 100');
                  isValid = false;
                } else {
                  showError('entranceNumber', null, false);
                }

                // Валидация этажа
                if (!Number.isInteger(floor) || floor < 1 || floor > 200) {
                  showError('floor', 'Этаж должен быть от 1 до 200');
                  isValid = false;
                } else {
                  showError('floor', null, false);
                }

                // Валидация общей площади
                if (isNaN(totalArea) || totalArea < 1 || totalArea > 10000) {
                  showError('totalArea', 'Общая площадь должна быть от 1 до 10000');
                  isValid = false;
                } else {
                  showError('totalArea', null, false);
                }

                // Валидация жилой площади
                if (isNaN(residentialArea) || residentialArea < 1 || residentialArea > 10000) {
                  showError('residentialArea', 'Жилая площадь должна быть от 1 до 10000');
                  isValid = false;
                } else if (residentialArea > totalArea) {
                  showError('residentialArea', 'Жилая площадь не может превышать общую');
                  isValid = false;
                } else {
                  showError('residentialArea', null, false);
                }

                // Валидация id дом
                if (!houseId) {
                  var houseError = document.querySelector('[data-error="houseId"]');
                  if (houseError) {
                    houseError.classList.remove('invisible');
                  }
                  isValid = false;
                } else {
                  var _houseError = document.querySelector('[data-error="houseId"]');
                  if (_houseError) _houseError.classList.add('invisible');
                }
                return isValid;
              };
              showError = function _showError(field) {
                var message = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                var show = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
                var errorEl = document.querySelector("[data-error=\"".concat(field, "\"]"));
                if (errorEl) {
                  if (show) {
                    console.log("\u043E\u0442\u043E\u0431\u0440\u0430\u0436\u0430\u044E \u043E\u0448\u0438\u0431\u043A\u0443 \u0434\u043B\u044F \u043F\u043E\u043B\u044F: ".concat(field));
                  }
                  errorEl.textContent = message || errorEl.textContent;
                  errorEl.classList.toggle('invisible', !show);
                }
              };
              apartment = {};
              number = parseInt((_document$getElementB = document.getElementById('number')) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.value);
              numbersOfRooms = parseInt((_document$getElementB2 = document.getElementById('numbersOfRooms')) === null || _document$getElementB2 === void 0 ? void 0 : _document$getElementB2.value);
              entranceNumber = parseInt((_document$getElementB3 = document.getElementById('entranceNumber')) === null || _document$getElementB3 === void 0 ? void 0 : _document$getElementB3.value);
              floor = parseInt((_document$getElementB4 = document.getElementById('floor')) === null || _document$getElementB4 === void 0 ? void 0 : _document$getElementB4.value);
              totalArea = parseFloat((_document$getElementB5 = document.getElementById('totalArea')) === null || _document$getElementB5 === void 0 ? void 0 : _document$getElementB5.value);
              residentialArea = parseFloat((_document$getElementB6 = document.getElementById('residentialArea')) === null || _document$getElementB6 === void 0 ? void 0 : _document$getElementB6.value);
              houseId = parseInt((_document$getElementB7 = document.getElementById('houseId')) === null || _document$getElementB7 === void 0 ? void 0 : _document$getElementB7.value);
              apartment.number = number;
              apartment.numbersOfRooms = numbersOfRooms;
              apartment.entranceNumber = entranceNumber;
              apartment.floor = floor;
              apartment.totalArea = totalArea;
              apartment.residentialArea = residentialArea;
              apartment.houseId = houseId;
              console.log("\u0441\u043E\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u043F\u043E \u043A\u0432\u0430\u0440\u0442\u0438\u0440:");
              console.log(apartment);

              // Вспомогательная функция: показать/скрыть ошибку

              // Основная функция валидации
              if (!validateApartmentForm()) {
                _context7.n = 2;
                break;
              }
              _context7.n = 1;
              return this.CreateApartment(apartment);
            case 1:
              result = _context7.v;
              console.log(result);
            case 2:
              return _context7.a(2);
          }
        }, _callee6, this);
      }));
      function CollectApartmentDataAndSaveToCreate() {
        return _CollectApartmentDataAndSaveToCreate.apply(this, arguments);
      }
      return CollectApartmentDataAndSaveToCreate;
    }() // Удаление пользователя из квартиры
  }, {
    key: "RemoveUserFromApartmentAndSave",
    value: function RemoveUserFromApartmentAndSave(apartmentId) {
      var _this4 = this;
      document.addEventListener('click', /*#__PURE__*/function () {
        var _ref2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(e) {
          var _user, userId, isUserRemovedFromApartmentSuccessfull, _t3;
          return _regenerator().w(function (_context8) {
            while (1) switch (_context8.p = _context8.n) {
              case 0:
                if (!e.target.closest('[data-status="remove"]')) {
                  _context8.n = 4;
                  break;
                }
                _user = e.target.closest('[data-apartment-user-id]');
                userId = _user.dataset.apartmentUserId;
                _context8.p = 1;
                _context8.n = 2;
                return _this4.RemoveUserFromApartment(apartmentId, userId);
              case 2:
                isUserRemovedFromApartmentSuccessfull = _context8.v;
                if (isUserRemovedFromApartmentSuccessfull) {
                  _this4.EditApartmentProfile(apartmentId);
                  _Modal_js__WEBPACK_IMPORTED_MODULE_4__.Modal.ShowNotification('Пользователь удален успешно', 'green');
                }
                _context8.n = 4;
                break;
              case 3:
                _context8.p = 3;
                _t3 = _context8.v;
                console.log(_t3);
                _Modal_js__WEBPACK_IMPORTED_MODULE_4__.Modal.ShowNotification('Ошибка удаления пользователя', 'red');
              case 4:
                return _context8.a(2);
            }
          }, _callee7, null, [[1, 3]]);
        }));
        return function (_x6) {
          return _ref2.apply(this, arguments);
        };
      }());
    }

    // Добавление пользователя к квартире
  }, {
    key: "AddNewUserToApartment",
    value: function AddNewUserToApartment(apartmentId) {
      var _this5 = this;
      var modalPhoneError = document.querySelector('[data-error="newPhoneNumber"]');
      document.querySelector('[data-action="add-user-to-apartment"]').addEventListener('click', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8() {
        var phoneNumber, _user2, isAddUserToApartmentSuccessfull;
        return _regenerator().w(function (_context9) {
          while (1) switch (_context9.n) {
            case 0:
              phoneNumber = document.getElementById('newPhoneNumber').value;
              if (!_this5.userValidator.validatePhoneNumber(phoneNumber).isValid) {
                _context9.n = 3;
                break;
              }
              modalPhoneError.classList.add('invisible');
              console.log("\u0442\u0435\u043B\u0435\u0444\u043E\u043D \u0432\u0430\u043B\u0438\u0434\u043D\u044B\u0439");
              _context9.n = 1;
              return _this5.userProfile.getUserByPhone(phoneNumber);
            case 1:
              _user2 = _context9.v;
              _context9.n = 2;
              return _this5.AddUserToApartment(apartmentId, _user2.id);
            case 2:
              isAddUserToApartmentSuccessfull = _context9.v;
              if (isAddUserToApartmentSuccessfull) {
                _Modal_js__WEBPACK_IMPORTED_MODULE_4__.Modal.CloseModalImmediately();
                _Modal_js__WEBPACK_IMPORTED_MODULE_4__.Modal.ShowNotification('Пользователь успешно добавлен', 'green');
                _this5.EditApartmentProfile(apartmentId);
              }
              _context9.n = 4;
              break;
            case 3:
              modalPhoneError.classList.remove('invisible');
            case 4:
              return _context9.a(2);
          }
        }, _callee8);
      })));
    }

    //получить квартиры пользователя по ид пользователя
  }, {
    key: "GetApartmentsByUserId",
    value: function () {
      var _GetApartmentsByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(userId) {
        var response, data, _t4;
        return _regenerator().w(function (_context0) {
          while (1) switch (_context0.p = _context0.n) {
            case 0:
              _context0.p = 0;
              _context0.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/user/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context0.v;
              _context0.n = 2;
              return response.json();
            case 2:
              data = _context0.v;
              if (response.ok) {
                _context0.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log("\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), data);
              return _context0.a(2, data);
            case 4:
              _context0.p = 4;
              _t4 = _context0.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), _t4);
            case 5:
              return _context0.a(2);
          }
        }, _callee9, this, [[0, 4]]);
      }));
      function GetApartmentsByUserId(_x7) {
        return _GetApartmentsByUserId.apply(this, arguments);
      }
      return GetApartmentsByUserId;
    }() //получить квартиры пользователя по номеру телефона пользователя
  }, {
    key: "GetApartmentsByUserPhone",
    value: function () {
      var _GetApartmentsByUserPhone = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0(phone) {
        var response, data, _t5;
        return _regenerator().w(function (_context1) {
          while (1) switch (_context1.p = _context1.n) {
            case 0:
              _context1.p = 0;
              _context1.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/phone/").concat(phone), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context1.v;
              _context1.n = 2;
              return response.json();
            case 2:
              data = _context1.v;
              if (response.ok) {
                _context1.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log("\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u0441 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u043E\u043C ".concat(phone, ":"), data);
              return _context1.a(2, data);
            case 4:
              _context1.p = 4;
              _t5 = _context1.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440 \u043F\u043E \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0443 ".concat(phone, ":"), _t5);
            case 5:
              return _context1.a(2);
          }
        }, _callee0, this, [[0, 4]]);
      }));
      function GetApartmentsByUserPhone(_x8) {
        return _GetApartmentsByUserPhone.apply(this, arguments);
      }
      return GetApartmentsByUserPhone;
    }() //получить квартиру по её id
  }, {
    key: "GetApartment",
    value: function () {
      var _GetApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1(id) {
        var response, data, _t6;
        return _regenerator().w(function (_context10) {
          while (1) switch (_context10.p = _context10.n) {
            case 0:
              _context10.p = 0;
              _context10.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(id), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context10.v;
              _context10.n = 2;
              return response.json();
            case 2:
              data = _context10.v;
              if (response.ok) {
                _context10.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log("\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ".concat(id, ":"), data);
              return _context10.a(2, data);
            case 4:
              _context10.p = 4;
              _t6 = _context10.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ".concat(id, ":"), _t6);
            case 5:
              return _context10.a(2);
          }
        }, _callee1, this, [[0, 4]]);
      }));
      function GetApartment(_x9) {
        return _GetApartment.apply(this, arguments);
      }
      return GetApartment;
    }() //создать квартиру
  }, {
    key: "CreateApartment",
    value: function () {
      var _CreateApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee10(apartmentData) {
        var response, data, _t7;
        return _regenerator().w(function (_context11) {
          while (1) switch (_context11.p = _context11.n) {
            case 0:
              _context11.p = 0;
              _context11.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(apartmentData)
              });
            case 1:
              response = _context11.v;
              _context11.n = 2;
              return response.json();
            case 2:
              data = _context11.v;
              if (response.ok) {
                _context11.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log('Квартира создана:', data);
              return _context11.a(2, data);
            case 4:
              _context11.p = 4;
              _t7 = _context11.v;
              console.error('Ошибка создания квартиры:', _t7);
            case 5:
              return _context11.a(2);
          }
        }, _callee10, this, [[0, 4]]);
      }));
      function CreateApartment(_x0) {
        return _CreateApartment.apply(this, arguments);
      }
      return CreateApartment;
    }() //удалить квартиру
  }, {
    key: "DeleteApartment",
    value: function () {
      var _DeleteApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee11(id) {
        var response, _t8, _t9, _t0;
        return _regenerator().w(function (_context12) {
          while (1) switch (_context12.p = _context12.n) {
            case 0:
              _context12.p = 0;
              _context12.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(id), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context12.v;
              if (response.ok) {
                _context12.n = 3;
                break;
              }
              _t8 = Error;
              _context12.n = 2;
              return response.text();
            case 2:
              _t9 = _context12.v;
              throw new _t8(_t9);
            case 3:
              console.log("\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ".concat(id, " \u0443\u0434\u0430\u043B\u0435\u043D\u0430"));
              _context12.n = 5;
              break;
            case 4:
              _context12.p = 4;
              _t0 = _context12.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ".concat(id, ":"), _t0);
            case 5:
              return _context12.a(2);
          }
        }, _callee11, this, [[0, 4]]);
      }));
      function DeleteApartment(_x1) {
        return _DeleteApartment.apply(this, arguments);
      }
      return DeleteApartment;
    }() //добавить пользователя к квартире
  }, {
    key: "AddUserToApartment",
    value: function () {
      var _AddUserToApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee12(apartmentId, userId) {
        var response, data, _t1;
        return _regenerator().w(function (_context13) {
          while (1) switch (_context13.p = _context13.n) {
            case 0:
              _context13.p = 0;
              _context13.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(apartmentId, "/users/").concat(userId), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify()
              });
            case 1:
              response = _context13.v;
              _context13.n = 2;
              return response.text();
            case 2:
              data = _context13.v;
              if (response.ok) {
                _context13.n = 3;
                break;
              }
              console.log(data);
              console.log("\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(user.id, " \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u043A \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u0435 \u0441 id ").concat(apartmentId));
              return _context13.a(2, false);
            case 3:
              return _context13.a(2, true);
            case 4:
              _context13.n = 6;
              break;
            case 5:
              _context13.p = 5;
              _t1 = _context13.v;
              console.error('Ошибка добавления пользователя к квартире:', _t1);
            case 6:
              return _context13.a(2);
          }
        }, _callee12, this, [[0, 5]]);
      }));
      function AddUserToApartment(_x10, _x11) {
        return _AddUserToApartment.apply(this, arguments);
      }
      return AddUserToApartment;
    }() //удалить пользователя из квартиры
  }, {
    key: "RemoveUserFromApartment",
    value: function () {
      var _RemoveUserFromApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee13(apartmentId, userId) {
        var response, data, _t10;
        return _regenerator().w(function (_context14) {
          while (1) switch (_context14.p = _context14.n) {
            case 0:
              _context14.p = 0;
              _context14.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(apartmentId, "/users/").concat(userId), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context14.v;
              _context14.n = 2;
              return response.text();
            case 2:
              data = _context14.v;
              if (response.ok) {
                _context14.n = 3;
                break;
              }
              console.log(data);
              return _context14.a(2, false);
            case 3:
              return _context14.a(2, true);
            case 4:
              _context14.n = 6;
              break;
            case 5:
              _context14.p = 5;
              _t10 = _context14.v;
              console.error('Ошибка удаления пользователя из квартиры:', _t10);
            case 6:
              return _context14.a(2);
          }
        }, _callee13, this, [[0, 5]]);
      }));
      function RemoveUserFromApartment(_x12, _x13) {
        return _RemoveUserFromApartment.apply(this, arguments);
      }
      return RemoveUserFromApartment;
    }() //обновить долю владения пользователя
  }, {
    key: "UpdateUserShare",
    value: function () {
      var _UpdateUserShare = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee14(apartmentId, userId, share) {
        var response, data, _t11;
        return _regenerator().w(function (_context15) {
          while (1) switch (_context15.p = _context15.n) {
            case 0:
              _context15.p = 0;
              _context15.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(apartmentId, "/users/").concat(userId, "/share"), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  share: share
                })
              });
            case 1:
              response = _context15.v;
              _context15.n = 2;
              return response.text();
            case 2:
              data = _context15.v;
              if (response.ok) {
                _context15.n = 3;
                break;
              }
              console.log(data);
              return _context15.a(2, false);
            case 3:
              return _context15.a(2, true);
            case 4:
              _context15.n = 6;
              break;
            case 5:
              _context15.p = 5;
              _t11 = _context15.v;
              console.error('Ошибка обновления доли:', _t11);
            case 6:
              return _context15.a(2);
          }
        }, _callee14, this, [[0, 5]]);
      }));
      function UpdateUserShare(_x14, _x15, _x16) {
        return _UpdateUserShare.apply(this, arguments);
      }
      return UpdateUserShare;
    }() //получить доли владения для квартиры
  }, {
    key: "GetApartmentShares",
    value: function () {
      var _GetApartmentShares = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee15(apartmentId) {
        var response, data, _t12;
        return _regenerator().w(function (_context16) {
          while (1) switch (_context16.p = _context16.n) {
            case 0:
              _context16.p = 0;
              _context16.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(apartmentId, "/shares"), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context16.v;
              _context16.n = 2;
              return response.json();
            case 2:
              data = _context16.v;
              if (response.ok) {
                _context16.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log("\u0414\u043E\u043B\u0438 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ".concat(apartmentId, ":"), data);
              return _context16.a(2, data);
            case 4:
              _context16.p = 4;
              _t12 = _context16.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0434\u043E\u043B\u0435\u0439 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ".concat(apartmentId, ":"), _t12);
            case 5:
              return _context16.a(2);
          }
        }, _callee15, this, [[0, 4]]);
      }));
      function GetApartmentShares(_x17) {
        return _GetApartmentShares.apply(this, arguments);
      }
      return GetApartmentShares;
    }() //получить статистику по квартире
  }, {
    key: "GetApartmentStatistics",
    value: function () {
      var _GetApartmentStatistics = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee16(apartmentId) {
        var response, data, _t13;
        return _regenerator().w(function (_context17) {
          while (1) switch (_context17.p = _context17.n) {
            case 0:
              _context17.p = 0;
              _context17.n = 1;
              return fetch("".concat(this.ApartmentAPIAddress, "/api/Apartment/").concat(apartmentId, "/statistics"), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context17.v;
              _context17.n = 2;
              return response.json();
            case 2:
              data = _context17.v;
              if (response.ok) {
                _context17.n = 3;
                break;
              }
              throw new Error(data);
            case 3:
              console.log("\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0430 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ".concat(apartmentId, ":"), data);
              return _context17.a(2, data);
            case 4:
              _context17.p = 4;
              _t13 = _context17.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043A\u0438 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ".concat(apartmentId, ":"), _t13);
            case 5:
              return _context17.a(2);
          }
        }, _callee16, this, [[0, 4]]);
      }));
      function GetApartmentStatistics(_x18) {
        return _GetApartmentStatistics.apply(this, arguments);
      }
      return GetApartmentStatistics;
    }()
  }]);
}();
document.addEventListener('authStateChanged', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee17() {
  var _event$detail, isAuthenticated, userData, Regex, apartmentProfile, userId, apartments, houseIds, housePromises, houses, houseMap, sorted, container, _iterator3, _step3, _step3$value, apartment, house, apartmentId;
  return _regenerator().w(function (_context18) {
    while (1) switch (_context18.n) {
      case 0:
        _event$detail = event.detail, isAuthenticated = _event$detail.isAuthenticated, userData = _event$detail.userData;
        Regex = new window.RegularExtension();
        if (!(isAuthenticated && userData)) {
          _context18.n = 5;
          break;
        }
        apartmentProfile = new ApartmentProfile();
        userId = window.authManager.userData.userId;
        if (window.location.pathname == '/') {
          apartmentProfile.InsertApartmentDataToCardOnMainPage(userId);
        }
        if (window.location.pathname == '/apartment/create') {
          apartmentProfile.SetHouseIdToCreateApartment();
          document.querySelector('[data-action="save-apartment-data"]').addEventListener('click', function () {
            apartmentProfile.CollectApartmentDataAndSaveToCreate();
          });
        }
        if (!(Regex.getUrlPathParts(window.location.href).includes('apartment') && Regex.getUrlPathParts(window.location.href).includes(userId))) {
          _context18.n = 4;
          break;
        }
        _context18.n = 1;
        return apartmentProfile.GetApartmentsByUserId(userId);
      case 1:
        apartments = _context18.v;
        if (!(!apartments || apartments.length === 0)) {
          _context18.n = 2;
          break;
        }
        document.querySelector('.apartments-by-user-list').innerHTML = '<p>Нет привязанных квартир</p>';
        return _context18.a(2);
      case 2:
        // Получаем уникальные houseId
        houseIds = _toConsumableArray(new Set(apartments.map(function (a) {
          return a.houseId;
        }))); // Загружаем все дома параллельно
        housePromises = houseIds.map(function (id) {
          return apartmentProfile.House.GetHouse(id);
        });
        _context18.n = 3;
        return Promise.all(housePromises);
      case 3:
        houses = _context18.v;
        // Создаём мапу
        houseMap = new Map(houses.map(function (h) {
          return [h.id, h];
        })); // Сортируем квартиры по номеру дома
        sorted = apartments.map(function (a) {
          return {
            apartment: a,
            house: houseMap.get(a.houseId)
          };
        }).filter(function (item) {
          return item.house;
        }).sort(function (a, b) {
          var numA = parseInt(a.house.number) || 0;
          var numB = parseInt(b.house.number) || 0;
          return numA - numB;
        }); // Вставляем с уже известным домом
        container = document.querySelector('.apartments-by-user-list');
        container.innerHTML = '';
        _iterator3 = _createForOfIteratorHelper(sorted);
        try {
          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
            _step3$value = _step3.value, apartment = _step3$value.apartment, house = _step3$value.house;
            apartmentProfile.InsertApartmentProfileToAllApartments(apartment, house);
          }
        } catch (err) {
          _iterator3.e(err);
        } finally {
          _iterator3.f();
        }
      case 4:
        if (Regex.isValidEntityUrl(window.location.href).valid && Regex.getUrlPathParts(window.location.href).includes('apartment')) {
          apartmentId = Regex.isValidEntityUrl(window.location.href).id;
          apartmentProfile.EditApartmentProfile(apartmentId);
          apartmentProfile.AddNewUserToApartment(apartmentId);
          apartmentProfile.RemoveUserFromApartmentAndSave(apartmentId);
        }
      case 5:
        return _context18.a(2);
    }
  }, _callee17);
})));

/***/ }),

/***/ "./wwwroot/js/ApartmentStatuses.js":
/*!*****************************************!*\
  !*** ./wwwroot/js/ApartmentStatuses.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ApartmentStatuses: () => (/* binding */ ApartmentStatuses)
/* harmony export */ });
/* harmony import */ var _ApartmentProfile_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ApartmentProfile.js */ "./wwwroot/js/ApartmentProfile.js");
/* harmony import */ var _Modal_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Modal.js */ "./wwwroot/js/Modal.js");
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }


var ApartmentStatuses = /*#__PURE__*/function () {
  function ApartmentStatuses() {
    _classCallCheck(this, ApartmentStatuses);
    this.apartmentAPIAddress = 'https://localhost:55683';
    this.apartmentProfile = new _ApartmentProfile_js__WEBPACK_IMPORTED_MODULE_0__.ApartmentProfile();
  }

  // 1. Получить все статусы
  return _createClass(ApartmentStatuses, [{
    key: "GetStatuses",
    value: function () {
      var _GetStatuses = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {
        var response, errorText, data, _t;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              _context.p = 0;
              _context.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status"), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context.v;
              if (response.ok) {
                _context.n = 3;
                break;
              }
              _context.n = 2;
              return response.text();
            case 2:
              errorText = _context.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText));
            case 3:
              _context.n = 4;
              return response.json();
            case 4:
              data = _context.v;
              console.log('Статусы:', data);
              return _context.a(2, data);
            case 5:
              _context.p = 5;
              _t = _context.v;
              console.error('Ошибка получения статусов:', _t.message || _t);
            case 6:
              return _context.a(2);
          }
        }, _callee, this, [[0, 5]]);
      }));
      function GetStatuses() {
        return _GetStatuses.apply(this, arguments);
      }
      return GetStatuses;
    }() // 2. Получить статус по ID
  }, {
    key: "GetStatus",
    value: function () {
      var _GetStatus = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(id) {
        var response, errorText, data, _t2;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              _context2.p = 0;
              _context2.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/").concat(id), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context2.v;
              if (response.ok) {
                _context2.n = 4;
                break;
              }
              if (!(response.status === 404)) {
                _context2.n = 2;
                break;
              }
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441 \u0441 ID ".concat(id, " \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D."));
              return _context2.a(2, null);
            case 2:
              _context2.n = 3;
              return response.text();
            case 3:
              errorText = _context2.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText));
            case 4:
              _context2.n = 5;
              return response.json();
            case 5:
              data = _context2.v;
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441 ".concat(id, ":"), data);
              return _context2.a(2, data);
            case 6:
              _context2.p = 6;
              _t2 = _context2.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 ".concat(id, ":"), _t2.message || _t2);
            case 7:
              return _context2.a(2);
          }
        }, _callee2, this, [[0, 6]]);
      }));
      function GetStatus(_x) {
        return _GetStatus.apply(this, arguments);
      }
      return GetStatus;
    }() // 3. Создать новый статус
  }, {
    key: "CreateStatus",
    value: function () {
      var _CreateStatus = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(name) {
        var response, errorMessage, contentType, errorData, errorText, data, _t3;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              _context3.p = 0;
              _context3.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  name: name
                })
              });
            case 1:
              response = _context3.v;
              if (response.ok) {
                _context3.n = 6;
                break;
              }
              contentType = response.headers.get("content-type");
              if (!(contentType && contentType.includes("application/json"))) {
                _context3.n = 3;
                break;
              }
              _context3.n = 2;
              return response.json();
            case 2:
              errorData = _context3.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(JSON.stringify(errorData));
              _context3.n = 5;
              break;
            case 3:
              _context3.n = 4;
              return response.text();
            case 4:
              errorText = _context3.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText);
            case 5:
              throw new Error(errorMessage);
            case 6:
              _context3.n = 7;
              return response.json();
            case 7:
              data = _context3.v;
              console.log('Статус создан:', data);
              return _context3.a(2, data);
            case 8:
              _context3.p = 8;
              _t3 = _context3.v;
              console.error('Ошибка создания статуса:', _t3.message || _t3);
            case 9:
              return _context3.a(2);
          }
        }, _callee3, this, [[0, 8]]);
      }));
      function CreateStatus(_x2) {
        return _CreateStatus.apply(this, arguments);
      }
      return CreateStatus;
    }() // 4. Обновить статус
  }, {
    key: "UpdateStatus",
    value: function () {
      var _UpdateStatus = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(id, newName) {
        var response, errorMessage, contentType, errorData, errorText, _t4;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.p = _context4.n) {
            case 0:
              _context4.p = 0;
              _context4.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/").concat(id), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  name: newName
                }) // Предполагается, что DTO UpdateStatusDto имеет поле name
              });
            case 1:
              response = _context4.v;
              if (response.ok) {
                _context4.n = 7;
                break;
              }
              if (!(response.status === 404)) {
                _context4.n = 2;
                break;
              }
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441 \u0441 ID ".concat(id, " \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0434\u043B\u044F \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F."));
              return _context4.a(2, false);
            case 2:
              contentType = response.headers.get("content-type");
              if (!(contentType && contentType.includes("application/json"))) {
                _context4.n = 4;
                break;
              }
              _context4.n = 3;
              return response.json();
            case 3:
              errorData = _context4.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(JSON.stringify(errorData));
              _context4.n = 6;
              break;
            case 4:
              _context4.n = 5;
              return response.text();
            case 5:
              errorText = _context4.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText);
            case 6:
              throw new Error(errorMessage);
            case 7:
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441 ".concat(id, " \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D."));
              return _context4.a(2, true);
            case 8:
              _context4.p = 8;
              _t4 = _context4.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 ".concat(id, ":"), _t4.message || _t4);
              return _context4.a(2, false);
          }
        }, _callee4, this, [[0, 8]]);
      }));
      function UpdateStatus(_x3, _x4) {
        return _UpdateStatus.apply(this, arguments);
      }
      return UpdateStatus;
    }() // 5. Удалить статус
  }, {
    key: "DeleteStatus",
    value: function () {
      var _DeleteStatus = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(id) {
        var response, _errorText, errorText, _t5;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.p = _context5.n) {
            case 0:
              _context5.p = 0;
              _context5.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/").concat(id), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context5.v;
              if (response.ok) {
                _context5.n = 6;
                break;
              }
              if (!(response.status === 404)) {
                _context5.n = 2;
                break;
              }
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441 \u0441 ID ".concat(id, " \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F."));
              return _context5.a(2, false);
            case 2:
              if (!(response.status === 409)) {
                _context5.n = 4;
                break;
              }
              _context5.n = 3;
              return response.text();
            case 3:
              _errorText = _context5.v;
              console.log("\u041A\u043E\u043D\u0444\u043B\u0438\u043A\u0442 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430 ".concat(id, ": ").concat(_errorText));
              return _context5.a(2, false);
            case 4:
              _context5.n = 5;
              return response.text();
            case 5:
              errorText = _context5.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText));
            case 6:
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441 ".concat(id, " \u0443\u0434\u0430\u043B\u0451\u043D."));
              return _context5.a(2, true);
            case 7:
              _context5.p = 7;
              _t5 = _context5.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u0430 ".concat(id, ":"), _t5.message || _t5);
              return _context5.a(2, false);
          }
        }, _callee5, this, [[0, 7]]);
      }));
      function DeleteStatus(_x5) {
        return _DeleteStatus.apply(this, arguments);
      }
      return DeleteStatus;
    }() // 6. Назначить статус пользователю для квартиры
  }, {
    key: "AssignStatusToUser",
    value: function () {
      var _AssignStatusToUser = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(apartmentId, userId, statusId) {
        var response, errorMessage, contentType, errorData, errorText, successMessage, _t6;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.p = _context6.n) {
            case 0:
              _context6.p = 0;
              _context6.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/apartment/").concat(apartmentId, "/user/").concat(userId, "/status/").concat(statusId), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                }
                // Тело запроса не требуется для этого эндпоинта
              });
            case 1:
              response = _context6.v;
              if (response.ok) {
                _context6.n = 6;
                break;
              }
              contentType = response.headers.get("content-type");
              if (!(contentType && contentType.includes("application/json"))) {
                _context6.n = 3;
                break;
              }
              _context6.n = 2;
              return response.json();
            case 2:
              errorData = _context6.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(JSON.stringify(errorData));
              _context6.n = 5;
              break;
            case 3:
              _context6.n = 4;
              return response.text();
            case 4:
              errorText = _context6.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText);
            case 5:
              throw new Error(errorMessage);
            case 6:
              _context6.n = 7;
              return response.text();
            case 7:
              successMessage = _context6.v;
              // Ожидаем текстовое сообщение
              console.log(successMessage);
              return _context6.a(2, true);
            case 8:
              _context6.p = 8;
              _t6 = _context6.v;
              console.error('Ошибка назначения статуса пользователю:', _t6.message || _t6);
              return _context6.a(2, false);
          }
        }, _callee6, this, [[0, 8]]);
      }));
      function AssignStatusToUser(_x6, _x7, _x8) {
        return _AssignStatusToUser.apply(this, arguments);
      }
      return AssignStatusToUser;
    }() // 7. Отозвать статус у пользователя для квартиры
  }, {
    key: "RevokeStatusFromUser",
    value: function () {
      var _RevokeStatusFromUser = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(apartmentId, userId, statusId) {
        var response, errorMessage, contentType, errorData, errorText, successMessage, _t7;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.p = _context7.n) {
            case 0:
              _context7.p = 0;
              _context7.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/apartment/").concat(apartmentId, "/user/").concat(userId, "/status/").concat(statusId), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
                // Тело запроса не требуется для этого эндпоинта
              });
            case 1:
              response = _context7.v;
              if (response.ok) {
                _context7.n = 7;
                break;
              }
              if (!(response.status === 404)) {
                _context7.n = 2;
                break;
              }
              console.log("\u0421\u0432\u044F\u0437\u044C \u0441\u0442\u0430\u0442\u0443\u0441\u0430 ".concat(statusId, " \u0441 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u043C ").concat(userId, " \u0434\u043B\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ").concat(apartmentId, " \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430."));
              return _context7.a(2, false);
            case 2:
              contentType = response.headers.get("content-type");
              if (!(contentType && contentType.includes("application/json"))) {
                _context7.n = 4;
                break;
              }
              _context7.n = 3;
              return response.json();
            case 3:
              errorData = _context7.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(JSON.stringify(errorData));
              _context7.n = 6;
              break;
            case 4:
              _context7.n = 5;
              return response.text();
            case 5:
              errorText = _context7.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText);
            case 6:
              throw new Error(errorMessage);
            case 7:
              _context7.n = 8;
              return response.text();
            case 8:
              successMessage = _context7.v;
              // Ожидаем текстовое сообщение
              console.log(successMessage);
              return _context7.a(2, true);
            case 9:
              _context7.p = 9;
              _t7 = _context7.v;
              console.error('Ошибка отзыва статуса у пользователя:', _t7.message || _t7);
              return _context7.a(2, false);
          }
        }, _callee7, this, [[0, 9]]);
      }));
      function RevokeStatusFromUser(_x9, _x0, _x1) {
        return _RevokeStatusFromUser.apply(this, arguments);
      }
      return RevokeStatusFromUser;
    }() // 8. Установить полный набор статусов пользователя для квартиры (заменяет все текущие)
  }, {
    key: "SetUserStatusesForApartment",
    value: function () {
      var _SetUserStatusesForApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(apartmentId, userId, statusIds) {
        var response, errorMessage, contentType, errorData, errorText, successMessage, _t8;
        return _regenerator().w(function (_context8) {
          while (1) switch (_context8.p = _context8.n) {
            case 0:
              if (Array.isArray(statusIds)) {
                _context8.n = 1;
                break;
              }
              console.error("statusIds должен быть массивом (может быть пустым)");
              return _context8.a(2, false);
            case 1:
              _context8.p = 1;
              _context8.n = 2;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/apartment/").concat(apartmentId, "/user/").concat(userId, "/statuses"), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  statusIds: statusIds
                })
              });
            case 2:
              response = _context8.v;
              if (response.ok) {
                _context8.n = 7;
                break;
              }
              contentType = response.headers.get("content-type");
              if (!(contentType && contentType.includes("application/json"))) {
                _context8.n = 4;
                break;
              }
              _context8.n = 3;
              return response.json();
            case 3:
              errorData = _context8.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(JSON.stringify(errorData));
              _context8.n = 6;
              break;
            case 4:
              _context8.n = 5;
              return response.text();
            case 5:
              errorText = _context8.v;
              errorMessage = "\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText);
            case 6:
              throw new Error(errorMessage);
            case 7:
              _context8.n = 8;
              return response.text();
            case 8:
              successMessage = _context8.v;
              console.log(successMessage);
              return _context8.a(2, true);
            case 9:
              _context8.p = 9;
              _t8 = _context8.v;
              console.error('Ошибка установки полного набора статусов:', _t8.message || _t8);
              return _context8.a(2, false);
          }
        }, _callee8, this, [[1, 9]]);
      }));
      function SetUserStatusesForApartment(_x10, _x11, _x12) {
        return _SetUserStatusesForApartment.apply(this, arguments);
      }
      return SetUserStatusesForApartment;
    }() // 9. Получить все статусы пользователя для квартиры
  }, {
    key: "GetUserStatusesForApartment",
    value: function () {
      var _GetUserStatusesForApartment = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(apartmentId, userId) {
        var response, errorText, data, _t9;
        return _regenerator().w(function (_context9) {
          while (1) switch (_context9.p = _context9.n) {
            case 0:
              _context9.p = 0;
              _context9.n = 1;
              return fetch("".concat(this.apartmentAPIAddress, "/api/Status/apartment/").concat(apartmentId, "/user/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context9.v;
              if (response.ok) {
                _context9.n = 4;
                break;
              }
              if (!(response.status === 404)) {
                _context9.n = 2;
                break;
              }
              console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(userId, " \u043D\u0435 \u0441\u0432\u044F\u0437\u0430\u043D \u0441 \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u043E\u0439 ").concat(apartmentId, " \u0438\u043B\u0438 \u0441\u0432\u044F\u0437\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u0430."));
              return _context9.a(2, []);
            case 2:
              _context9.n = 3;
              return response.text();
            case 3:
              errorText = _context9.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 ".concat(response.status, ": ").concat(errorText));
            case 4:
              _context9.n = 5;
              return response.json();
            case 5:
              data = _context9.v;
              console.log("\u0421\u0442\u0430\u0442\u0443\u0441\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, " \u0434\u043B\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ").concat(apartmentId, ":"), data);
              return _context9.a(2, data);
            case 6:
              _context9.p = 6;
              _t9 = _context9.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u043E\u0432 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, " \u0434\u043B\u044F \u043A\u0432\u0430\u0440\u0442\u0438\u0440\u044B ").concat(apartmentId, ":"), _t9.message || _t9);
              return _context9.a(2, []);
          }
        }, _callee9, this, [[0, 6]]);
      }));
      function GetUserStatusesForApartment(_x13, _x14) {
        return _GetUserStatusesForApartment.apply(this, arguments);
      }
      return GetUserStatusesForApartment;
    }()
  }, {
    key: "CollectUserStatusesAndSave",
    value: function CollectUserStatusesAndSave(apartmentId) {
      var _this = this;
      document.addEventListener('click', /*#__PURE__*/function () {
        var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0(e) {
          var user, userId, statuses, share, isShareUpdadeSuccessfull, _t0;
          return _regenerator().w(function (_context0) {
            while (1) switch (_context0.p = _context0.n) {
              case 0:
                if (!e.target.closest('[data-status="save"]')) {
                  _context0.n = 5;
                  break;
                }
                user = e.target.closest('[data-apartment-user-id]');
                userId = user.dataset.apartmentUserId;
                statuses = [];
                user.querySelectorAll('[data-ts-item]').forEach(function (status) {
                  statuses.push(status.dataset.value);
                });
                share = user.querySelector('[name="share"]').value != '' ? user.querySelector('[name="share"]').value : 0;
                _context0.p = 1;
                _context0.n = 2;
                return _this.SetUserStatusesForApartment(apartmentId, userId, statuses);
              case 2:
                _context0.n = 3;
                return _this.apartmentProfile.UpdateUserShare(apartmentId, userId, share);
              case 3:
                isShareUpdadeSuccessfull = _context0.v;
                if (isShareUpdadeSuccessfull) {
                  user.querySelector('[data-error="share"]').classList.add('invisible');
                  _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Данные о пользователях квартиры сохранены', 'green');
                } else {
                  share = 0;
                  user.querySelector('[data-error="share"]').classList.remove('invisible');
                }
                _context0.n = 5;
                break;
              case 4:
                _context0.p = 4;
                _t0 = _context0.v;
                console.log(_t0);
                user.querySelector('[data-error="share"]').classList.remove('invisible');
                _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка сохранения данных', 'red');
              case 5:
                return _context0.a(2);
            }
          }, _callee0, null, [[1, 4]]);
        }));
        return function (_x15) {
          return _ref.apply(this, arguments);
        };
      }());
    }
  }]);
}();
document.addEventListener('authStateChanged', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1() {
  var _event$detail, isAuthenticated, userData, Regex, ApartmentUserStatuses, userId, apartmentId;
  return _regenerator().w(function (_context1) {
    while (1) switch (_context1.n) {
      case 0:
        _event$detail = event.detail, isAuthenticated = _event$detail.isAuthenticated, userData = _event$detail.userData;
        Regex = new window.RegularExtension();
        ApartmentUserStatuses = new ApartmentStatuses();
        if (isAuthenticated && userData) {
          userId = window.authManager.userData.userId;
          if (Regex.isValidEntityUrl(window.location.href).valid && Regex.getUrlPathParts(window.location.href).includes('apartment')) {
            apartmentId = Regex.isValidEntityUrl(window.location.href).id;
            ApartmentUserStatuses.CollectUserStatusesAndSave(apartmentId);
          }
        }
      case 1:
        return _context1.a(2);
    }
  }, _callee1);
})));

/***/ }),

/***/ "./wwwroot/js/AuthManager.js":
/*!***********************************!*\
  !*** ./wwwroot/js/AuthManager.js ***!
  \***********************************/
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var AuthManager = /*#__PURE__*/function () {
  function AuthManager() {
    _classCallCheck(this, AuthManager);
    this.tokenKey = 'hpm_auth_token';
    this.userDataKey = 'hpm_user_data';
    this.authApiUrl = '/api/auth';
    this.isAuthenticated = false;
    this.userData = null;

    // Автоматически инициализируем при загрузке
    this.initialize();
  }

  /**
   * Инициализация менеджера аутентификации
   */
  return _createClass(AuthManager, [{
    key: "initialize",
    value: (function () {
      var _initialize = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {
        var urlParams, authCode;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.n) {
            case 0:
              // Проверяем наличие кода аутентификации в URL
              urlParams = new URLSearchParams(window.location.search);
              authCode = urlParams.get('auth');
              if (!authCode) {
                _context.n = 2;
                break;
              }
              console.log('Найден код аутентификации в URL');
              _context.n = 1;
              return this.exchangeAuthCode(authCode);
            case 1:
              // Удаляем код из URL после обработки
              this.clearAuthCodeFromUrl();
              _context.n = 3;
              break;
            case 2:
              _context.n = 3;
              return this.checkStoredToken();
            case 3:
              return _context.a(2);
          }
        }, _callee, this);
      }));
      function initialize() {
        return _initialize.apply(this, arguments);
      }
      return initialize;
    }()
    /**
     * Обменивает код аутентификации на токен
     */
    )
  }, {
    key: "exchangeAuthCode",
    value: (function () {
      var _exchangeAuthCode = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(authCode) {
        var response, result, _t;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              _context2.p = 0;
              _context2.n = 1;
              return fetch("".concat(this.authApiUrl, "/exchange-code"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  authCode: authCode
                })
              });
            case 1:
              response = _context2.v;
              _context2.n = 2;
              return response.json();
            case 2:
              result = _context2.v;
              if (response.ok && result.isAuthenticated) {
                this.setAuthData(result.token, {
                  userId: result.userId,
                  email: result.email,
                  phoneNumber: result.phoneNumber
                });
                console.log('✅ Авторизация успешна');
                this.showNotification('Добро пожаловать!', 'success');
              } else {
                console.warn('❌ Ошибка при обмене кода аутентификации:', result.message);
                this.clearAuthData();
                this.showNotification(result.message || 'Ошибка авторизации', 'error');
              }
              _context2.n = 4;
              break;
            case 3:
              _context2.p = 3;
              _t = _context2.v;
              console.error('❌ Ошибка при обмене кода аутентификации:', _t);
              this.clearAuthData();
              this.showNotification('Произошла ошибка при авторизации', 'error');
            case 4:
              return _context2.a(2);
          }
        }, _callee2, this, [[0, 3]]);
      }));
      function exchangeAuthCode(_x) {
        return _exchangeAuthCode.apply(this, arguments);
      }
      return exchangeAuthCode;
    }()
    /**
     * Проверяет сохраненный токен
     */
    )
  }, {
    key: "checkStoredToken",
    value: (function () {
      var _checkStoredToken = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {
        var token, response, result, _t2;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              token = localStorage.getItem(this.tokenKey);
              if (token) {
                _context3.n = 1;
                break;
              }
              this.clearAuthData();
              return _context3.a(2);
            case 1:
              _context3.p = 1;
              _context3.n = 2;
              return fetch("".concat(this.authApiUrl, "/validate-token"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  token: token
                })
              });
            case 2:
              response = _context3.v;
              _context3.n = 3;
              return response.json();
            case 3:
              result = _context3.v;
              if (response.ok && result.isAuthenticated) {
                this.setAuthData(token, {
                  userId: result.userId,
                  email: result.email,
                  phoneNumber: result.phoneNumber
                });
                console.log('✅ Токен валиден, пользователь авторизован');
              } else {
                console.log('❌ Токен невалиден, очищаем данные');
                this.clearAuthData();
              }
              _context3.n = 5;
              break;
            case 4:
              _context3.p = 4;
              _t2 = _context3.v;
              console.error('❌ Ошибка при проверке токена:', _t2);
              this.clearAuthData();
            case 5:
              return _context3.a(2);
          }
        }, _callee3, this, [[1, 4]]);
      }));
      function checkStoredToken() {
        return _checkStoredToken.apply(this, arguments);
      }
      return checkStoredToken;
    }()
    /**
     * Устанавливает данные аутентификации
     */
    )
  }, {
    key: "setAuthData",
    value: function setAuthData(token, userData) {
      this.isAuthenticated = true;
      this.userData = userData;
      localStorage.setItem(this.tokenKey, token);
      localStorage.setItem(this.userDataKey, JSON.stringify(userData));

      // Устанавливаем токен в cookie для серверных запросов
      document.cookie = "auth_token=".concat(token, "; path=/; max-age=3600; samesite=strict");
      this.updateUI();
    }

    /**
     * Очищает данные аутентификации
     */
  }, {
    key: "clearAuthData",
    value: function clearAuthData() {
      this.isAuthenticated = false;
      this.userData = null;
      localStorage.removeItem(this.tokenKey);
      localStorage.removeItem(this.userDataKey);

      // Удаляем cookie
      document.cookie = 'auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
      this.updateUI();
    }

    /**
     * Выполняет выход из системы
     */
  }, {
    key: "logout",
    value: (function () {
      var _logout = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4() {
        var identityServerUrl;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.n) {
            case 0:
              this.clearAuthData();
              this.showNotification('Вы вышли из системы', 'info');

              // Перенаправляем на страницу входа IdentityServer
              identityServerUrl = window.location.protocol + '//' + window.location.hostname + ':55674';
              window.location.href = "".concat(identityServerUrl, "/Auth/Login");
            case 1:
              return _context4.a(2);
          }
        }, _callee4, this);
      }));
      function logout() {
        return _logout.apply(this, arguments);
      }
      return logout;
    }()
    /**
     * Получает токен для API запросов
     */
    )
  }, {
    key: "getAuthToken",
    value: function getAuthToken() {
      return localStorage.getItem(this.tokenKey);
    }

    /**
     * Создает заголовки для авторизованных запросов
     */
  }, {
    key: "getAuthHeaders",
    value: function getAuthHeaders() {
      var token = this.getAuthToken();
      return token ? {
        'Authorization': "Bearer ".concat(token)
      } : {};
    }

    /**
     * Обновляет UI в зависимости от состояния авторизации
     */
  }, {
    key: "updateUI",
    value: function updateUI() {
      var _this = this;
      // Показываем/скрываем элементы для авторизованных пользователей
      var authElements = document.querySelectorAll('[data-auth-required]');
      var guestElements = document.querySelectorAll('[data-guest-only]');
      authElements.forEach(function (element) {
        element.style.display = _this.isAuthenticated ? 'block' : 'none';
      });
      guestElements.forEach(function (element) {
        element.style.display = _this.isAuthenticated ? 'none' : 'block';
      });

      // Обновляем информацию о пользователе
      if (this.isAuthenticated && this.userData) {
        var userEmailElements = document.querySelectorAll('[data-user-email]');
        userEmailElements.forEach(function (element) {
          element.textContent = _this.userData.email;
        });
      }

      // Обновляем состояние кнопок
      var loginButtons = document.querySelectorAll('[data-login-btn]');
      var logoutButtons = document.querySelectorAll('[data-logout-btn]');
      loginButtons.forEach(function (btn) {
        btn.style.display = _this.isAuthenticated ? 'none' : 'inline-block';
      });
      logoutButtons.forEach(function (btn) {
        btn.style.display = _this.isAuthenticated ? 'inline-block' : 'none';
        btn.onclick = function () {
          return _this.logout();
        };
      });

      // Генерируем кастомное событие для других скриптов
      var authEvent = new CustomEvent('authStateChanged', {
        detail: {
          isAuthenticated: this.isAuthenticated,
          userData: this.userData
        }
      });
      document.dispatchEvent(authEvent);
      console.log("\u0433\u0435\u043D\u0435\u0440\u0430\u0446\u0438\u044F \u0441\u043E\u0431\u044B\u0442\u0438\u044F");
    }

    /**
     * Удаляет код аутентификации из URL
     */
  }, {
    key: "clearAuthCodeFromUrl",
    value: function clearAuthCodeFromUrl() {
      var url = new URL(window.location);
      url.searchParams["delete"]('auth');
      window.history.replaceState(null, '', url);
    }

    /**
     * Показывает уведомление пользователю
     */
  }, {
    key: "showNotification",
    value: function showNotification(message) {
      var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'info';
      // Создаем простое уведомление
      var notification = document.createElement('div');
      notification.className = "notification notification-".concat(type);
      notification.textContent = message;
      notification.style.cssText = "\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 12px 20px;\n            border-radius: 4px;\n            color: white;\n            z-index: 10000;\n            font-weight: 500;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n            ".concat(type === 'success' ? 'background-color: #10B981;' : '', "\n            ").concat(type === 'error' ? 'background-color: #EF4444;' : '', "\n            ").concat(type === 'info' ? 'background-color: #3B82F6;' : '', "\n        ");
      document.body.appendChild(notification);

      // Автоматически удаляем через 5 секунд
      setTimeout(function () {
        notification.remove();
      }, 5000);

      // Добавляем возможность закрытия по клику
      notification.onclick = function () {
        return notification.remove();
      };
    }
  }]);
}(); // Глобальный экземпляр менеджера аутентификации
window.authManager = new AuthManager();

// Глобальные функции
window.isAuthenticated = function () {
  return window.authManager.isAuthenticated;
};
window.getCurrentUser = function () {
  return window.authManager.userData;
};
window.logout = function () {
  return window.authManager.logout();
};

/***/ }),

/***/ "./wwwroot/js/DateFormat.js":
/*!**********************************!*\
  !*** ./wwwroot/js/DateFormat.js ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DateFormat: () => (/* binding */ DateFormat)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var DateFormat = /*#__PURE__*/function () {
  function DateFormat() {
    _classCallCheck(this, DateFormat);
  }
  return _createClass(DateFormat, null, [{
    key: "DateFormatToRuString",
    value: function DateFormatToRuString(isoString) {
      var date = new Date(isoString);
      var hours = date.getHours();
      var minutes = date.getMinutes();
      var day = date.getUTCDate(); // без ведущего нуля
      var year = date.getUTCFullYear();
      var months = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];
      var month = months[date.getUTCMonth()]; // getUTCMonth() → 0–11

      return "".concat(day, " ").concat(month, " ").concat(year, ", ").concat(hours, ":").concat(minutes);
    }
  }]);
}();
document.addEventListener('DOMContentLoaded', function () {
  new DateFormat();
});

/***/ }),

/***/ "./wwwroot/js/FileHandler.js":
/*!***********************************!*\
  !*** ./wwwroot/js/FileHandler.js ***!
  \***********************************/
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var FileHandler = /*#__PURE__*/function () {
  function FileHandler(dropAreaSelector, fileInputSelector, previewImageSelector, removeBtnSelector, errorSelector) {
    _classCallCheck(this, FileHandler);
    this.dropArea = document.querySelector(dropAreaSelector);
    this.fileInput = document.querySelector(fileInputSelector);
    this.previewImage = document.querySelector(previewImageSelector);
    this.previewContainer = this.previewImage.closest('.preview-container');
    this.removeBtn = document.querySelector(removeBtnSelector);
    this.errorMessage = document.querySelector(errorSelector);
    this.maxFileSize = 10 * 1024 * 1024; // 10 МБ
    this.allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/svg+xml', 'image/gif'];
    this.allowedExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.svg', '.gif'];
    this.init();
  }
  return _createClass(FileHandler, [{
    key: "init",
    value: function init() {
      this.bindEvents();
    }
  }, {
    key: "bindEvents",
    value: function bindEvents() {
      var _this = this;
      // Выбор через клик
      this.dropArea.addEventListener('click', function () {
        return _this.fileInput.click();
      });
      this.fileInput.addEventListener('change', function (e) {
        return _this.onFileSelected(e);
      });

      // Drag & Drop
      var preventDefaults = function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      };
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(function (eventName) {
        _this.dropArea.addEventListener(eventName, preventDefaults, false);
      });
      ['dragenter', 'dragover'].forEach(function (eventName) {
        _this.dropArea.addEventListener(eventName, function () {
          return _this.dropArea.classList.add('drag-over');
        }, false);
      });
      ['dragleave', 'drop'].forEach(function (eventName) {
        _this.dropArea.addEventListener(eventName, function () {
          return _this.dropArea.classList.remove('drag-over');
        }, false);
      });
      this.dropArea.addEventListener('drop', function (e) {
        return _this.onDrop(e);
      });

      // Кнопка удаления
      this.removeBtn.addEventListener('click', function () {
        return _this.resetPreview();
      });
    }
  }, {
    key: "onFileSelected",
    value: function onFileSelected(event) {
      var file = event.target.files[0];
      if (file) this.processFile(file);
    }
  }, {
    key: "onDrop",
    value: function onDrop(event) {
      var file = event.dataTransfer.files[0];
      if (file) this.processFile(file);
    }
  }, {
    key: "processFile",
    value: function processFile(file) {
      if (!this.isValidFile(file)) return;
      this.displayPreview(file);
    }
  }, {
    key: "isValidFile",
    value: function isValidFile(file) {
      // Проверка расширения
      var ext = '.' + file.name.split('.').pop().toLowerCase();
      var hasValidExt = this.allowedExtensions.includes(ext);
      var hasValidType = this.allowedTypes.includes(file.type);
      if (!hasValidExt && !hasValidType) {
        this.showError('Недопустимый формат файла. Разрешены: JPG, JPEG, PNG, WEBP, SVG, GIF.');
        return false;
      }
      if (file.size > this.maxFileSize) {
        this.showError('Файл слишком большой. Максимум — 10 МБ.');
        return false;
      }
      return true;
    }
  }, {
    key: "displayPreview",
    value: function displayPreview(file) {
      var _this2 = this;
      var reader = new FileReader();
      reader.onload = function (e) {
        _this2.previewImage.src = e.target.result;
        _this2.previewImage.style.display = 'inline-block';
        _this2.removeBtn.style.display = 'inline-block';
        _this2.previewContainer.classList.remove('d-none');
        _this2.dropArea.classList.add('d-none');
      };
      reader.readAsDataURL(file);
    }
  }, {
    key: "resetPreview",
    value: function resetPreview() {
      this.previewImage.src = '';
      this.previewImage.style.display = 'none';
      this.removeBtn.style.display = 'none';
      this.fileInput.value = '';
      this.previewContainer.classList.add('d-none');
      this.dropArea.classList.remove('d-none');
    }
  }, {
    key: "showError",
    value: function showError(message) {
      var _this3 = this;
      this.errorMessage.textContent = message;
      setTimeout(function () {
        _this3.errorMessage.textContent = '';
      }, 5000);
    }
  }]);
}();
document.addEventListener('DOMContentLoaded', function () {
  if (document.getElementById('imgDropArea') != null) {
    new FileHandler('#imgDropArea', '#fileInput', '#previewImage', '#removeBtn', '#errorMessage');
  }
});

/***/ }),

/***/ "./wwwroot/js/FileStorageClient.js":
/*!*****************************************!*\
  !*** ./wwwroot/js/FileStorageClient.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   FileStorageClient: () => (/* binding */ FileStorageClient)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var FileStorageClient = /*#__PURE__*/function () {
  function FileStorageClient() {
    _classCallCheck(this, FileStorageClient);
    this.baseUrl = 'https://localhost:55693';
    this.apiPath = '/api/files';
  }

  /**
   * Получить полный URL для эндпоинта
   * @param {string} endpoint 
   * @returns {string}
   */
  return _createClass(FileStorageClient, [{
    key: "_GetUrl",
    value: function _GetUrl(endpoint) {
      return "".concat(this.baseUrl).concat(this.apiPath).concat(endpoint);
    }

    /**
     * Загрузить файл на сервер
     * @param {File} file - Файл для загрузки
     * @returns {Promise<Object>} Метаданные загруженного файла с URL
     * @property {number} id - ID файла
     * @property {string} fileUrl - URL для просмотра файла
     * @property {string} downloadUrl - URL для скачивания файла
     * @example
     * const result = await client.uploadFile(file);
     * console.log('Файл доступен по:', result.fileUrl);
     * document.getElementById('preview').src = result.fileUrl;
     */
  }, {
    key: "UploadFile",
    value: (function () {
      var _UploadFile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(file) {
        var formData, response, error, _t;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              if (file instanceof File) {
                _context.n = 1;
                break;
              }
              throw new Error('Параметр должен быть экземпляром File');
            case 1:
              formData = new FormData();
              formData.append('file', file);
              _context.p = 2;
              _context.n = 3;
              return fetch(this._GetUrl('/upload'), {
                method: 'POST',
                body: formData
              });
            case 3:
              response = _context.v;
              if (response.ok) {
                _context.n = 5;
                break;
              }
              _context.n = 4;
              return response.text();
            case 4:
              error = _context.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438: ".concat(error));
            case 5:
              _context.n = 6;
              return response.json();
            case 6:
              return _context.a(2, _context.v);
            case 7:
              _context.p = 7;
              _t = _context.v;
              console.error('Ошибка при загрузке файла:', _t);
              throw _t;
            case 8:
              return _context.a(2);
          }
        }, _callee, this, [[2, 7]]);
      }));
      function UploadFile(_x) {
        return _UploadFile.apply(this, arguments);
      }
      return UploadFile;
    }()
    /**
     * Получить URL для просмотра файла по имени
     * @param {string} bucketName - Имя бакета
     * @param {string} fileName - Имя файла
     * @returns {string} URL для просмотра
     * @example
     * const url = client.getFileViewUrl('documents', 'abc123_document.pdf');
     * document.getElementById('preview').src = url;
     */
    )
  }, {
    key: "GetFileViewUrl",
    value: function GetFileViewUrl(bucketName, fileName) {
      return this._GetUrl("/view/".concat(bucketName, "/").concat(fileName));
    }

    /**
     * Получить URL для скачивания файла по ID
     * @param {number} id - ID файла
     * @returns {string} URL для скачивания
     * @example
     * const url = client.getFileDownloadUrl(123);
     * window.open(url, '_blank');
     */
  }, {
    key: "GetFileDownloadUrl",
    value: function GetFileDownloadUrl(id) {
      return this._GetUrl("/download/".concat(id));
    }

    /**
     * Получить метаданные файла по ID
     * @param {number} id - ID файла
     * @returns {Promise<Object>} Метаданные файла
     * @example
     * const metadata = await client.getFileMetadata(123);
     * console.log('Размер файла:', metadata.fileSize);
     */
  }, {
    key: "GetFileMetadata",
    value: (function () {
      var _GetFileMetadata = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(id) {
        var response, error, _t2;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              _context2.p = 0;
              _context2.n = 1;
              return fetch(this._GetUrl("/".concat(id)), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context2.v;
              if (response.ok) {
                _context2.n = 3;
                break;
              }
              _context2.n = 2;
              return response.text();
            case 2:
              error = _context2.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043C\u0435\u0442\u0430\u0434\u0430\u043D\u043D\u044B\u0445: ".concat(error));
            case 3:
              _context2.n = 4;
              return response.json();
            case 4:
              return _context2.a(2, _context2.v);
            case 5:
              _context2.p = 5;
              _t2 = _context2.v;
              console.error('Ошибка при получении метаданных:', _t2);
              throw _t2;
            case 6:
              return _context2.a(2);
          }
        }, _callee2, this, [[0, 5]]);
      }));
      function GetFileMetadata(_x2) {
        return _GetFileMetadata.apply(this, arguments);
      }
      return GetFileMetadata;
    }()
    /**
     * Скачать файл по ID
     * @param {number} id - ID файла
     * @param {string} saveAs - Имя файла для сохранения (опционально, по умолчанию из сервера)
     * @returns {Promise<void>}
     * @example
     * await client.downloadFile(123, 'my-document.pdf');
     */
    )
  }, {
    key: "DownloadFile",
    value: (function () {
      var _DownloadFile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(id) {
        var saveAs,
          response,
          error,
          blob,
          fileName,
          contentDisposition,
          matches,
          url,
          a,
          _args3 = arguments,
          _t3;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              saveAs = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : null;
              _context3.p = 1;
              _context3.n = 2;
              return fetch(this._GetUrl("/download/".concat(id)), {
                method: 'GET'
              });
            case 2:
              response = _context3.v;
              if (response.ok) {
                _context3.n = 4;
                break;
              }
              _context3.n = 3;
              return response.text();
            case 3:
              error = _context3.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u044F: ".concat(error));
            case 4:
              _context3.n = 5;
              return response.blob();
            case 5:
              blob = _context3.v;
              // Получаем имя файла из заголовка или используем переданное
              fileName = saveAs;
              if (!fileName) {
                contentDisposition = response.headers.get('Content-Disposition');
                if (contentDisposition) {
                  matches = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
                  if (matches && matches[1]) {
                    fileName = matches[1].replace(/['"]/g, '');
                  }
                }
              }
              fileName = fileName || "file-".concat(id);

              // Создаем ссылку для скачивания
              url = URL.createObjectURL(blob);
              a = document.createElement('a');
              a.style.display = 'none';
              a.href = url;
              a.download = fileName;
              document.body.appendChild(a);
              a.click();

              // Очищаем
              URL.revokeObjectURL(url);
              document.body.removeChild(a);
              _context3.n = 7;
              break;
            case 6:
              _context3.p = 6;
              _t3 = _context3.v;
              console.error('Ошибка при скачивании файла:', _t3);
              throw _t3;
            case 7:
              return _context3.a(2);
          }
        }, _callee3, this, [[1, 6]]);
      }));
      function DownloadFile(_x3) {
        return _DownloadFile.apply(this, arguments);
      }
      return DownloadFile;
    }()
    /**
     * Получить Blob файла (без автоматического скачивания)
     * Полезно для предпросмотра изображений или встраивания в страницу
     * @param {number} id - ID файла
     * @returns {Promise<Blob>}
     * @example
     * const blob = await client.getFileBlob(123);
     * const url = URL.createObjectURL(blob);
     * document.getElementById('preview').src = url;
     */
    )
  }, {
    key: "GetFileBlob",
    value: (function () {
      var _GetFileBlob = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(id) {
        var response, error, _t4;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.p = _context4.n) {
            case 0:
              _context4.p = 0;
              _context4.n = 1;
              return fetch(this._GetUrl("/download/".concat(id)), {
                method: 'GET'
              });
            case 1:
              response = _context4.v;
              if (response.ok) {
                _context4.n = 3;
                break;
              }
              _context4.n = 2;
              return response.text();
            case 2:
              error = _context4.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430: ".concat(error));
            case 3:
              _context4.n = 4;
              return response.blob();
            case 4:
              return _context4.a(2, _context4.v);
            case 5:
              _context4.p = 5;
              _t4 = _context4.v;
              console.error('Ошибка при получении blob:', _t4);
              throw _t4;
            case 6:
              return _context4.a(2);
          }
        }, _callee4, this, [[0, 5]]);
      }));
      function GetFileBlob(_x4) {
        return _GetFileBlob.apply(this, arguments);
      }
      return GetFileBlob;
    }()
    /**
     * Получить URL для предпросмотра файла
     * @param {number} id - ID файла
     * @returns {Promise<string>} Object URL для использования в src
     * @example
     * const url = await client.getFilePreviewUrl(123);
     * document.getElementById('image').src = url;
     * // Не забудьте вызвать URL.revokeObjectURL(url) когда URL больше не нужен
     */
    )
  }, {
    key: "GetFilePreviewUrl",
    value: (function () {
      var _GetFilePreviewUrl = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(id) {
        var blob;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.n) {
            case 0:
              _context5.n = 1;
              return this.getFileBlob(id);
            case 1:
              blob = _context5.v;
              return _context5.a(2, URL.createObjectURL(blob));
          }
        }, _callee5, this);
      }));
      function GetFilePreviewUrl(_x5) {
        return _GetFilePreviewUrl.apply(this, arguments);
      }
      return GetFilePreviewUrl;
    }()
    /**
     * Удалить файл по ID
     * @param {number} id - ID файла
     * @returns {Promise<boolean>}
     * @example
     * await client.deleteFile(123);
     * console.log('Файл удален');
     */
    )
  }, {
    key: "DeleteFile",
    value: (function () {
      var _DeleteFile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(id) {
        var response, error, _t5;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.p = _context6.n) {
            case 0:
              _context6.p = 0;
              _context6.n = 1;
              return fetch(this._GetUrl("/".concat(id)), {
                method: 'DELETE'
              });
            case 1:
              response = _context6.v;
              if (response.ok) {
                _context6.n = 3;
                break;
              }
              _context6.n = 2;
              return response.text();
            case 2:
              error = _context6.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F: ".concat(error));
            case 3:
              return _context6.a(2, true);
            case 4:
              _context6.p = 4;
              _t5 = _context6.v;
              console.error('Ошибка при удалении файла:', _t5);
              throw _t5;
            case 5:
              return _context6.a(2);
          }
        }, _callee6, this, [[0, 4]]);
      }));
      function DeleteFile(_x6) {
        return _DeleteFile.apply(this, arguments);
      }
      return DeleteFile;
    }()
    /**
     * Загрузить несколько файлов последовательно
     * @param {File[]} files - Массив файлов
     * @returns {Promise<Object[]>} Массив результатов загрузки
     * @example
     * const results = await client.uploadMultipleFiles(filesArray);
     * const successful = results.filter(r => r.success);
     * console.log(`Загружено ${successful.length} из ${results.length}`);
     */
    )
  }, {
    key: "UploadMultipleFiles",
    value: (function () {
      var _UploadMultipleFiles = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(files) {
        var results, _iterator, _step, file, result, _t6, _t7;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.p = _context7.n) {
            case 0:
              results = [];
              _iterator = _createForOfIteratorHelper(files);
              _context7.p = 1;
              _iterator.s();
            case 2:
              if ((_step = _iterator.n()).done) {
                _context7.n = 7;
                break;
              }
              file = _step.value;
              _context7.p = 3;
              _context7.n = 4;
              return this.uploadFile(file);
            case 4:
              result = _context7.v;
              results.push({
                success: true,
                fileName: file.name,
                data: result
              });
              _context7.n = 6;
              break;
            case 5:
              _context7.p = 5;
              _t6 = _context7.v;
              results.push({
                success: false,
                fileName: file.name,
                error: _t6.message
              });
            case 6:
              _context7.n = 2;
              break;
            case 7:
              _context7.n = 9;
              break;
            case 8:
              _context7.p = 8;
              _t7 = _context7.v;
              _iterator.e(_t7);
            case 9:
              _context7.p = 9;
              _iterator.f();
              return _context7.f(9);
            case 10:
              return _context7.a(2, results);
          }
        }, _callee7, this, [[3, 5], [1, 8, 9, 10]]);
      }));
      function UploadMultipleFiles(_x7) {
        return _UploadMultipleFiles.apply(this, arguments);
      }
      return UploadMultipleFiles;
    }()
    /**
     * Загрузить несколько файлов параллельно (быстрее, но больше нагрузка на сервер)
     * @param {File[]} files - Массив файлов
     * @returns {Promise<Object[]>} Массив результатов загрузки
     * @example
     * const results = await client.uploadMultipleFilesParallel(filesArray);
     */
    )
  }, {
    key: "UploadMultipleFilesParallel",
    value: (function () {
      var _UploadMultipleFilesParallel = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(files) {
        var _this = this;
        var uploadPromises;
        return _regenerator().w(function (_context9) {
          while (1) switch (_context9.n) {
            case 0:
              uploadPromises = files.map(/*#__PURE__*/function () {
                var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(file) {
                  var result, _t8;
                  return _regenerator().w(function (_context8) {
                    while (1) switch (_context8.p = _context8.n) {
                      case 0:
                        _context8.p = 0;
                        _context8.n = 1;
                        return _this.uploadFile(file);
                      case 1:
                        result = _context8.v;
                        return _context8.a(2, {
                          success: true,
                          fileName: file.name,
                          data: result
                        });
                      case 2:
                        _context8.p = 2;
                        _t8 = _context8.v;
                        return _context8.a(2, {
                          success: false,
                          fileName: file.name,
                          error: _t8.message
                        });
                    }
                  }, _callee8, null, [[0, 2]]);
                }));
                return function (_x9) {
                  return _ref.apply(this, arguments);
                };
              }());
              _context9.n = 1;
              return Promise.all(uploadPromises);
            case 1:
              return _context9.a(2, _context9.v);
          }
        }, _callee9);
      }));
      function UploadMultipleFilesParallel(_x8) {
        return _UploadMultipleFilesParallel.apply(this, arguments);
      }
      return UploadMultipleFilesParallel;
    }()
    /**
     * Установить базовый URL
     * @param {string} newBaseUrl 
     */
    )
  }, {
    key: "SetBaseUrl",
    value: function SetBaseUrl(newBaseUrl) {
      this.baseUrl = newBaseUrl.endsWith('/') ? newBaseUrl.slice(0, -1) : newBaseUrl;
    }

    /**
     * Получить текущий базовый URL
     * @returns {string}
     */
  }, {
    key: "GetBaseUrl",
    value: function GetBaseUrl() {
      return this.baseUrl;
    }
  }]);
}();
document.addEventListener('authStateChanged', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0() {
  var _event$detail, isAuthenticated, userData, FileStorage;
  return _regenerator().w(function (_context0) {
    while (1) switch (_context0.n) {
      case 0:
        _event$detail = event.detail, isAuthenticated = _event$detail.isAuthenticated, userData = _event$detail.userData;
        if (isAuthenticated && userData) {
          FileStorage = new FileStorageClient();
        }
      case 1:
        return _context0.a(2);
    }
  }, _callee0);
})));

// ============================================
// Примеры использования
// ============================================

/*
// 1. Создание клиента
const fileClient = new FileStorageClient('http://localhost:55692');

// 2. Загрузка одного файла
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    try {
        const result = await fileClient.uploadFile(file);
        console.log('Файл загружен:', result);
        // result = { id: 123, bucket: "documents", message: "...", originalFileName: "..." }
    } catch (error) {
        console.error('Ошибка загрузки:', error.message);
    }
});

// 3. Загрузка нескольких файлов
const multiFileInput = document.getElementById('multiFileInput');
multiFileInput.addEventListener('change', async (e) => {
    const files = Array.from(e.target.files);
    
    // Последовательная загрузка (меньше нагрузка на сервер)
    const results = await fileClient.uploadMultipleFiles(files);
    
    // Или параллельная (быстрее)
    // const results = await fileClient.uploadMultipleFilesParallel(files);
    
    console.log('Результаты:', results);
});

// 4. Получение метаданных
const metadata = await fileClient.getFileMetadata(123);
console.log('Информация о файле:', metadata);

// 5. Скачивание файла
await fileClient.downloadFile(123); // Автоматически начнет загрузку
// или с кастомным именем:
await fileClient.downloadFile(123, 'мой-документ.pdf');

// 6. Предпросмотр изображения
const imageUrl = await fileClient.getFilePreviewUrl(123);
document.getElementById('preview').src = imageUrl;
// Важно: очистите URL когда он больше не нужен
// URL.revokeObjectURL(imageUrl);

// 7. Удаление файла
const deleteBtn = document.getElementById('deleteBtn');
deleteBtn.addEventListener('click', async () => {
    try {
        await fileClient.deleteFile(123);
        console.log('Файл удален');
    } catch (error) {
        console.error('Ошибка удаления:', error.message);
    }
});

// 8. Пример с async/await в try-catch
async function handleFileUpload(file) {
    try {
        const uploadResult = await fileClient.uploadFile(file);
        console.log('ID загруженного файла:', uploadResult.id);
        
        const metadata = await fileClient.getFileMetadata(uploadResult.id);
        console.log('Размер файла:', metadata.fileSize, 'байт');
        
        return uploadResult.id;
    } catch (error) {
        console.error('Произошла ошибка:', error.message);
        throw error;
    }
}

// 9. Работа с Blob для встраивания
async function embedFile(fileId, targetElement) {
    const blob = await fileClient.getFileBlob(fileId);
    const url = URL.createObjectURL(blob);
    
    targetElement.src = url;
    
    // Очистка после использования
    targetElement.addEventListener('load', () => {
        URL.revokeObjectURL(url);
    });
}
*/

/***/ }),

/***/ "./wwwroot/js/HouseValidator.js":
/*!**************************************!*\
  !*** ./wwwroot/js/HouseValidator.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   HouseValidator: () => (/* binding */ HouseValidator)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var HouseValidator = /*#__PURE__*/function () {
  function HouseValidator() {
    _classCallCheck(this, HouseValidator);
  }
  return _createClass(HouseValidator, null, [{
    key: "validate",
    value: function validate(house) {
      var errors = {};

      // Обязательные текстовые поля
      var requiredTextFields = ['city', 'street', 'number'];
      for (var _i = 0, _requiredTextFields = requiredTextFields; _i < _requiredTextFields.length; _i++) {
        var field = _requiredTextFields[_i];
        if (!house[field] || typeof house[field] !== 'string' || house[field].trim() === '') {
          errors[field] = 'Обязательное поле';
        }
      }

      // Числовые поля: entrances, floors, builtYear — должны быть >= 1
      var positiveIntFields = ['entrances', 'floors', 'builtYear'];
      for (var _i2 = 0, _positiveIntFields = positiveIntFields; _i2 < _positiveIntFields.length; _i2++) {
        var _field = _positiveIntFields[_i2];
        var val = house[_field];
        if (typeof val !== 'number' || !Number.isInteger(val) || val < 1) {
          errors[_field] = 'Должно быть целым числом ≥ 1';
        }
      }

      // Год постройки: разумный диапазон (например, 1800–текущий год + 1)
      var currentYear = new Date().getFullYear();
      if (house.builtYear && (house.builtYear < 1800 || house.builtYear > currentYear + 1)) {
        errors.builtYear = "\u0413\u043E\u0434 \u0434\u043E\u043B\u0436\u0435\u043D \u0431\u044B\u0442\u044C \u043E\u0442 1800 \u0434\u043E ".concat(currentYear + 1);
      }

      // Площади: apartmentsArea, totalArea, landArea — должны быть >= 0 или null
      var areaFields = ['apartmentsArea', 'totalArea', 'landArea'];
      for (var _i3 = 0, _areaFields = areaFields; _i3 < _areaFields.length; _i3++) {
        var _field2 = _areaFields[_i3];
        var _val = house[_field2];
        if (_val !== null && (typeof _val !== 'number' || _val < 0)) {
          errors[_field2] = 'Площадь должна быть ≥ 0';
        }
      }

      // Почтовый индекс: может быть null или строка (опционально можно добавить формат)
      if (house.postIndex !== null && (typeof house.postIndex !== 'string' || house.postIndex.trim() === '')) {
        errors.postIndex = 'Некорректный почтовый индекс';
      }

      // Булевы поля: должны быть boolean
      var boolFields = ['hasGas', 'hasElectricity', 'hasElevator', 'isApartmentBuilding'];
      for (var _i4 = 0, _boolFields = boolFields; _i4 < _boolFields.length; _i4++) {
        var _field3 = _boolFields[_i4];
        if (typeof house[_field3] !== 'boolean') {
          errors[_field3] = 'Должно быть логическим значением';
        }
      }
      return {
        isValid: Object.keys(errors).length === 0,
        errors: errors
      };
    }

    // Опционально: метод для отображения ошибок в UI
  }, {
    key: "displayErrors",
    value: function displayErrors(errors) {
      // Скрываем все ошибки
      document.querySelectorAll('[data-error]').forEach(function (el) {
        el.classList.add('invisible');
        el.textContent = '';
      });

      // Показываем ошибки по ключам
      for (var _i5 = 0, _Object$entries = Object.entries(errors); _i5 < _Object$entries.length; _i5++) {
        var _Object$entries$_i = _slicedToArray(_Object$entries[_i5], 2),
          field = _Object$entries$_i[0],
          message = _Object$entries$_i[1];
        var errorEl = document.querySelector("[data-error=\"".concat(field, "\"]"));
        if (errorEl) {
          errorEl.textContent = message;
          errorEl.classList.remove('invisible');
        }
      }
    }
  }]);
}();

/***/ }),

/***/ "./wwwroot/js/Modal.js":
/*!*****************************!*\
  !*** ./wwwroot/js/Modal.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Modal: () => (/* binding */ Modal)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var Modal = /*#__PURE__*/function () {
  function Modal() {
    _classCallCheck(this, Modal);
    this.OpenModal();
    this.CloseModal();
    this.CloseModalOnOutsideClick();
  }
  return _createClass(Modal, [{
    key: "OpenModal",
    value: function OpenModal() {
      document.querySelectorAll('[data-modal="open"]').forEach(function (modalCall) {
        modalCall.addEventListener('click', function () {
          document.querySelector('.modal-overview').classList.add('active');
        });
      });
    }
  }, {
    key: "CloseModal",
    value: function CloseModal() {
      document.querySelectorAll('.modal-close').forEach(function (cross) {
        cross.addEventListener('click', function () {
          cross.closest('.modal-overview').classList.remove('active');
        });
      });
    }
  }, {
    key: "CloseModalOnOutsideClick",
    value: function CloseModalOnOutsideClick() {
      var modalOverview = document.querySelector('.modal-overview');
      if (modalOverview) {
        modalOverview.addEventListener('click', function (event) {
          if (!event.target.classList.contains('modal-content-wrapper') && event.target.closest('.modal-content-wrapper') == null) {
            modalOverview.classList.remove('active');
          }
        });
      }
    }
  }], [{
    key: "CloseModalImmediately",
    value: function CloseModalImmediately() {
      document.querySelector('.modal-overview').classList.remove('active');
    }
  }, {
    key: "ShowNotification",
    value: function ShowNotification(text, color) {
      var notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = text;
      notification.style.backgroundColor = color;

      // Добавляем уведомление в документ
      document.body.appendChild(notification);

      // Через 3 секунды удаляем уведомление
      setTimeout(function () {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }
  }]);
}();
document.addEventListener('DOMContentLoaded', function () {
  new Modal();
});

/***/ }),

/***/ "./wwwroot/js/Multiselect.js":
/*!***********************************!*\
  !*** ./wwwroot/js/Multiselect.js ***!
  \***********************************/
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var Multiselect = /*#__PURE__*/function () {
  function Multiselect() {
    _classCallCheck(this, Multiselect);
    this.instances = new Map();
  }

  /**
   * Инициализирует Tom Select с чекбоксами на <select multiple>
   * @param {string} elementId — ID элемента <select>
   * @param {Object} [customOptions] — дополнительные опции Tom Select
   * @returns {TomSelect | null}
   */
  return _createClass(Multiselect, [{
    key: "init",
    value: function init(elementId) {
      var customOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var selectElement = document.getElementById(elementId);
      if (!selectElement) {
        console.warn("Multiselect: \u044D\u043B\u0435\u043C\u0435\u043D\u0442 \u0441 id=\"".concat(elementId, "\" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D."));
        return null;
      }

      // Защита от повторной инициализации
      if (this.instances.has(elementId)) {
        console.warn("Multiselect: \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D \u043D\u0430 \"".concat(elementId, "\"."));
        return this.instances.get(elementId);
      }

      // Базовые настройки: мультиселект + чекбоксы
      var defaultOptions = {
        plugins: {
          checkbox_options: {} // ← чекбоксы в выпадающем списке
        },
        maxItems: null,
        // разрешить множественный выбор
        hidePlaceholder: true,
        closeAfterSelect: false,
        // не закрывать после выбора (удобно при мультивыборе)
        dropdownParent: 'body' // чтобы не обрезалось в модалках и т.п.
      };
      var finalOptions = _objectSpread(_objectSpread({}, defaultOptions), customOptions);

      // Создаём экземпляр Tom Select
      var tomSelectInstance = new TomSelect("#".concat(elementId), finalOptions);

      // Сохраняем для последующего доступа
      this.instances.set(elementId, tomSelectInstance);
      selectElement._tomSelect = tomSelectInstance;
      return tomSelectInstance;
    }

    /**
     * Получить экземпляр Tom Select по ID
     * @param {string} elementId
     * @returns {TomSelect | undefined}
     */
  }, {
    key: "getInstance",
    value: function getInstance(elementId) {
      return this.instances.get(elementId);
    }

    /**
     * Уничтожить инстанс (например, при удалении из DOM)
     * @param {string} elementId
     */
  }, {
    key: "destroy",
    value: function destroy(elementId) {
      var instance = this.instances.get(elementId);
      if (instance) {
        instance.destroy();
        this.instances["delete"](elementId);
        var el = document.getElementById(elementId);
        if (el) delete el._tomSelect;
      }
    }

    /**
     * Получить выбранные значения (массив строк)
     * @param {string} elementId
     * @returns {string[]}
     */
  }, {
    key: "getValues",
    value: function getValues(elementId) {
      var instance = this.getInstance(elementId);
      return instance ? instance.getValue() : [];
    }

    /**
     * Установить значения программно
     * @param {string} elementId
     * @param {string[]} values
     */
  }, {
    key: "setValues",
    value: function setValues(elementId, values) {
      var instance = this.getInstance(elementId);
      if (instance) {
        instance.setValue(values, false); // false = не вызывать onChange
      }
    }
  }]);
}();
window.Multiselect = Multiselect;

/***/ }),

/***/ "./wwwroot/js/NotificationClient.js":
/*!******************************************!*\
  !*** ./wwwroot/js/NotificationClient.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   NotificationClient: () => (/* binding */ NotificationClient)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var NotificationClient = /*#__PURE__*/function () {
  function NotificationClient() {
    _classCallCheck(this, NotificationClient);
    this.baseUrl = 'https://localhost:55691';
    this.apiPath = '/api/Notifications';
  }

  /**
   * Получить полный URL для эндпоинта
   * @param {string} endpoint 
   * @returns {string}
   */
  return _createClass(NotificationClient, [{
    key: "_GetUrl",
    value: function _GetUrl(endpoint) {
      return "".concat(this.baseUrl).concat(this.apiPath).concat(endpoint);
    }

    /**
     * Получить все уведомления
     * @returns {Promise<Array>} Массив всех уведомлений
     * @example
     * const notifications = await client.getAllNotifications();
     * console.log('Всего уведомлений:', notifications.length);
     */
  }, {
    key: "GetAllNotifications",
    value: (function () {
      var _GetAllNotifications = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {
        var response, error, _t;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              _context.p = 0;
              _context.n = 1;
              return fetch(this._GetUrl(''), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context.v;
              if (response.ok) {
                _context.n = 3;
                break;
              }
              _context.n = 2;
              return response.text();
            case 2:
              error = _context.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439: ".concat(error));
            case 3:
              _context.n = 4;
              return response.json();
            case 4:
              return _context.a(2, _context.v);
            case 5:
              _context.p = 5;
              _t = _context.v;
              console.error('Ошибка при получении всех уведомлений:', _t);
              throw _t;
            case 6:
              return _context.a(2);
          }
        }, _callee, this, [[0, 5]]);
      }));
      function GetAllNotifications() {
        return _GetAllNotifications.apply(this, arguments);
      }
      return GetAllNotifications;
    }()
    /**
     * Получить уведомление по ID
     * @param {string} id - GUID уведомления
     * @returns {Promise<Object|null>} Уведомление или null
     * @example
     * const notification = await client.getNotificationById('123e4567-e89b-12d3-a456-426614174000');
     * if (notification) {
     *     console.log('Заголовок:', notification.title);
     * }
     */
    )
  }, {
    key: "GetNotificationById",
    value: (function () {
      var _GetNotificationById = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(id) {
        var response, error, _t2;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              _context2.p = 0;
              _context2.n = 1;
              return fetch(this._GetUrl("/".concat(id)), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context2.v;
              if (response.ok) {
                _context2.n = 4;
                break;
              }
              if (!(response.status === 404)) {
                _context2.n = 2;
                break;
              }
              return _context2.a(2, null);
            case 2:
              _context2.n = 3;
              return response.text();
            case 3:
              error = _context2.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F: ".concat(error));
            case 4:
              _context2.n = 5;
              return response.json();
            case 5:
              return _context2.a(2, _context2.v);
            case 6:
              _context2.p = 6;
              _t2 = _context2.v;
              console.error('Ошибка при получении уведомления по ID:', _t2);
              throw _t2;
            case 7:
              return _context2.a(2);
          }
        }, _callee2, this, [[0, 6]]);
      }));
      function GetNotificationById(_x) {
        return _GetNotificationById.apply(this, arguments);
      }
      return GetNotificationById;
    }()
    /**
     * Получить уведомления для конкретного пользователя
     * @param {string} userId - GUID пользователя
     * @returns {Promise<Array>} Массив уведомлений пользователя
     * @example
     * const userNotifications = await client.getNotificationsByUserId('123e4567-e89b-12d3-a456-426614174000');
     * console.log('Уведомлений для пользователя:', userNotifications.length);
     */
    )
  }, {
    key: "GetNotificationsByUserId",
    value: (function () {
      var _GetNotificationsByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(userId) {
        var response, error, _t3;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              _context3.p = 0;
              _context3.n = 1;
              return fetch(this._GetUrl("/user/".concat(userId)), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context3.v;
              if (response.ok) {
                _context3.n = 3;
                break;
              }
              _context3.n = 2;
              return response.text();
            case 2:
              error = _context3.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F: ".concat(error));
            case 3:
              _context3.n = 4;
              return response.json();
            case 4:
              return _context3.a(2, _context3.v);
            case 5:
              _context3.p = 5;
              _t3 = _context3.v;
              console.error('Ошибка при получении уведомлений пользователя:', _t3);
              throw _t3;
            case 6:
              return _context3.a(2);
          }
        }, _callee3, this, [[0, 5]]);
      }));
      function GetNotificationsByUserId(_x2) {
        return _GetNotificationsByUserId.apply(this, arguments);
      }
      return GetNotificationsByUserId;
    }()
    /**
     * Получить непрочитанные уведомления для конкретного пользователя
     * @param {string} userId - GUID пользователя
     * @returns {Promise<Array>} Массив непрочитанных уведомлений
     * @example
     * const unread = await client.getUnreadNotificationsByUserId('123e4567-e89b-12d3-a456-426614174000');
     * console.log('Непрочитанных:', unread.length);
     */
    )
  }, {
    key: "GetUnreadNotificationsByUserId",
    value: (function () {
      var _GetUnreadNotificationsByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(userId) {
        var response, error, _t4;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.p = _context4.n) {
            case 0:
              _context4.p = 0;
              _context4.n = 1;
              return fetch(this._GetUrl("/user/".concat(userId, "/unread")), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context4.v;
              if (response.ok) {
                _context4.n = 3;
                break;
              }
              _context4.n = 2;
              return response.text();
            case 2:
              error = _context4.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043D\u0435\u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u0445 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439: ".concat(error));
            case 3:
              _context4.n = 4;
              return response.json();
            case 4:
              return _context4.a(2, _context4.v);
            case 5:
              _context4.p = 5;
              _t4 = _context4.v;
              console.error('Ошибка при получении непрочитанных уведомлений пользователя:', _t4);
              throw _t4;
            case 6:
              return _context4.a(2);
          }
        }, _callee4, this, [[0, 5]]);
      }));
      function GetUnreadNotificationsByUserId(_x3) {
        return _GetUnreadNotificationsByUserId.apply(this, arguments);
      }
      return GetUnreadNotificationsByUserId;
    }()
    /**
     * Получить количество непрочитанных уведомлений для пользователя
     * @param {string} userId - GUID пользователя
     * @returns {Promise<number>} Количество непрочитанных уведомлений
     * @example
     * const count = await client.getUnreadCount('123e4567-e89b-12d3-a456-426614174000');
     * document.getElementById('badge').textContent = count;
     */
    )
  }, {
    key: "GetUnreadCount",
    value: (function () {
      var _GetUnreadCount = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(userId) {
        var response, error, _t5;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.p = _context5.n) {
            case 0:
              _context5.p = 0;
              _context5.n = 1;
              return fetch(this._GetUrl("/user/".concat(userId, "/unread/count")), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context5.v;
              if (response.ok) {
                _context5.n = 3;
                break;
              }
              _context5.n = 2;
              return response.text();
            case 2:
              error = _context5.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u043D\u0435\u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u0445: ".concat(error));
            case 3:
              _context5.n = 4;
              return response.json();
            case 4:
              return _context5.a(2, _context5.v);
            case 5:
              _context5.p = 5;
              _t5 = _context5.v;
              console.error('Ошибка при получении количества непрочитанных уведомлений:', _t5);
              throw _t5;
            case 6:
              return _context5.a(2);
          }
        }, _callee5, this, [[0, 5]]);
      }));
      function GetUnreadCount(_x4) {
        return _GetUnreadCount.apply(this, arguments);
      }
      return GetUnreadCount;
    }()
    /**
     * Отметить уведомление как прочитанное (по ID получателя)
     * @param {string} recipientId - GUID записи NotificationUsers
     * @returns {Promise<boolean>} true, если успешно, иначе false
     * @example
     * const result = await client.markAsReadByRecipientId('123e4567-e89b-12d3-a456-426614174000');
     * if (result) console.log('Уведомление отмечено как прочитанное');
     */
    )
  }, {
    key: "MarkAsReadByRecipientId",
    value: (function () {
      var _MarkAsReadByRecipientId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(recipientId) {
        var response, error, _t6;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.p = _context6.n) {
            case 0:
              _context6.p = 0;
              _context6.n = 1;
              return fetch(this._GetUrl("/recipient/".concat(recipientId, "/mark-read")), {
                method: 'PATCH',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context6.v;
              if (response.ok) {
                _context6.n = 4;
                break;
              }
              if (!(response.status === 404)) {
                _context6.n = 2;
                break;
              }
              return _context6.a(2, false);
            case 2:
              _context6.n = 3;
              return response.text();
            case 3:
              error = _context6.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043C\u0435\u0442\u043A\u0438 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F \u043A\u0430\u043A \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u043E\u0433\u043E: ".concat(error));
            case 4:
              return _context6.a(2, true);
            case 5:
              _context6.p = 5;
              _t6 = _context6.v;
              console.error('Ошибка при отметке уведомления как прочитанного:', _t6);
              throw _t6;
            case 6:
              return _context6.a(2);
          }
        }, _callee6, this, [[0, 5]]);
      }));
      function MarkAsReadByRecipientId(_x5) {
        return _MarkAsReadByRecipientId.apply(this, arguments);
      }
      return MarkAsReadByRecipientId;
    }()
    /**
     * Отметить уведомление как прочитанное (по ID уведомления и ID пользователя)
     * @param {string} notificationId - GUID уведомления
     * @param {string} userId - GUID пользователя
     * @returns {Promise<boolean>} true, если успешно, иначе false
     * @example
     * const result = await client.markAsReadByIds('123e4567-e89b-12d3-a456-426614174000', '223e4567-e89b-12d3-a456-426614174001');
     * if (result) console.log('Уведомление отмечено как прочитанное');
     */
    )
  }, {
    key: "MarkAsReadByIds",
    value: (function () {
      var _MarkAsReadByIds = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(notificationId, userId) {
        var response, error, _t7;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.p = _context7.n) {
            case 0:
              _context7.p = 0;
              _context7.n = 1;
              return fetch(this._GetUrl("/notification/".concat(notificationId, "/user/").concat(userId, "/mark-read")), {
                method: 'PATCH',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context7.v;
              if (response.ok) {
                _context7.n = 4;
                break;
              }
              if (!(response.status === 404)) {
                _context7.n = 2;
                break;
              }
              return _context7.a(2, false);
            case 2:
              _context7.n = 3;
              return response.text();
            case 3:
              error = _context7.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043C\u0435\u0442\u043A\u0438 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F \u043A\u0430\u043A \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u043E\u0433\u043E: ".concat(error));
            case 4:
              return _context7.a(2, true);
            case 5:
              _context7.p = 5;
              _t7 = _context7.v;
              console.error('Ошибка при отметке уведомления как прочитанного (по ID):', _t7);
              throw _t7;
            case 6:
              return _context7.a(2);
          }
        }, _callee7, this, [[0, 5]]);
      }));
      function MarkAsReadByIds(_x6, _x7) {
        return _MarkAsReadByIds.apply(this, arguments);
      }
      return MarkAsReadByIds;
    }()
    /**
     * Отметить все уведомления пользователя как прочитанные
     * @param {string} userId - GUID пользователя
     * @returns {Promise<number>} Количество отмеченных уведомлений
     * @example
     * const count = await client.markAllAsRead('123e4567-e89b-12d3-a456-426614174000');
     * console.log(`Отмечено: ${count} уведомлений`);
     */
    )
  }, {
    key: "MarkAllAsRead",
    value: (function () {
      var _MarkAllAsRead = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(userId) {
        var response, error, result, _t8;
        return _regenerator().w(function (_context8) {
          while (1) switch (_context8.p = _context8.n) {
            case 0:
              _context8.p = 0;
              _context8.n = 1;
              return fetch(this._GetUrl("/user/".concat(userId, "/mark-all-read")), {
                method: 'PATCH',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context8.v;
              if (response.ok) {
                _context8.n = 3;
                break;
              }
              _context8.n = 2;
              return response.text();
            case 2:
              error = _context8.v;
              throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0442\u043C\u0435\u0442\u043A\u0438 \u0432\u0441\u0435\u0445 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439 \u043A\u0430\u043A \u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u0445: ".concat(error));
            case 3:
              _context8.n = 4;
              return response.json();
            case 4:
              result = _context8.v;
              return _context8.a(2, result.message ? parseInt(result.message.match(/\d+/)[0]) : 0);
            case 5:
              _context8.p = 5;
              _t8 = _context8.v;
              console.error('Ошибка при отметке всех уведомлений как прочитанных:', _t8);
              throw _t8;
            case 6:
              return _context8.a(2);
          }
        }, _callee8, this, [[0, 5]]);
      }));
      function MarkAllAsRead(_x8) {
        return _MarkAllAsRead.apply(this, arguments);
      }
      return MarkAllAsRead;
    }()
    /**
     * Создать новое уведомление
     * @param {Object} notificationData - Данные для создания уведомления
     * @param {string} notificationData.title - Заголовок уведомления
     * @param {string} notificationData.message - Текст уведомления
     * @param {string} notificationData.type - Тип уведомления
     * @param {string} notificationData.createdBy - GUID создателя уведомления
     * @param {string} [notificationData.imageUrl] - URL изображения (опционально)
     * @param {string[]} notificationData.userIdList - Массив GUID получателей
     * @returns {Promise<boolean>} true, если успешно создано, иначе false
     * @example
     * const success = await client.createNotification({
     *     title: 'Новое сообщение',
     *     message: 'У вас новое сообщение от администратора',
     *     type: 'info',
     *     createdBy: '123e4567-e89b-12d3-a456-426614174000',
     *     userIdList: [
     *         '223e4567-e89b-12d3-a456-426614174001',
     *         '323e4567-e89b-12d3-a456-426614174002'
     *     ]
     * });
     */
    )
  }, {
    key: "CreateNotification",
    value: (function () {
      var _CreateNotification = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(notificationData) {
        var payload, response, error, _t9;
        return _regenerator().w(function (_context9) {
          while (1) switch (_context9.p = _context9.n) {
            case 0:
              if (notificationData.title) {
                _context9.n = 1;
                break;
              }
              throw new Error('Поле title обязательно');
            case 1:
              if (notificationData.message) {
                _context9.n = 2;
                break;
              }
              throw new Error('Поле message обязательно');
            case 2:
              if (notificationData.createdBy) {
                _context9.n = 3;
                break;
              }
              throw new Error('Поле createdBy обязательно');
            case 3:
              if (!(!Array.isArray(notificationData.userIdList) || notificationData.userIdList.length === 0)) {
                _context9.n = 4;
                break;
              }
              throw new Error('Поле userIdList должно быть непустым массивом');
            case 4:
              // Подготовка данных с дефолтными значениями
              payload = {
                title: notificationData.title,
                message: notificationData.message,
                imageUrl: notificationData.imageUrl || null,
                createdBy: notificationData.createdBy,
                type: notificationData.type === 0 ? 0 : 1,
                // 0 = User, иначе 1 = System
                isReadable: notificationData.isReadable === false ? false : true,
                // false или true (по умолчанию)
                userIdList: notificationData.userIdList
              };
              _context9.p = 5;
              _context9.n = 6;
              return fetch(this._GetUrl(''), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
              });
            case 6:
              response = _context9.v;
              if (response.ok) {
                _context9.n = 8;
                break;
              }
              _context9.n = 7;
              return response.text();
            case 7:
              error = _context9.v;
              console.error(error);
              return _context9.a(2, false);
            case 8:
              return _context9.a(2, true);
            case 9:
              _context9.n = 11;
              break;
            case 10:
              _context9.p = 10;
              _t9 = _context9.v;
              console.error('Ошибка при создании уведомления:', _t9);
              throw _t9;
            case 11:
              return _context9.a(2);
          }
        }, _callee9, this, [[5, 10]]);
      }));
      function CreateNotification(_x9) {
        return _CreateNotification.apply(this, arguments);
      }
      return CreateNotification;
    }()
    /**
     * Установить базовый URL
     * @param {string} newBaseUrl 
     */
    )
  }, {
    key: "SetBaseUrl",
    value: function SetBaseUrl(newBaseUrl) {
      this.baseUrl = newBaseUrl.endsWith('/') ? newBaseUrl.slice(0, -1) : newBaseUrl;
    }

    /**
     * Получить текущий базовый URL
     * @returns {string}
     */
  }, {
    key: "GetBaseUrl",
    value: function GetBaseUrl() {
      return this.baseUrl;
    }
  }]);
}();
document.addEventListener('authStateChanged', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0() {
  var _event$detail, isAuthenticated, userData, Notification;
  return _regenerator().w(function (_context0) {
    while (1) switch (_context0.n) {
      case 0:
        _event$detail = event.detail, isAuthenticated = _event$detail.isAuthenticated, userData = _event$detail.userData;
        if (isAuthenticated && userData) {
          Notification = new NotificationClient();
        }
      case 1:
        return _context0.a(2);
    }
  }, _callee0);
})));

// ============================================
// Примеры использования
// ============================================

/*
// 1. Создание клиента
const notificationClient = new NotificationClient();

// 2. Получение всех уведомлений
const allNotifications = await notificationClient.getAllNotifications();
console.log('Всего уведомлений:', allNotifications.length);

// 3. Получение уведомлений конкретного пользователя
const userId = '123e4567-e89b-12d3-a456-426614174000';
const userNotifications = await notificationClient.getNotificationsByUserId(userId);
console.log('Уведомлений пользователя:', userNotifications.length);

// 4. Получение непрочитанных уведомлений
const unreadNotifications = await notificationClient.getUnreadNotifications(userId);
console.log('Непрочитанных:', unreadNotifications.length);

// 5. Получение количества непрочитанных (для бейджа)
const unreadCount = await notificationClient.getUnreadCount(userId);
document.getElementById('notification-badge').textContent = unreadCount;
document.getElementById('notification-badge').style.display = unreadCount > 0 ? 'block' : 'none';

// 6. Создание нового уведомления
const newNotification = await notificationClient.createNotification({
    title: 'Новое сообщение',
    message: 'Вам пришло новое сообщение от администратора',
    type: 'info', // или 'warning', 'error', 'success'
    createdBy: 'admin-user-guid',
    imageUrl: 'https://example.com/notification-icon.png',
    userIdList: [
        '123e4567-e89b-12d3-a456-426614174000',
        '223e4567-e89b-12d3-a456-426614174001'
    ]
});
console.log('Создано уведомление с ID:', newNotification.id);

// 7. Получение конкретного уведомления по ID
const notification = await notificationClient.getNotificationById(newNotification.id);
console.log('Уведомление:', notification.title, notification.message);

// 8. Пример интеграции в UI
async function updateNotificationUI(userId) {
    try {
        // Получаем количество непрочитанных
        const count = await notificationClient.getUnreadCount(userId);
        
        // Обновляем бейдж
        const badge = document.getElementById('notification-badge');
        badge.textContent = count;
        badge.style.display = count > 0 ? 'inline-block' : 'none';
        
        // Получаем последние уведомления
        const notifications = await notificationClient.getNotificationsByUserId(userId);
        
        // Отображаем в выпадающем списке
        const list = document.getElementById('notification-list');
        list.innerHTML = notifications.slice(0, 5).map(n => `
            <div class="notification-item ${n.recipients.some(r => r.userId === userId && !r.readAt) ? 'unread' : ''}">
                <h4>${n.title}</h4>
                <p>${n.message}</p>
                <small>${new Date(n.createdAt).toLocaleString()}</small>
            </div>
        `).join('');
    } catch (error) {
        console.error('Ошибка обновления UI:', error);
    }
}

// 9. Автоматическое обновление каждые 30 секунд
setInterval(() => {
    const currentUserId = getCurrentUserId(); // ваша функция получения ID текущего пользователя
    updateNotificationUI(currentUserId);
}, 30000);

// 10. Отправка уведомления всем пользователям квартиры
async function notifyApartmentUsers(apartmentUserIds, title, message) {
    try {
        const notification = await notificationClient.createNotification({
            title: title,
            message: message,
            type: 'info',
            createdBy: getCurrentUserId(),
            userIdList: apartmentUserIds
        });
        console.log('Уведомление отправлено:', notification.id);
        return notification;
    } catch (error) {
        console.error('Ошибка отправки уведомления:', error);
        throw error;
    }
}

// 11. Фильтрация уведомлений по типу
async function getNotificationsByType(userId, type) {
    const notifications = await notificationClient.getNotificationsByUserId(userId);
    return notifications.filter(n => n.type === type);
}

// Примеры типов: 'info', 'warning', 'error', 'success'
const warningNotifications = await getNotificationsByType(userId, 'warning');
*/

/***/ }),

/***/ "./wwwroot/js/NotificationProfileManager.js":
/*!**************************************************!*\
  !*** ./wwwroot/js/NotificationProfileManager.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   NotificationProfileManager: () => (/* binding */ NotificationProfileManager)
/* harmony export */ });
/* harmony import */ var _Modal_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Modal.js */ "./wwwroot/js/Modal.js");
/* harmony import */ var _ApartmentHouses_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ApartmentHouses.js */ "./wwwroot/js/ApartmentHouses.js");
/* harmony import */ var _NotificationClient_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./NotificationClient.js */ "./wwwroot/js/NotificationClient.js");
/* harmony import */ var _FileStorageClient_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./FileStorageClient.js */ "./wwwroot/js/FileStorageClient.js");
/* harmony import */ var _DateFormat_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./DateFormat.js */ "./wwwroot/js/DateFormat.js");
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
function _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }





var NotificationProfileManager = /*#__PURE__*/function () {
  function NotificationProfileManager() {
    _classCallCheck(this, NotificationProfileManager);
    this.currentApartments = []; // Храним текущие квартиры
    this.houseProfile = new _ApartmentHouses_js__WEBPACK_IMPORTED_MODULE_1__.ApartmentHouses();
    this.userId = null;
  }
  return _createClass(NotificationProfileManager, [{
    key: "InsertDataToCreateNotification",
    value: function () {
      var _InsertDataToCreateNotification = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {
        var _this = this;
        var houseSelector, apartmentSelector, notificationGroup, houses, houseChecks, results, eligibleHouses;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.n) {
            case 0:
              this.userId = window.authManager.userData.userId;
              houseSelector = document.getElementById('houseId');
              apartmentSelector = document.getElementById('apartments');
              notificationGroup = document.querySelector('.profile-group[data-group="notification"]'); // Очистим селектор перед заполнением
              houseSelector.innerHTML = '';
              _context3.n = 1;
              return this.houseProfile.GetHousesByUserId(this.userId);
            case 1:
              houses = _context3.v;
              // Массив промисов для параллельного выполнения
              houseChecks = houses.map(/*#__PURE__*/function () {
                var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(house) {
                  var houseHead;
                  return _regenerator().w(function (_context) {
                    while (1) switch (_context.n) {
                      case 0:
                        _context.n = 1;
                        return _this.houseProfile.GetHead(house.id);
                      case 1:
                        houseHead = _context.v;
                        return _context.a(2, {
                          house: house,
                          isHead: houseHead.id === _this.userId
                        });
                    }
                  }, _callee);
                }));
                return function (_x) {
                  return _ref.apply(this, arguments);
                };
              }()); // Дожидаемся всех проверок
              _context3.n = 2;
              return Promise.all(houseChecks);
            case 2:
              results = _context3.v;
              // Фильтруем дома, где пользователь — глава
              eligibleHouses = results.filter(function (_ref2) {
                var isHead = _ref2.isHead;
                return isHead;
              }).map(function (_ref3) {
                var house = _ref3.house;
                return house;
              });
              if (!eligibleHouses.length) {
                _context3.n = 4;
                break;
              }
              // Пользователь — глава хотя бы в одном доме => показываем селект
              eligibleHouses.forEach(function (house) {
                var option = document.createElement('option');
                option.value = house.id;
                option.textContent = "".concat(house.city, ", \u0443\u043B. ").concat(house.street, ", ").concat(house.number);
                houseSelector.appendChild(option);
              });
              _context3.n = 3;
              return this.LoadApartmentsForSelect(houseSelector.value);
            case 3:
              _context3.n = 5;
              break;
            case 4:
              // Ни в одном доме не глава => уведомление недоступно
              if (notificationGroup) {
                notificationGroup.innerHTML = "\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u043D\u043E";
              }
            case 5:
              houseSelector.addEventListener('change', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {
                return _regenerator().w(function (_context2) {
                  while (1) switch (_context2.n) {
                    case 0:
                      _context2.n = 1;
                      return _this.LoadApartmentsForSelect(houseSelector.value);
                    case 1:
                      return _context2.a(2);
                  }
                }, _callee2);
              })));
            case 6:
              return _context3.a(2);
          }
        }, _callee3, this);
      }));
      function InsertDataToCreateNotification() {
        return _InsertDataToCreateNotification.apply(this, arguments);
      }
      return InsertDataToCreateNotification;
    }()
  }, {
    key: "LoadApartmentsForSelect",
    value: function () {
      var _LoadApartmentsForSelect = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(houseId) {
        var _this2 = this;
        var apartmentSelector, clearOption, allOption, _iterator, _step, apartment, option, tomSelectInstance;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.n) {
            case 0:
              apartmentSelector = document.getElementById('apartments'); // Получаем квартиры и сохраняем их
              _context4.n = 1;
              return this.houseProfile.GetApartmentsByHouseId(houseId);
            case 1:
              this.currentApartments = _context4.v;
              // Очищаем селектор перед заполнением
              apartmentSelector.innerHTML = '';

              // Добавляем опцию "Очистить все"
              clearOption = document.createElement('option');
              clearOption.value = 'clear';
              clearOption.textContent = 'Очистить все выбранные квартиры';
              apartmentSelector.appendChild(clearOption);

              // Добавляем опцию "Все квартиры дома"
              allOption = document.createElement('option');
              allOption.value = 'all';
              allOption.textContent = 'Все квартиры дома';
              apartmentSelector.appendChild(allOption);

              // Добавляем квартиры
              _iterator = _createForOfIteratorHelper(this.currentApartments);
              try {
                for (_iterator.s(); !(_step = _iterator.n()).done;) {
                  apartment = _step.value;
                  option = document.createElement('option');
                  option.value = apartment.id;
                  option.textContent = "\u043A\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ".concat(apartment.number);
                  apartmentSelector.appendChild(option);
                }

                // Уничтожаем предыдущий экземпляр Tom Select, если он существует
              } catch (err) {
                _iterator.e(err);
              } finally {
                _iterator.f();
              }
              if (apartmentSelector.tomselect) {
                apartmentSelector.tomselect.destroy();
              }

              // Инициализируем Tom Select
              tomSelectInstance = new TomSelect('#apartments', {
                plugins: ['remove_button'],
                maxItems: null,
                onChange: function onChange(values) {
                  // Если выбрана опция "Очистить все"
                  if (values.includes('clear')) {
                    tomSelectInstance.clear();
                    return;
                  }

                  // Если выбрана опция "Все квартиры"
                  if (values.includes('all')) {
                    var allApartmentIds = _this2.currentApartments.map(function (apt) {
                      return apt.id.toString();
                    });
                    if (values[values.length - 1] === 'all') {
                      tomSelectInstance.setValue(['all'].concat(_toConsumableArray(allApartmentIds)), true);
                    }
                  } else {
                    var _allApartmentIds = _this2.currentApartments.map(function (apt) {
                      return apt.id.toString();
                    });
                    var hasAll = _allApartmentIds.every(function (id) {
                      return values.includes(id);
                    });
                    if (!hasAll && values.includes('all')) {
                      tomSelectInstance.removeItem('all', true);
                    }
                  }
                }
              }); // Сохраняем экземпляр
              apartmentSelector.tomselect = tomSelectInstance;

              // Программно выбираем все квартиры при инициализации
              setTimeout(function () {
                var allApartmentIds = _this2.currentApartments.map(function (apt) {
                  return apt.id.toString();
                });
                tomSelectInstance.setValue(['all'].concat(_toConsumableArray(allApartmentIds)));
              }, 0);
            case 2:
              return _context4.a(2);
          }
        }, _callee4, this);
      }));
      function LoadApartmentsForSelect(_x2) {
        return _LoadApartmentsForSelect.apply(this, arguments);
      }
      return LoadApartmentsForSelect;
    }()
  }, {
    key: "CollectNotificationDataToCreate",
    value: function () {
      var _CollectNotificationDataToCreate = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {
        var _this3 = this;
        var apartmentSelector, tomSelectInstance, selectedValues, apartmentIds, toOwnersRadio, isOwnersOnly, allUserIds, uniqueUserIds, fileInput, file, fileManager, isFileUpload, title, message;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.n) {
            case 0:
              apartmentSelector = document.getElementById('apartments');
              tomSelectInstance = apartmentSelector.tomselect;
              if (tomSelectInstance) {
                _context5.n = 1;
                break;
              }
              console.error('Tom Select не инициализирован');
              return _context5.a(2, {
                apartmentIds: [],
                userIds: []
              });
            case 1:
              // Получаем массив выбранных значений
              selectedValues = tomSelectInstance.getValue(); // Фильтруем 'all' и 'clear', получаем только ID квартир
              apartmentIds = selectedValues.filter(function (value) {
                return value !== 'all' && value !== 'clear';
              });
              console.log('Выбранные квартиры:', apartmentIds);

              // Проверяем, какой radio button выбран
              toOwnersRadio = document.getElementById('toOwners');
              isOwnersOnly = toOwnersRadio ? toOwnersRadio.checked : false;
              console.log('Radio toOwners checked:', isOwnersOnly);

              // Собираем пользователей из выбранных квартир
              allUserIds = [];
              apartmentIds.forEach(function (apartmentId) {
                // Находим квартиру по ID из сохранённых данных
                var apartment = _this3.currentApartments.find(function (apt) {
                  return apt.id.toString() === apartmentId;
                });
                if (apartment && apartment.users && Array.isArray(apartment.users)) {
                  console.log("\u041A\u0432\u0430\u0440\u0442\u0438\u0440\u0430 ".concat(apartment.number, ", \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439:"), apartment.users.length);
                  apartment.users.forEach(function (user) {
                    console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(user.userId, ", \u0441\u0442\u0430\u0442\u0443\u0441\u044B:"), user.statuses);
                    if (isOwnersOnly) {
                      // Фильтруем только владельцев
                      var isOwner = user.statuses && user.statuses.some(function (status) {
                        return status.name === 'Владелец';
                      });
                      console.log("  \u042F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0432\u043B\u0430\u0434\u0435\u043B\u044C\u0446\u0435\u043C: ".concat(isOwner));
                      if (isOwner) {
                        allUserIds.push(user.userId);
                      }
                    } else {
                      // Все пользователи
                      console.log("  \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u0432\u0441\u0435\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439");
                      allUserIds.push(user.userId);
                    }
                  });
                }
              });

              // Получаем уникальных пользователей
              uniqueUserIds = _toConsumableArray(new Set(allUserIds));
              console.log('Все пользователи:', allUserIds);
              console.log('Уникальные пользователи:', uniqueUserIds);
              console.log('Только собственники:', isOwnersOnly);

              //собираем картинку
              fileInput = document.getElementById('fileInput');
              file = fileInput.files[0];
              fileManager = new _FileStorageClient_js__WEBPACK_IMPORTED_MODULE_3__.FileStorageClient();
              _context5.n = 2;
              return fileManager.UploadFile(file);
            case 2:
              isFileUpload = _context5.v;
              console.log("\u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438");
              console.log(isFileUpload);
              title = document.getElementById('title').value;
              message = document.getElementById('message').value;
              return _context5.a(2, {
                title: title,
                message: message,
                type: 0,
                createdBy: window.authManager.userData.userId,
                imageUrl: isFileUpload.fileUrl,
                userIdList: uniqueUserIds
              });
          }
        }, _callee5);
      }));
      function CollectNotificationDataToCreate() {
        return _CollectNotificationDataToCreate.apply(this, arguments);
      }
      return CollectNotificationDataToCreate;
    }()
  }, {
    key: "InsertDataToMainPage",
    value: function InsertDataToMainPage(data) {
      var _this4 = this;
      var notificationsContainer = document.querySelector('.notificatiions-list');
      if (data.length) {
        data.forEach(function (notification) {
          var notificationMainPageTemplate = _this4.NotificationMainPageTemplate(notification);
          notificationsContainer.insertAdjacentHTML('beforeend', notificationMainPageTemplate);
        });
      } else {
        notificationsContainer.innerHTML = "\u041D\u0435\u0442 \u043D\u043E\u0432\u044B\u0445 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439";
      }
    }
  }, {
    key: "NotificationMainPageTemplate",
    value: function NotificationMainPageTemplate(notification) {
      var notificationHTML;
      if (notification) {
        notificationHTML = "\n                <a class=\"notification-item\" href=\"/notification/".concat(notification.id, "\">\n                    <div class=\"font-size-12 color-gray\">").concat(_DateFormat_js__WEBPACK_IMPORTED_MODULE_4__.DateFormat.DateFormatToRuString(notification.createdAt), "</div>\n                    <div class=\"font-weight-600\">").concat(notification.title, "</div>\n                </a>\n            ");
      }
      return notificationHTML;
    }
  }, {
    key: "NotificationDetails",
    value: function NotificationDetails(notification) {
      var recipients = [];
      notification.recipients.forEach(function (recipient) {
        recipients.push(recipient.userId);
      });
      if (notification != null && recipients.includes(window.authManager.userData.userId)) {
        var notificationDate = document.getElementById('notification-date');
        notificationDate.innerHTML = _DateFormat_js__WEBPACK_IMPORTED_MODULE_4__.DateFormat.DateFormatToRuString(notification.createdAt);
        var notificationImage = document.getElementById('notification-image');
        notificationImage.setAttribute('src', notification.imageUrl);
        var notificationTitle = document.getElementById('notification-title');
        notificationTitle.innerHTML = notification.title;
        var notificationMessage = document.getElementById('notification-message');
        notificationMessage.innerHTML = notification.message;

        /*if (notification.createdBy == window.authManager.userData.userId) {
            document.querySelector(`[data-action="remove-notification"]`).classList.remove('d-none');
        } else {
            document.querySelector(`[data-action="remove-notification"]`).remove();
        }*/
      } else {
        document.getElementById('notification-profile').innerHTML = 'Страница недоступна';
      }
    }
  }, {
    key: "NotificationListByUserId",
    value: function NotificationListByUserId(notifications) {
      var notificationsContainer = document.querySelector('.notifications-by-user-list');
      if (notifications.length) {
        var _iterator2 = _createForOfIteratorHelper(notifications),
          _step2;
        try {
          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
            var notification = _step2.value;
            console.log("\u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0435");
            console.log(notification);
            var notificationToListByUserId = this.NotificationTemplateByUserId(notification);
            notificationsContainer.insertAdjacentHTML('beforeend', notificationToListByUserId);
          }
        } catch (err) {
          _iterator2.e(err);
        } finally {
          _iterator2.f();
        }
      } else {
        notificationsContainer.innerHTML = "\u041D\u0435\u0442 \u043D\u043E\u0432\u044B\u0445 \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439";
      }
    }
  }, {
    key: "NotificationTemplateByUserId",
    value: function NotificationTemplateByUserId(notification) {
      var notificationHTML;
      if (notification) {
        var _window$authManager, _window$authManager2, _notification$recipie;
        // Проверяем, есть ли текущий пользователь в recipients и прочитал ли он уведомление
        var currentUser = ((_window$authManager = window.authManager) === null || _window$authManager === void 0 || (_window$authManager = _window$authManager.userData) === null || _window$authManager === void 0 ? void 0 : _window$authManager.userId) || ((_window$authManager2 = window.authManager) === null || _window$authManager2 === void 0 || (_window$authManager2 = _window$authManager2.userData) === null || _window$authManager2 === void 0 ? void 0 : _window$authManager2.id); // в зависимости от структуры
        var currentUserRecipient = (_notification$recipie = notification.recipients) === null || _notification$recipie === void 0 ? void 0 : _notification$recipie.find(function (recipient) {
          return recipient.userId === currentUser;
        });
        var isReadByCurrentUser = currentUserRecipient && currentUserRecipient.readAt !== null;
        var readAt = isReadByCurrentUser ? currentUserRecipient.readAt : null;

        // Формируем класс и span для даты прочтения
        var readClass = isReadByCurrentUser ? 'readed' : '';
        var readAtSpan = isReadByCurrentUser ? "<span class=\"read-at\">\u041F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043E: ".concat(_DateFormat_js__WEBPACK_IMPORTED_MODULE_4__.DateFormat.DateFormatToRuString(readAt), "</span>") : '';
        notificationHTML = "\n                <div class=\"profile-group dashboard-card my-4\" data-group=\"notification\" data-apartment-id=\"".concat(notification.id, "\">\n                    <h3 class=\"card-header card-header_notification w-100 ").concat(readClass, "\">\n                        <a href=\"/notification/").concat(notification.id, "\">").concat(notification.title, "</a>\n                        ").concat(readAtSpan, "\n                    </h3>\n\n                    <div class=\"d-flex flex-wrap flex-md-nowrap gap-3 mt-4 w-100\">\n                        <div class=\"notification-image\">\n                            <img id=\"notification-image\" src=\"").concat(notification.imageUrl, "\" alt=\"Alternate Text\" />\n                        </div>\n                        <div class=\"notification-content\">\n                            <div id=\"notification-date\" class=\"notification-date mb-3\">").concat(_DateFormat_js__WEBPACK_IMPORTED_MODULE_4__.DateFormat.DateFormatToRuString(notification.createdAt), "</div>                        \n                            <div id=\"notification-message\">").concat(notification.message, "</div>\n                        </div>\n                    </div>\n                </div>\n            ");
      }
      return notificationHTML;
    }
  }]);
}();
document.addEventListener('authStateChanged', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8() {
  var _event$detail, isAuthenticated, userData, Regex, UrlParts, userId, notificationProfile, notificationClient, readTimeoutId, notificationsByUser, notificationId, notification, _notificationsByUser;
  return _regenerator().w(function (_context8) {
    while (1) switch (_context8.n) {
      case 0:
        _event$detail = event.detail, isAuthenticated = _event$detail.isAuthenticated, userData = _event$detail.userData;
        Regex = new window.RegularExtension();
        UrlParts = Regex.getUrlPathParts(window.location.href);
        if (!(isAuthenticated && userData)) {
          _context8.n = 8;
          break;
        }
        userId = window.authManager.userData.userId;
        notificationProfile = new NotificationProfileManager();
        notificationClient = new _NotificationClient_js__WEBPACK_IMPORTED_MODULE_2__.NotificationClient();
        console.log('Аутентификация пройдена');
        if (!window.location.pathname.includes('/notification/create')) {
          _context8.n = 2;
          break;
        }
        _context8.n = 1;
        return notificationProfile.InsertDataToCreateNotification();
      case 1:
        document.querySelector('[data-action="save-notification-data"]').addEventListener('click', /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {
          var notificationData, notificationCreate;
          return _regenerator().w(function (_context6) {
            while (1) switch (_context6.n) {
              case 0:
                console.log('Клик по кнопке сохранения уведомления');

                // Собираем данные уведомления
                _context6.n = 1;
                return notificationProfile.CollectNotificationDataToCreate();
              case 1:
                notificationData = _context6.v;
                console.log('Данные для сохранения:', notificationData);

                //Отправляем данные на сервер
                notificationCreate = notificationClient.CreateNotification(notificationData);
                if (notificationCreate) {
                  _Modal_js__WEBPACK_IMPORTED_MODULE_0__.Modal.ShowNotification('Уведомление создано успешно!', 'green');
                }
              case 2:
                return _context6.a(2);
            }
          }, _callee6);
        })));
      case 2:
        readTimeoutId = null;
        if (!(window.location.pathname == '/')) {
          _context8.n = 4;
          break;
        }
        _context8.n = 3;
        return notificationClient.GetUnreadNotificationsByUserId(userId);
      case 3:
        notificationsByUser = _context8.v;
        console.log("\u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F \u0434\u043B\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F");
        console.log(notificationsByUser);
        notificationProfile.InsertDataToMainPage(notificationsByUser);
      case 4:
        if (!(Regex.isValidEntityUrl(window.location.href).valid && UrlParts.includes('notification'))) {
          _context8.n = 6;
          break;
        }
        notificationId = Regex.isValidEntityUrl(window.location.href).id;
        _context8.n = 5;
        return notificationClient.GetNotificationById(notificationId);
      case 5:
        notification = _context8.v;
        notificationProfile.NotificationDetails(notification);
        if (readTimeoutId) {
          clearTimeout(readTimeoutId);
        }

        // Отсечка в 10 секунд для фиксации прочитанности сообщения
        readTimeoutId = setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7() {
          var result, _t;
          return _regenerator().w(function (_context7) {
            while (1) switch (_context7.p = _context7.n) {
              case 0:
                _context7.p = 0;
                _context7.n = 1;
                return notificationClient.MarkAsReadByIds(notificationId, userId);
              case 1:
                result = _context7.v;
                if (result) {
                  console.log('Уведомление отмечено как прочитанное');
                } else {
                  console.warn('Не удалось отметить уведомление как прочитанное');
                }
                _context7.n = 3;
                break;
              case 2:
                _context7.p = 2;
                _t = _context7.v;
                console.error('Ошибка при отметке уведомления как прочитанного:', _t);
              case 3:
                return _context7.a(2);
            }
          }, _callee7, null, [[0, 2]]);
        })), 10000);

        // Отмена таймера при уходе со страницы, если ушел раньше 15 секунд, то сообщение не считается прочитанным
        window.addEventListener('beforeunload', function () {
          if (readTimeoutId) {
            clearTimeout(readTimeoutId);
            console.log('Таймер отменен при уходе со страницы');
          }
        });
      case 6:
        if (!(UrlParts.includes("notification") && UrlParts.includes('by-user') && UrlParts.includes(userId))) {
          _context8.n = 8;
          break;
        }
        _context8.n = 7;
        return notificationClient.GetNotificationsByUserId(userId);
      case 7:
        _notificationsByUser = _context8.v;
        notificationProfile.NotificationListByUserId(_notificationsByUser);
      case 8:
        return _context8.a(2);
    }
  }, _callee8);
})));

/***/ }),

/***/ "./wwwroot/js/Regex.js":
/*!*****************************!*\
  !*** ./wwwroot/js/Regex.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RegularExtension: () => (/* binding */ RegularExtension)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var RegularExtension = /*#__PURE__*/function () {
  function RegularExtension() {
    _classCallCheck(this, RegularExtension);
  }
  return _createClass(RegularExtension, [{
    key: "getUrlPathParts",
    value: function getUrlPathParts(url) {
      try {
        var urlObj = new URL(url);
        var path = urlObj.pathname;
        return path.split('/').filter(function (part) {
          return part !== '';
        });
      } catch (e) {
        // Если URL некорректен — возвращаем пустой массив
        return [];
      }
    }
  }, {
    key: "isValidEntityUrl",
    value: function isValidEntityUrl(url) {
      try {
        var normalizedUrl = url.replace(/\/$/, '');
        var urlObj = new URL(normalizedUrl);
        var path = urlObj.pathname;
        var parts = path.split('/').filter(function (part) {
          return part !== '';
        });

        // Случай 1: [type, id] — house или apartment с числовым ID
        if (parts.length === 2) {
          var _parts = _slicedToArray(parts, 2),
            type = _parts[0],
            idStr = _parts[1];
          if ((type === 'house' || type === 'apartment') && /^\d+$/.test(idStr)) {
            return {
              valid: true,
              id: parseInt(idStr, 10),
              type: type
            };
          }
        }

        // Случай 2: [context, guid] — notification или user с GUID
        if (parts.length === 2) {
          var _parts2 = _slicedToArray(parts, 2),
            _type = _parts2[0],
            guid = _parts2[1];
          if ((_type === 'notification' || _type === 'user') && this.isGuid(guid)) {
            return {
              valid: true,
              id: guid,
              // GUID остаётся строкой
              type: _type
            };
          }
        }
        return {
          valid: false,
          id: null,
          type: null
        };
      } catch (e) {
        return {
          valid: false,
          id: null,
          type: null
        };
      }
    }

    // Вспомогательный метод для проверки GUID v4
  }, {
    key: "isGuid",
    value: function isGuid(str) {
      var guidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
      return guidRegex.test(str);
    }
  }]);
}();
window.RegularExtension = RegularExtension;

/***/ }),

/***/ "./wwwroot/js/Multiselect.js":
/*!***********************************!*\
  !*** ./wwwroot/js/Multiselect.js ***!
  \***********************************/
/***/ (() => {

function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var Multiselect = /*#__PURE__*/function () {
  function Multiselect() {
    _classCallCheck(this, Multiselect);
    this.instances = new Map(); // храним активные инстансы по ID
  }

  /**
   * Инициализирует Tom Select с чекбоксами на <select multiple>
   * @param {string} elementId — ID элемента <select>
   * @param {Object} [customOptions] — дополнительные опции Tom Select
   * @returns {TomSelect | null}
   */
  return _createClass(Multiselect, [{
    key: "init",
    value: function init(elementId) {
      var customOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var selectElement = document.getElementById(elementId);
      if (!selectElement) {
        console.warn("Multiselect: \u044D\u043B\u0435\u043C\u0435\u043D\u0442 \u0441 id=\"".concat(elementId, "\" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D."));
        return null;
      }

      // Защита от повторной инициализации
      if (this.instances.has(elementId)) {
        console.warn("Multiselect: \u0443\u0436\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u043D \u043D\u0430 \"".concat(elementId, "\"."));
        return this.instances.get(elementId);
      }

      // Базовые настройки: мультиселект + чекбоксы
      var defaultOptions = {
        plugins: {
          checkbox_options: {} // ← чекбоксы в выпадающем списке
        },
        maxItems: null,
        // разрешить множественный выбор
        hidePlaceholder: true,
        closeAfterSelect: false,
        // не закрывать после выбора (удобно при мультивыборе)
        dropdownParent: 'body' // чтобы не обрезалось в модалках и т.п.
      };
      var finalOptions = _objectSpread(_objectSpread({}, defaultOptions), customOptions);

      // Создаём экземпляр Tom Select
      var tomSelectInstance = new TomSelect("#".concat(elementId), finalOptions);

      // Сохраняем для последующего доступа
      this.instances.set(elementId, tomSelectInstance);
      selectElement._tomSelect = tomSelectInstance;
      return tomSelectInstance;
    }

    /**
     * Получить экземпляр Tom Select по ID
     * @param {string} elementId
     * @returns {TomSelect | undefined}
     */
  }, {
    key: "getInstance",
    value: function getInstance(elementId) {
      return this.instances.get(elementId);
    }

    /**
     * Уничтожить инстанс (например, при удалении из DOM)
     * @param {string} elementId
     */
  }, {
    key: "destroy",
    value: function destroy(elementId) {
      var instance = this.instances.get(elementId);
      if (instance) {
        instance.destroy();
        this.instances["delete"](elementId);
        var el = document.getElementById(elementId);
        if (el) delete el._tomSelect;
      }
    }

    /**
     * Получить выбранные значения (массив строк)
     * @param {string} elementId
     * @returns {string[]}
     */
  }, {
    key: "getValues",
    value: function getValues(elementId) {
      var instance = this.getInstance(elementId);
      return instance ? instance.getValue() : [];
    }

    /**
     * Установить значения программно
     * @param {string} elementId
     * @param {string[]} values
     */
  }, {
    key: "setValues",
    value: function setValues(elementId, values) {
      var instance = this.getInstance(elementId);
      if (instance) {
        instance.setValue(values, false); // false = не вызывать onChange
      }
    }
  }]);
}();
window.Multiselect = Multiselect;

/***/ }),

/***/ "./wwwroot/js/Regex.js":
/*!*****************************!*\
  !*** ./wwwroot/js/Regex.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   RegularExtension: () => (/* binding */ RegularExtension)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var RegularExtension = /*#__PURE__*/function () {
  function RegularExtension() {
    _classCallCheck(this, RegularExtension);
  }
  return _createClass(RegularExtension, [{
    key: "getUrlPathParts",
    value: function getUrlPathParts(url) {
      try {
        var urlObj = new URL(url);
        var path = urlObj.pathname;
        return path.split('/').filter(function (part) {
          return part !== '';
        });
      } catch (e) {
        // Если URL некорректен — возвращаем пустой массив
        return [];
      }
    }
  }, {
    key: "isValidEntityUrl",
    value: function isValidEntityUrl(url) {
      try {
        // Убираем завершающий слэш из всего URL (если есть)
        var normalizedUrl = url.replace(/\/$/, '');
        var urlObj = new URL(normalizedUrl);
        var path = urlObj.pathname;
        var parts = path.split('/').filter(function (part) {
          return part !== '';
        });

        // Должно быть ровно две части: [тип, id]
        if (parts.length === 2) {
          var _parts = _slicedToArray(parts, 2),
            type = _parts[0],
            idStr = _parts[1];
          if ((type === 'house' || type === 'apartment') && /^\d+$/.test(idStr)) {
            return {
              valid: true,
              id: parseInt(idStr, 10),
              type: type
            };
          }
        }
        return {
          valid: false,
          id: null,
          type: null
        };
      } catch (e) {
        return {
          valid: false,
          id: null,
          type: null
        };
      }
    }
  }]);
}();
window.RegularExtension = RegularExtension;

/***/ }),

/***/ "./wwwroot/js/UserProfile.js":
/*!***********************************!*\
  !*** ./wwwroot/js/UserProfile.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UserProfile: () => (/* binding */ UserProfile)
/* harmony export */ });
/* harmony import */ var _UserValidator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./UserValidator.js */ "./wwwroot/js/UserValidator.js");
/* harmony import */ var _Modal_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Modal.js */ "./wwwroot/js/Modal.js");
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i["return"]) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }


var UserProfile = /*#__PURE__*/function () {
  function UserProfile() {
    _classCallCheck(this, UserProfile);
    this.userApiAddress = 'http://localhost:55680';
    this.validator = new _UserValidator_js__WEBPACK_IMPORTED_MODULE_0__.UserValidator();
  }
  return _createClass(UserProfile, [{
    key: "GetUserById",
    value: function () {
      var _GetUserById = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(userId) {
        var response, data, _t, _t2, _t3;
        return _regenerator().w(function (_context) {
          while (1) switch (_context.p = _context.n) {
            case 0:
              _context.p = 0;
              _context.n = 1;
              return fetch("".concat(this.userApiAddress, "/api/Users/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context.v;
              if (response.ok) {
                _context.n = 3;
                break;
              }
              _t = Error;
              _context.n = 2;
              return response.text();
            case 2:
              _t2 = _context.v;
              throw new _t(_t2);
            case 3:
              _context.n = 4;
              return response.json();
            case 4:
              data = _context.v;
              console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(userId, ":"), data);
              return _context.a(2, data);
            case 5:
              _context.p = 5;
              _t3 = _context.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), _t3);
            case 6:
              return _context.a(2);
          }
        }, _callee, this, [[0, 5]]);
      }));
      function GetUserById(_x) {
        return _GetUserById.apply(this, arguments);
      }
      return GetUserById;
    }()
  }, {
    key: "getUserByPhone",
    value: function () {
      var _getUserByPhone = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2(phone) {
        var _this$validator;
        var phoneValidation, cleanPhone, encodedPhone, url, response, user, _errorData, errorData, _t4;
        return _regenerator().w(function (_context2) {
          while (1) switch (_context2.p = _context2.n) {
            case 0:
              phoneValidation = (_this$validator = this.validator) === null || _this$validator === void 0 ? void 0 : _this$validator.validatePhoneNumber(phone);
              if (phoneValidation !== null && phoneValidation !== void 0 && phoneValidation.isValid) {
                _context2.n = 1;
                break;
              }
              return _context2.a(2, {
                success: false,
                error: phoneValidation.error || 'Неверный формат номера телефона'
              });
            case 1:
              // 2. Нормализуем номер для отправки (убираем всё кроме + и цифр)
              // Это важно, потому что сервер может не распознать "красивый" формат
              cleanPhone = phone.replace(/[\s\-\(\)]/g, ''); // 3. URL-кодируем номер (особенно важно для символа '+')
              encodedPhone = encodeURIComponent(cleanPhone);
              url = "".concat(this.userApiAddress, "/api/Users/by-phone/").concat(encodedPhone);
              _context2.p = 2;
              _context2.n = 3;
              return fetch(url, {
                method: 'GET',
                headers: {
                  'Accept': 'application/json'
                }
              });
            case 3:
              response = _context2.v;
              if (!response.ok) {
                _context2.n = 5;
                break;
              }
              _context2.n = 4;
              return response.json();
            case 4:
              user = _context2.v;
              return _context2.a(2, user);
            case 5:
              if (!(response.status === 404)) {
                _context2.n = 6;
                break;
              }
              return _context2.a(2, {
                success: false,
                error: 'Пользователь с таким номером не найден'
              });
            case 6:
              if (!(response.status === 400)) {
                _context2.n = 8;
                break;
              }
              _context2.n = 7;
              return response.json()["catch"](function () {
                return null;
              });
            case 7:
              _errorData = _context2.v;
              return _context2.a(2, {
                success: false,
                error: (_errorData === null || _errorData === void 0 ? void 0 : _errorData.Message) || 'Некорректный номер телефона'
              });
            case 8:
              _context2.n = 9;
              return response.json()["catch"](function () {
                return null;
              });
            case 9:
              errorData = _context2.v;
              return _context2.a(2, {
                success: false,
                error: (errorData === null || errorData === void 0 ? void 0 : errorData.Message) || "\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 (".concat(response.status, ")")
              });
            case 10:
              _context2.p = 10;
              _t4 = _context2.v;
              console.error('Сетевая ошибка при запросе пользователя по телефону:', _t4);
              return _context2.a(2, {
                success: false,
                error: 'Нет соединения с сервером'
              });
          }
        }, _callee2, this, [[2, 10]]);
      }));
      function getUserByPhone(_x2) {
        return _getUserByPhone.apply(this, arguments);
      }
      return getUserByPhone;
    }()
  }, {
    key: "GetCarsByUserId",
    value: function () {
      var _GetCarsByUserId = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(userId) {
        var response, data, _t5, _t6, _t7;
        return _regenerator().w(function (_context3) {
          while (1) switch (_context3.p = _context3.n) {
            case 0:
              _context3.p = 0;
              _context3.n = 1;
              return fetch("".concat(this.userApiAddress, "/api/Cars/by-user/").concat(userId), {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context3.v;
              if (response.ok) {
                _context3.n = 3;
                break;
              }
              _t5 = Error;
              _context3.n = 2;
              return response.text();
            case 2:
              _t6 = _context3.v;
              throw new _t5(_t6);
            case 3:
              _context3.n = 4;
              return response.json();
            case 4:
              data = _context3.v;
              console.log("\u0410\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), data);
              return _context3.a(2, data);
            case 5:
              _context3.p = 5;
              _t7 = _context3.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0430\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u0435\u0439 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(userId, ":"), _t7);
            case 6:
              return _context3.a(2);
          }
        }, _callee3, this, [[0, 5]]);
      }));
      function GetCarsByUserId(_x3) {
        return _GetCarsByUserId.apply(this, arguments);
      }
      return GetCarsByUserId;
    }()
  }, {
    key: "InsertUserIdToLinks",
    value: function InsertUserIdToLinks(userId) {
      var userIdLinks = document.querySelectorAll('a[data-user-id]');
      userIdLinks.forEach(function (element) {
        var link = element.href;
        element.href += userId;
      });
    }
  }, {
    key: "InsertUserDataToCardOnMainPage",
    value: function () {
      var _InsertUserDataToCardOnMainPage = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(userId) {
        var _t8;
        return _regenerator().w(function (_context4) {
          while (1) switch (_context4.p = _context4.n) {
            case 0:
              _context4.p = 0;
              _context4.n = 1;
              return this.GetUserById(userId).then(function (user) {
                var fullName = document.querySelector('[data-user-fullname]');
                var phone = document.querySelector('[data-user-phone]');
                var carsCount = document.querySelector('[data-user-carslist]');
                fullName.textContent = "".concat(user.firstName, " ").concat(user.lastName, " ").concat(user.patronymic);
                phone.textContent = user.phoneNumber;
                if (user.cars.length == 0) {
                  carsCount.remove();
                } else if (user.cars.length == 1) {
                  var car = user.cars[0];
                  carsCount.textContent = "".concat(car.color, " ").concat(car.mark, " ").concat(car.model, ", ").concat(car.number);
                } else {
                  carsCount.textContent = "".concat(user.cars.length, " \u043C\u0430\u0448\u0438\u043D\u044B");
                }
              })["catch"](function (error) {
                console.error('Ошибка получения данных пользователя:', error);
              });
            case 1:
              _context4.n = 3;
              break;
            case 2:
              _context4.p = 2;
              _t8 = _context4.v;
              console.log(_t8);
            case 3:
              return _context4.a(2);
          }
        }, _callee4, this, [[0, 2]]);
      }));
      function InsertUserDataToCardOnMainPage(_x4) {
        return _InsertUserDataToCardOnMainPage.apply(this, arguments);
      }
      return InsertUserDataToCardOnMainPage;
    }()
  }, {
    key: "InsertCarsToUserProfile",
    value: function () {
      var _InsertCarsToUserProfile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(userId) {
        var _this = this;
        var cars, carsContainer;
        return _regenerator().w(function (_context5) {
          while (1) switch (_context5.n) {
            case 0:
              _context5.n = 1;
              return this.GetCarsByUserId(userId);
            case 1:
              cars = _context5.v;
              carsContainer = document.querySelector('.profile-group[data-group="cars"] .cars-list');
              carsContainer.innerHTML = '';
              cars.forEach(function (car) {
                _this.SetUserCar(car, carsContainer);
              });
            case 2:
              return _context5.a(2);
          }
        }, _callee5, this);
      }));
      function InsertCarsToUserProfile(_x5) {
        return _InsertCarsToUserProfile.apply(this, arguments);
      }
      return InsertCarsToUserProfile;
    }()
  }, {
    key: "InsertUserDataToProfile",
    value: function () {
      var _InsertUserDataToProfile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(userId) {
        var _t9;
        return _regenerator().w(function (_context6) {
          while (1) switch (_context6.p = _context6.n) {
            case 0:
              _context6.p = 0;
              _context6.n = 1;
              return this.GetUserById(userId).then(function (user) {
                var setValue = function setValue(id, value) {
                  var element = document.getElementById(id);
                  if (element) {
                    // Специальная обработка для даты рождения
                    if (id === 'birthday' && value) {
                      // Преобразуем ISO строку в формат YYYY-MM-DD
                      var date = new Date(value);
                      var year = date.getFullYear();
                      var month = String(date.getMonth() + 1).padStart(2, '0');
                      var day = String(date.getDate()).padStart(2, '0');
                      element.value = "".concat(year, "-").concat(month, "-").concat(day);
                    } else {
                      element.value = value !== null && value !== '' ? value : '';
                    }
                  }
                };
                setValue('firstName', user.firstName);
                setValue('lastName', user.lastName);
                setValue('patronymic', user.patronymic);
                setValue('birthday', user.birthday);
                setValue('phoneNumber', user.phoneNumber);
                setValue('email', user.email);
              })["catch"](function (error) {
                console.error('Ошибка получения данных пользователя:', error);
              });
            case 1:
              _context6.n = 2;
              return this.InsertCarsToUserProfile(userId);
            case 2:
              _context6.n = 4;
              break;
            case 3:
              _context6.p = 3;
              _t9 = _context6.v;
              console.log(_t9);
            case 4:
              return _context6.a(2);
          }
        }, _callee6, this, [[0, 3]]);
      }));
      function InsertUserDataToProfile(_x6) {
        return _InsertUserDataToProfile.apply(this, arguments);
      }
      return InsertUserDataToProfile;
    }()
  }, {
    key: "SetCarTemplate",
    value: function SetCarTemplate(car) {
      var buttonDelCar = "\n        <div class=\"remove-car\" data-action=\"remove-car-from-user\" data-car-id=\"".concat(car.id, "\" title=\"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u0430\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u044C\">\n            &#10060;\n        </div>");
      var disabledOrNot = 'disabled';
      if (!Object.keys(car).length) {
        car.id = '';
        car.mark = '';
        car.model = '';
        car.color = '';
        car.number = '';
        car.userId = window.authManager.userData.userId;
        buttonDelCar = '';
        disabledOrNot = '';
      }
      var carTemplate = "\n            <div class=\"car\" data-car-id=\"".concat(car.id, "\">\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"mark\" id=\"mark-").concat(car.id, "\" value=\"").concat(car.mark, "\" />\n                    <label for=\"mark-").concat(car.id, "\">\u041C\u0430\u0440\u043A\u0430</label>\n                    <div class=\"error invisible\" data-error=\"mark\">\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043C\u0430\u0440\u043A\u0430 \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"model\" id=\"model-").concat(car.id, "\" value=\"").concat(car.model, "\" />\n                    <label for=\"model-").concat(car.id, "\">\u041C\u043E\u0434\u0435\u043B\u044C</label>\n                    <div class=\"error invisible\" data-error=\"model\">\u041D\u0435\u0432\u0435\u0440\u043D\u0430\u044F \u043C\u043E\u0434\u0435\u043B\u044C \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"color\" id=\"color-").concat(car.id, "\" value=\"").concat(car.color, "\" />\n                    <label for=\"color-").concat(car.id, "\">\u0426\u0432\u0435\u0442</label>\n                    <div class=\"error invisible\" data-error=\"color\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0446\u0432\u0435\u0442 \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                <div class=\"form-group\">\n                    <input ").concat(disabledOrNot, " type=\"text\" placeholder=\" \" name=\"number\" id=\"number-").concat(car.id, "\" value=\"").concat(car.number, "\" />\n                    <label for=\"number-").concat(car.id, "\">\u041D\u043E\u043C\u0435\u0440</label>\n                    <div class=\"error invisible\" data-error=\"number\">\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u043C\u0430\u0448\u0438\u043D\u044B</div>\n                </div>\n                ").concat(buttonDelCar, "\n            </div>\n        ");
      return carTemplate;
    }
  }, {
    key: "SetUserCar",
    value: function SetUserCar(car, carsList) {
      var carTemplate = this.SetCarTemplate(car);
      if (carsList) {
        carsList.insertAdjacentHTML('beforeend', carTemplate);
      }
    }
  }, {
    key: "CollectUserDataFromProfile",
    value: function CollectUserDataFromProfile() {
      var userData = {};

      //Собираем данные по пользователю
      var userProfileInputs = document.querySelectorAll('.profile-group[data-group="user"] input');
      userProfileInputs.forEach(function (input) {
        var inputKey = input.id;
        var inputValue = input.value;

        // Обработка даты рождения
        if (inputKey === 'birthday' && inputValue) {
          // Преобразуем дату в формат ISO с UTC
          var date = new Date(inputValue);
          // Устанавливаем время в 00:00:00 и конвертируем в UTC
          date.setHours(0, 0, 0, 0);
          inputValue = date.toISOString();
        }
        userData[inputKey] = inputValue;
      });
      return userData;
    }
  }, {
    key: "CollectCarsDataFromProfile",
    value: function CollectCarsDataFromProfile() {
      var carsData = [];

      // собираем данные по машинам из профиля
      var cars = document.querySelectorAll('.profile-group[data-group="cars"] .car');
      cars.forEach(function (car) {
        var _car$querySelector, _car$querySelector2, _car$querySelector3, _car$querySelector4;
        var carData = {
          id: car.dataset.carId || '',
          mark: ((_car$querySelector = car.querySelector('input[name="mark"]')) === null || _car$querySelector === void 0 ? void 0 : _car$querySelector.value) || '',
          model: ((_car$querySelector2 = car.querySelector('input[name="model"]')) === null || _car$querySelector2 === void 0 ? void 0 : _car$querySelector2.value) || '',
          color: ((_car$querySelector3 = car.querySelector('input[name="color"]')) === null || _car$querySelector3 === void 0 ? void 0 : _car$querySelector3.value) || '',
          number: ((_car$querySelector4 = car.querySelector('input[name="number"]')) === null || _car$querySelector4 === void 0 ? void 0 : _car$querySelector4.value) || '',
          userId: window.authManager.userData.userId
        };
        carsData.push(carData);
      });
      return carsData;
    }
  }, {
    key: "CollectCarsDataFromModal",
    value: function CollectCarsDataFromModal() {
      var carData = {};

      // собираем данные по машинам
      var cars = document.querySelectorAll('.car-modal .car');
      cars.forEach(function (car) {
        var _car$querySelector5, _car$querySelector6, _car$querySelector7, _car$querySelector8;
        carData = {
          mark: ((_car$querySelector5 = car.querySelector('input[name="mark"]')) === null || _car$querySelector5 === void 0 ? void 0 : _car$querySelector5.value) || '',
          model: ((_car$querySelector6 = car.querySelector('input[name="model"]')) === null || _car$querySelector6 === void 0 ? void 0 : _car$querySelector6.value) || '',
          color: ((_car$querySelector7 = car.querySelector('input[name="color"]')) === null || _car$querySelector7 === void 0 ? void 0 : _car$querySelector7.value) || '',
          number: ((_car$querySelector8 = car.querySelector('input[name="number"]')) === null || _car$querySelector8 === void 0 ? void 0 : _car$querySelector8.value) || '',
          userId: window.authManager.userData.userId
        };
      });
      console.log("\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C\u044B\u0435 \u043C\u0430\u0448\u0438\u043D\u044B:");
      console.log(carData);
      return carData;
    }
  }, {
    key: "ShowValidationErrors",
    value: function ShowValidationErrors(errors) {
      // Очищаем все предыдущие ошибки
      document.querySelectorAll('.error').forEach(function (error) {
        error.classList.add('invisible');
      });

      // Показываем ошибки пользователя
      if (errors.user) {
        Object.keys(errors.user).forEach(function (field) {
          var errorElement = document.querySelector("[data-error=\"".concat(field, "\"]"));
          if (errorElement) {
            errorElement.textContent = errors.user[field];
            errorElement.classList.remove('invisible');
          }
        });
      }

      // Показываем ошибки автомобилей
      if (errors.cars && errors.cars.length > 0) {
        errors.cars.forEach(function (carErrors, index) {
          Object.keys(carErrors).forEach(function (field) {
            var errorElement = document.querySelector(".profile-group[data-group=\"cars\"] .car:nth-child(".concat(index + 1, ") [data-error=\"").concat(field, "\"]"));
            if (errorElement) {
              errorElement.textContent = carErrors[field];
              errorElement.classList.remove('invisible');
            }
          });
        });
      }
    }
  }, {
    key: "UpdateUserToDB",
    value: function () {
      var _UpdateUserToDB = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(id, userData) {
        var validation, carsData, carsValidation, allErrors, response, _t0, _t1, _t10;
        return _regenerator().w(function (_context7) {
          while (1) switch (_context7.p = _context7.n) {
            case 0:
              _context7.p = 0;
              // Валидация данных пользователя
              validation = this.validator.validateUserData(userData); // Собираем данные автомобилей для валидации
              carsData = this.CollectCarsDataFromProfile(); // Валидация автомобилей
              carsValidation = this.ValidateCarsData(carsData); // Объединяем ошибки
              allErrors = {
                user: validation.errors.user,
                cars: carsValidation.errors
              };
              if (!(!validation.isValid || !carsValidation.isValid)) {
                _context7.n = 1;
                break;
              }
              this.ShowValidationErrors(allErrors);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Исправьте ошибки в форме', 'red');
              return _context7.a(2);
            case 1:
              // Если валидация прошла успешно, очищаем ошибки
              document.querySelectorAll('.error').forEach(function (error) {
                error.classList.add('invisible');
              });
              _context7.n = 2;
              return fetch("".concat(this.userApiAddress, "/api/Users/").concat(id), {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(_objectSpread(_objectSpread({}, userData), {}, {
                  id: id
                }))
              });
            case 2:
              response = _context7.v;
              if (response.ok) {
                _context7.n = 4;
                break;
              }
              _t0 = Error;
              _context7.n = 3;
              return response.text();
            case 3:
              _t1 = _context7.v;
              throw new _t0(_t1);
            case 4:
              console.log("\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C ".concat(id, " \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D"));
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Данные пользователя сохранены', 'green');
              _context7.n = 6;
              break;
            case 5:
              _context7.p = 5;
              _t10 = _context7.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ".concat(id, ":"), _t10);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка сохранения данных', 'red');
            case 6:
              return _context7.a(2);
          }
        }, _callee7, this, [[0, 5]]);
      }));
      function UpdateUserToDB(_x7, _x8) {
        return _UpdateUserToDB.apply(this, arguments);
      }
      return UpdateUserToDB;
    }()
  }, {
    key: "ValidateCarsData",
    value: function ValidateCarsData(carsData) {
      var _this2 = this;
      var errors = [];
      var isValid = true;
      carsData.forEach(function (car) {
        var carValidation = _this2.validator.validateCar(car);
        if (!carValidation.isValid) {
          errors.push(carValidation.errors);
          isValid = false;
        } else {
          errors.push({});
        }
      });

      // Проверка уникальности номеров
      var duplicateIndices = this.validator.validateUniqueCarNumbers(carsData);
      if (duplicateIndices.length > 0) {
        duplicateIndices.forEach(function (index) {
          if (!errors[index]) errors[index] = {};
          errors[index].number = 'Номер автомобиля уже существует';
          isValid = false;
        });
      }
      return {
        isValid: isValid,
        errors: errors
      };
    }
  }, {
    key: "ValidateCarInModal",
    value: function ValidateCarInModal() {
      var carData = this.CollectCarsDataFromModal();
      var validation = this.validator.validateCar(carData);

      // Очищаем ошибки в модальном окне
      document.querySelectorAll('.car-modal .error').forEach(function (error) {
        error.classList.add('invisible');
      });
      if (!validation.isValid) {
        Object.keys(validation.errors).forEach(function (field) {
          var errorElement = document.querySelector(".car-modal [data-error=\"".concat(field, "\"]"));
          if (errorElement) {
            errorElement.textContent = validation.errors[field];
            errorElement.classList.remove('invisible');
          }
        });
        return false;
      }
      return true;
    }
  }, {
    key: "AddCarToUser",
    value: function () {
      var _AddCarToUser = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(userId) {
        var response, data, _t11, _t12, _t13;
        return _regenerator().w(function (_context8) {
          while (1) switch (_context8.p = _context8.n) {
            case 0:
              if (this.ValidateCarInModal()) {
                _context8.n = 1;
                break;
              }
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Исправьте ошибки в форме автомобиля', 'red');
              return _context8.a(2);
            case 1:
              _context8.p = 1;
              _context8.n = 2;
              return fetch("".concat(this.userApiAddress, "/api/Cars"), {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(this.CollectCarsDataFromModal())
              });
            case 2:
              response = _context8.v;
              if (response.ok) {
                _context8.n = 4;
                break;
              }
              _t11 = Error;
              _context8.n = 3;
              return response.text();
            case 3:
              _t12 = _context8.v;
              throw new _t11(_t12);
            case 4:
              _context8.n = 5;
              return response.json();
            case 5:
              data = _context8.v;
              console.log('Автомобиль создан:', data);

              //инсертим автомобиль в список
              _context8.n = 6;
              return this.InsertCarsToUserProfile(userId);
            case 6:
              //зачищаем модалку и закрываем её
              document.querySelectorAll('.car-modal input').forEach(function (input) {
                input.value = '';
              });
              document.querySelector('.car-modal').closest('.modal-overview').classList.remove('active');
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Автомобиль успешно добавлен', 'green');
              return _context8.a(2, data);
            case 7:
              _context8.p = 7;
              _t13 = _context8.v;
              console.error('Ошибка создания автомобиля:', _t13);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка добавления автомобиля', 'red');
            case 8:
              return _context8.a(2);
          }
        }, _callee8, this, [[1, 7]]);
      }));
      function AddCarToUser(_x9) {
        return _AddCarToUser.apply(this, arguments);
      }
      return AddCarToUser;
    }()
  }, {
    key: "RemoveCarFromUser",
    value: function () {
      var _RemoveCarFromUser = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9(carId) {
        var response, _t14, _t15, _t16;
        return _regenerator().w(function (_context9) {
          while (1) switch (_context9.p = _context9.n) {
            case 0:
              _context9.p = 0;
              _context9.n = 1;
              return fetch("".concat(this.userApiAddress, "/api/Cars/").concat(carId), {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json'
                }
              });
            case 1:
              response = _context9.v;
              if (response.ok) {
                _context9.n = 3;
                break;
              }
              _t14 = Error;
              _context9.n = 2;
              return response.text();
            case 2:
              _t15 = _context9.v;
              throw new _t14(_t15);
            case 3:
              console.log("\u0410\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u044C ".concat(carId, " \u0443\u0434\u0430\u043B\u0451\u043D"));
              //удоляем строку с отображением авто из профиля
              document.querySelector(".profile-group .car[data-car-id=\"".concat(carId, "\"]")).remove();
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Автомобиль успешно удалён', 'green');
              _context9.n = 5;
              break;
            case 4:
              _context9.p = 4;
              _t16 = _context9.v;
              console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0430\u0432\u0442\u043E\u043C\u043E\u0431\u0438\u043B\u044F ".concat(carId, ":"), _t16);
              _Modal_js__WEBPACK_IMPORTED_MODULE_1__.Modal.ShowNotification('Ошибка удаления автомобиля', 'red');
            case 5:
              return _context9.a(2);
          }
        }, _callee9, this, [[0, 4]]);
      }));
      function RemoveCarFromUser(_x0) {
        return _RemoveCarFromUser.apply(this, arguments);
      }
      return RemoveCarFromUser;
    }()
  }]);
}();
document.addEventListener('authStateChanged', function () {
  var _event$detail = event.detail,
    isAuthenticated = _event$detail.isAuthenticated,
    userData = _event$detail.userData;
  if (isAuthenticated && userData) {
    var userProfile = new UserProfile();
    var userId = window.authManager.userData.userId;
    if (window.location.pathname == '/') {
      userProfile.InsertUserDataToCardOnMainPage(userId);
    }
    if (document.getElementById('user-profile')) {
      userProfile.InsertUserDataToProfile(userId);
      document.querySelector("[data-action=\"save-user-data\"]").addEventListener('click', function () {
        userProfile.UpdateUserToDB(window.authManager.userData.userId, userProfile.CollectUserDataFromProfile());
      });
      document.querySelector("[data-action=\"add-car-to-user\"]").addEventListener('click', function () {
        userProfile.AddCarToUser(window.authManager.userData.userId);
      });
      document.addEventListener('click', function (e) {
        if (e.target.dataset.action == 'remove-car-from-user') {
          var carId = e.target.dataset.carId;
          userProfile.RemoveCarFromUser(carId);
        }
      });
    }
    userProfile.InsertUserIdToLinks(userId);
  }
});

/***/ }),

/***/ "./wwwroot/js/UserValidator.js":
/*!*************************************!*\
  !*** ./wwwroot/js/UserValidator.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UserValidator: () => (/* binding */ UserValidator)
/* harmony export */ });
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
var UserValidator = /*#__PURE__*/function () {
  function UserValidator() {
    _classCallCheck(this, UserValidator);
    // Разрешенные буквы в российских номерах (совпадают с латинскими)
    this.allowedLetters = 'АВЕКМНОРСТУХ';

    // Коды регионов России
    this.validRegionCodes = [
    // Основные регионы
    '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '95', '96', '97', '98', '99',
    // Трёхзначные коды для крупных регионов
    '102', '113', '116', '117', '118', '119', '121', '122', '123', '124', '125', '126', '134', '136', '138', '142', '150', '152', '154', '159', '161', '163', '164', '173', '174', '177', '178', '186', '190', '196', '197', '198', '199', '702', '716', '750', '761', '763', '774', '777', '790', '799', '999'];

    // Запрещенные комбинации
    this.forbiddenCombinations = [/.*ХУ[ЙИ].*/, /.*БЛ[ЯА].*/, /.*П[ИИ]З.*/, /.*МУД.*/, /.*ГОВ.*/];
  }

  //Валидация имени/фамилии/отчества
  return _createClass(UserValidator, [{
    key: "validateName",
    value: function validateName(name, fieldName) {
      var required = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      if (!name || name.trim() === '') {
        if (required) {
          return {
            isValid: false,
            error: "".concat(fieldName, " \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F")
          };
        }
        return {
          isValid: true
        };
      }
      if (name.length > 50) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0434\u043B\u0438\u043D\u043D\u0435\u0435 50 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432")
        };
      }
      if (!/^[а-яё\s\-']+$/i.test(name)) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u0434\u043E\u043B\u0436\u043D\u043E \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u0442\u043E\u043B\u044C\u043A\u043E \u0440\u0443\u0441\u0441\u043A\u0438\u0435 \u0431\u0443\u043A\u0432\u044B, \u043F\u0440\u043E\u0431\u0435\u043B\u044B, \u0434\u0435\u0444\u0438\u0441\u044B \u0438 \u0430\u043F\u043E\u0441\u0442\u0440\u043E\u0444\u044B")
        };
      }

      // Проверка на слишком много пробелов подряд
      if (/\s{2,}/.test(name)) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043F\u0440\u043E\u0431\u0435\u043B\u043E\u0432 \u043F\u043E\u0434\u0440\u044F\u0434")
        };
      }

      // Проверка на пробелы в начале/конце
      if (name !== name.trim()) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u043E \u043D\u0430\u0447\u0438\u043D\u0430\u0442\u044C\u0441\u044F \u0438\u043B\u0438 \u0437\u0430\u043A\u0430\u043D\u0447\u0438\u0432\u0430\u0442\u044C\u0441\u044F \u043F\u0440\u043E\u0431\u0435\u043B\u043E\u043C")
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация даты рождения
     */
  }, {
    key: "validateBirthday",
    value: function validateBirthday(birthday) {
      if (!birthday) {
        return {
          isValid: true
        }; // Дата рождения необязательна
      }
      var birthDate = new Date(birthday);
      var today = new Date();
      var minDate = new Date(today.getFullYear() - 125, today.getMonth(), today.getDate());
      if (isNaN(birthDate.getTime())) {
        return {
          isValid: false,
          error: 'Неверный формат даты'
        };
      }
      if (birthDate > today) {
        return {
          isValid: false,
          error: 'Дата рождения не может быть в будущем'
        };
      }
      if (birthDate < minDate) {
        return {
          isValid: false,
          error: 'Дата рождения не может быть более 125 лет назад'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация номера телефона
     */
  }, {
    key: "validatePhoneNumber",
    value: function validatePhoneNumber(phone) {
      if (!phone || phone.trim() === '') {
        return {
          isValid: false,
          error: 'Номер телефона обязателен для заполнения'
        };
      }

      // Убираем все символы кроме цифр и +
      var cleanPhone = phone.replace(/[\s\-\(\)]/g, '');

      // Различные форматы российских номеров
      var phonePatterns = [/^(\+7|8)\d{10}$/,
      // +7XXXXXXXXXX или 8XXXXXXXXXX
      /^\+7\d{10}$/,
      // +7XXXXXXXXXX
      /^8\d{10}$/,
      // 8XXXXXXXXXX
      /^7\d{10}$/ // 7XXXXXXXXXX
      ];
      var isValidFormat = false;
      for (var _i = 0, _phonePatterns = phonePatterns; _i < _phonePatterns.length; _i++) {
        var pattern = _phonePatterns[_i];
        if (pattern.test(cleanPhone)) {
          isValidFormat = true;
          break;
        }
      }
      if (!isValidFormat) {
        return {
          isValid: false,
          error: 'Неверный формат номера телефона. Используйте российский формат'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация email
     */
  }, {
    key: "validateEmail",
    value: function validateEmail(email) {
      if (!email || email.trim() === '') {
        return {
          isValid: false,
          error: 'Email обязателен для заполнения'
        };
      }
      if (email.length > 100) {
        return {
          isValid: false,
          error: 'Email не может быть длиннее 100 символов'
        };
      }
      var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      if (!emailRegex.test(email)) {
        return {
          isValid: false,
          error: 'Неверный формат email'
        };
      }

      // Проверка на запрещенные символы в локальной части
      var localPart = email.split('@')[0];
      if (localPart.startsWith('.') || localPart.endsWith('.') || localPart.includes('..')) {
        return {
          isValid: false,
          error: 'Неверный формат email'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация номера автомобиля
     */
  }, {
    key: "validateCarNumber",
    value: function validateCarNumber(number) {
      if (!number || number.trim() === '') {
        return {
          isValid: false,
          error: 'Номер автомобиля обязателен'
        };
      }
      var cleanNumber = number.replace(/[\s\-]/g, '').toUpperCase();

      // Проверка длины
      if (cleanNumber.length < 8 || cleanNumber.length > 9) {
        return {
          isValid: false,
          error: 'Неверная длина номера (должно быть 8-9 символов)'
        };
      }

      // Различные форматы российских номеров
      var patterns = [{
        pattern: /^[АВЕКМНОРСТУХ]\d{3}[АВЕКМНОРСТУХ]{2}\d{2,3}$/,
        type: 'стандартный'
      }, {
        pattern: /^[АВЕКМНОРСТУХ]{2}\d{3}[АВЕКМНОРСТУХ]\d{2,3}$/,
        type: 'такси'
      }, {
        pattern: /^[АВЕКМНОРСТУХ]{2}\d{4}\d{2,3}$/,
        type: 'прицеп'
      }, {
        pattern: /^\d{4}[АВЕКМНОРСТУХ]{2}\d{2,3}$/,
        type: 'мотоцикл'
      }, {
        pattern: /^Т\d{3}[АВЕКМНОРСТУХ]{2}\d{2,3}$/,
        type: 'транзит'
      }];
      var isValidFormat = false;
      for (var _i2 = 0, _patterns = patterns; _i2 < _patterns.length; _i2++) {
        var pattern = _patterns[_i2].pattern;
        if (pattern.test(cleanNumber)) {
          isValidFormat = true;
          break;
        }
      }
      if (!isValidFormat) {
        return {
          isValid: false,
          error: 'Неверный формат российского номера'
        };
      }

      // Проверка кода региона
      var regionCode = cleanNumber.slice(-3);
      var twoDigitCode = regionCode.slice(-2);
      var threeDigitCode = regionCode;
      if (!this.validRegionCodes.includes(twoDigitCode) && !this.validRegionCodes.includes(threeDigitCode)) {
        return {
          isValid: false,
          error: 'Неверный код региона'
        };
      }

      // Проверка на запрещенные комбинации
      var _iterator = _createForOfIteratorHelper(this.forbiddenCombinations),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var forbidden = _step.value;
          if (forbidden.test(cleanNumber)) {
            return {
              isValid: false,
              error: 'Недопустимая комбинация символов в номере'
            };
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация марки/модели автомобиля
     */
  }, {
    key: "validateCarBrand",
    value: function validateCarBrand(value, fieldName) {
      if (!value || value.trim() === '') {
        return {
          isValid: true
        }; // Необязательное поле
      }
      if (value.length > 100) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0434\u043B\u0438\u043D\u043D\u0435\u0435 100 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432")
        };
      }
      if (!/^[а-яёa-z0-9\s\-._]+$/i.test(value)) {
        return {
          isValid: false,
          error: "".concat(fieldName, " \u0434\u043E\u043B\u0436\u043D\u0430 \u0441\u043E\u0434\u0435\u0440\u0436\u0430\u0442\u044C \u0442\u043E\u043B\u044C\u043A\u043E \u0431\u0443\u043A\u0432\u044B, \u0446\u0438\u0444\u0440\u044B, \u043F\u0440\u043E\u0431\u0435\u043B\u044B, \u0434\u0435\u0444\u0438\u0441\u044B, \u0442\u043E\u0447\u043A\u0438 \u0438 \u043F\u043E\u0434\u0447\u0435\u0440\u043A\u0438\u0432\u0430\u043D\u0438\u044F")
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация цвета автомобиля
     */
  }, {
    key: "validateCarColor",
    value: function validateCarColor(color) {
      if (!color || color.trim() === '') {
        return {
          isValid: true
        }; // Необязательное поле
      }
      if (color.length > 50) {
        return {
          isValid: false,
          error: 'Цвет не может быть длиннее 50 символов'
        };
      }
      if (!/^[а-яёa-z\s\-]+$/i.test(color)) {
        return {
          isValid: false,
          error: 'Цвет должен содержать только буквы, пробелы и дефисы'
        };
      }
      return {
        isValid: true
      };
    }

    /**
     * Валидация одного автомобиля
     */
  }, {
    key: "validateCar",
    value: function validateCar(car) {
      var errors = {};
      var isValid = true;

      // Валидация марки
      var markValidation = this.validateCarBrand(car.mark, 'Марка');
      if (!markValidation.isValid) {
        errors.mark = markValidation.error;
        isValid = false;
      }

      // Валидация модели
      var modelValidation = this.validateCarBrand(car.model, 'Модель');
      if (!modelValidation.isValid) {
        errors.model = modelValidation.error;
        isValid = false;
      }

      // Валидация цвета
      var colorValidation = this.validateCarColor(car.color);
      if (!colorValidation.isValid) {
        errors.color = colorValidation.error;
        isValid = false;
      }

      // Валидация номера
      var numberValidation = this.validateCarNumber(car.number);
      if (!numberValidation.isValid) {
        errors.number = numberValidation.error;
        isValid = false;
      }
      return {
        isValid: isValid,
        errors: errors
      };
    }

    /**
     * Проверка уникальности номеров автомобилей
     */
  }, {
    key: "validateUniqueCarNumbers",
    value: function validateUniqueCarNumbers(cars) {
      var numbers = cars.map(function (car) {
        var _car$number;
        return (_car$number = car.number) === null || _car$number === void 0 ? void 0 : _car$number.replace(/[\s\-]/g, '').toUpperCase();
      }).filter(Boolean);
      var duplicates = [];
      var seen = new Set();
      numbers.forEach(function (number, index) {
        if (seen.has(number)) {
          duplicates.push(index);
        } else {
          seen.add(number);
          // Также добавляем индекс первого вхождения дубликата
          var firstIndex = numbers.indexOf(number);
          if (firstIndex !== index && !duplicates.includes(firstIndex)) {
            duplicates.push(firstIndex);
          }
        }
      });
      return duplicates;
    }

    /**
     * Полная валидация данных пользователя
     */
  }, {
    key: "validateUserData",
    value: function validateUserData(userData) {
      var errors = {
        user: {},
        cars: []
      };
      var isValid = true;

      // Валидация данных пользователя
      var firstNameValidation = this.validateName(userData.firstName, 'Имя', true);
      if (!firstNameValidation.isValid) {
        errors.user.firstName = firstNameValidation.error;
        isValid = false;
      }
      var lastNameValidation = this.validateName(userData.lastName, 'Фамилия', true);
      if (!lastNameValidation.isValid) {
        errors.user.lastName = lastNameValidation.error;
        isValid = false;
      }
      var patronymicValidation = this.validateName(userData.patronymic, 'Отчество', false);
      if (!patronymicValidation.isValid) {
        errors.user.patronymic = patronymicValidation.error;
        isValid = false;
      }
      var birthdayValidation = this.validateBirthday(userData.birthday);
      if (!birthdayValidation.isValid) {
        errors.user.birthday = birthdayValidation.error;
        isValid = false;
      }
      var phoneValidation = this.validatePhoneNumber(userData.phoneNumber);
      if (!phoneValidation.isValid) {
        errors.user.phoneNumber = phoneValidation.error;
        isValid = false;
      }
      var emailValidation = this.validateEmail(userData.email);
      if (!emailValidation.isValid) {
        errors.user.email = emailValidation.error;
        isValid = false;
      }
      return {
        isValid: isValid,
        errors: errors
      };
    }

    /**
     * Форматирование номера автомобиля
     */
  }, {
    key: "formatCarNumber",
    value: function formatCarNumber(input) {
      var value = input.value.replace(/[^а-яёА-ЯЁ0-9ТтTt]/g, '').toUpperCase();

      // Заменяем русские буквы на допустимые
      var letterMap = {
        'А': 'А',
        'В': 'В',
        'Е': 'Е',
        'К': 'К',
        'М': 'М',
        'Н': 'Н',
        'О': 'О',
        'Р': 'Р',
        'С': 'С',
        'Т': 'Т',
        'У': 'У',
        'Х': 'Х',
        'T': 'Т' // Латинская T заменяется на русскую Т
      };
      value = value.split('').map(function (_char) {
        return letterMap[_char] || _char;
      }).join('');

      // Ограничиваем длину
      if (value.length > 9) {
        value = value.slice(0, 9);
      }
      input.value = value;
    }

    /**
     * Форматирование номера телефона
     */
  }, {
    key: "formatPhoneNumber",
    value: function formatPhoneNumber(input) {
      var value = input.value.replace(/\D/g, '');
      if (value.startsWith('8') && value.length > 1) {
        value = '7' + value.slice(1);
      }
      if (value.startsWith('7') && value.length <= 11) {
        var formatted = value.replace(/^7(\d{3})(\d{3})(\d{2})(\d{2})/, '+7 ($1) $2-$3-$4');
        input.value = formatted;
      } else if (value.length <= 10) {
        var _formatted = value.replace(/^(\d{3})(\d{3})(\d{2})(\d{2})/, '+7 ($1) $2-$3-$4');
        input.value = _formatted;
      }
    }
  }]);
}();

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	__webpack_require__("./wwwroot/js/UserValidator.js");
/******/ 	__webpack_require__("./wwwroot/js/UserProfile.js");
/******/ 	__webpack_require__("./wwwroot/js/Regex.js");
/******/ 	__webpack_require__("./wwwroot/js/NotificationProfileManager.js");
/******/ 	__webpack_require__("./wwwroot/js/NotificationClient.js");
/******/ 	__webpack_require__("./wwwroot/js/Multiselect.js");
/******/ 	__webpack_require__("./wwwroot/js/Modal.js");
/******/ 	__webpack_require__("./wwwroot/js/HouseValidator.js");
/******/ 	__webpack_require__("./wwwroot/js/FileStorageClient.js");
/******/ 	__webpack_require__("./wwwroot/js/FileHandler.js");
/******/ 	__webpack_require__("./wwwroot/js/DateFormat.js");
/******/ 	__webpack_require__("./wwwroot/js/AuthManager.js");
/******/ 	__webpack_require__("./wwwroot/js/ApartmentStatuses.js");
/******/ 	__webpack_require__("./wwwroot/js/ApartmentProfile.js");
/******/ 	__webpack_require__("./wwwroot/js/ApartmentHouses.js");
/******/ 	__webpack_require__("./wwwroot/css/variables.css");
/******/ 	__webpack_require__("./wwwroot/css/profile-group.css");
/******/ 	__webpack_require__("./wwwroot/css/notification.css");
/******/ 	__webpack_require__("./wwwroot/css/multiselect.css");
/******/ 	__webpack_require__("./wwwroot/css/modal.css");
/******/ 	__webpack_require__("./wwwroot/css/main.css");
/******/ 	__webpack_require__("./wwwroot/css/icons.css");
/******/ 	__webpack_require__("./wwwroot/css/house-and-apartments.css");
/******/ 	__webpack_require__("./wwwroot/css/grid.css");
/******/ 	__webpack_require__("./wwwroot/css/fonts-colors-and-backgrounds.css");
/******/ 	__webpack_require__("./wwwroot/css/file-manager.css");
/******/ 	__webpack_require__("./wwwroot/css/card.css");
/******/ 	var __webpack_exports__ = __webpack_require__("./wwwroot/css/btn.css");
/******/ 	
/******/ })()
;
//# sourceMappingURL=app.js.map